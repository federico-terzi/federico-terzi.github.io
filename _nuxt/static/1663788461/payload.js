__NUXT_JSONP__("/", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW){return {data:[{articles:[{slug:"2022-09-21-automatic-codesigning-on-windows-using-github-actions",description:"After our previous article on automatic code-signing for macOS applications, we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines.",layout:ah,title:"Automatic Code-signing on Windows using GitHub Actions",author:ai,date:"2022-09-21T00:00:00.000Z",categories:"code sign signing signtool certificate sectigo authority ci automatic github actions",social_title:"Automatic Code-signing on Windows",social_subtitle:"using GitHub Actions",toc:[{id:aw,depth:I,text:ax},{id:ay,depth:P,text:ad},{id:az,depth:I,text:aA},{id:aB,depth:P,text:aC},{id:aD,depth:P,text:aE},{id:aF,depth:I,text:aG},{id:aH,depth:P,text:"Troubleshooting “Expecting: TRUSTED CERTIFICATE” error"},{id:aI,depth:I,text:aJ},{id:aK,depth:I,text:aL},{id:aM,depth:I,text:aN},{id:aO,depth:I,text:aP},{id:aQ,depth:I,text:aR},{id:aS,depth:I,text:aT},{id:aU,depth:P,text:ad},{id:aV,depth:P,text:aW}],body:{type:Q,children:[{type:b,tag:g,props:{},children:[{type:a,value:aX},{type:b,tag:j,props:{href:aj,rel:[q,r,s],target:t},children:[{type:a,value:aY}]},{type:a,value:aZ}]},{type:a,value:e},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The article summarizes the steps we went through to code-sign Espanso, a cross-platform text expander. If you get stuck in the process, I also recommend checking out "},{type:b,tag:j,props:{href:"https:\u002F\u002Fgithub.com\u002Fespanso\u002Fespanso",rel:[q,r,s],target:t},children:[{type:a,value:"Espanso’s source code"}]},{type:a,value:m}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ae,props:{id:"getting-a-code-signing-certificate"},children:[{type:b,tag:j,props:{href:"#getting-a-code-signing-certificate",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:"Getting a Code-signing Certificate"}]},{type:a,value:e},{type:b,tag:J,props:{id:aw},children:[{type:b,tag:j,props:{href:"#choosing-a-certificate-authority",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:ax}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Before coding our way into the automatic CI pipeline, we first need to obtain a Code-signing certificate. There are multiple companies you can get one from, so the first challenge is to figure out which one to choose. We could talk to great lengths about the pros\u002Fcons of the various providers, but for the sake of this article, let’s summarize it by asking two questions:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Are you trying to sign the executable as a company or as an individual?"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"What is your budget?"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"These are my recommendations depending on the above answers:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:C,props:{},children:[{type:a,value:"Company with a large budget"}]},{type:a,value:": buy an EV certificate from DigiCert, those are the most expensive (currently at ~700$\u002Fyear) but they offer the best reputation and customer support."}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:C,props:{},children:[{type:a,value:"Individual with a large budget"}]},{type:a,value:": buy an OV certificate from DigiCert. These are still expensive (~500$\u002Fyear), but don’t offer as much reputation as an EV certificate (your users will still see Windows’ SafeScreen at first). Unfortunately, individuals can’t buy EV certificates, so this is likely the best you could find"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:C,props:{},children:[{type:a,value:"Individual with a small budget"}]},{type:a,value:": buy an OV certificate from a Sectigo reseller, like CodeSigningStore.com. I went down this route as Espanso is an open-source project and I had to be careful about the budget. Overall, the experience was "},{type:b,tag:M,props:{},children:[{type:a,value:"ok"}]},{type:a,value:", and after about 3 weeks of back and forth with their customer support, I managed to get a valid certificate at the price of ~70$\u002Fyear, thus significantly cheaper than the other options"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In short, if you are a company I recommend buying an EV certificate from DigiCert, as they offer the best reputation for your executable. On the other hand, if you are looking to code-sign your program (maybe an open-source project) on a budget, then an OV certificate from a reseller like "},{type:b,tag:j,props:{href:a_,rel:[q,r,s],target:t},children:[{type:a,value:a$}]},{type:a,value:" could be an option."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The next section will describe the process we went through to get an OV certificate from Sectigo. Feel free to jump to the next one if you already have a certificate or you decide to use a different provider."}]},{type:a,value:e},{type:b,tag:R,props:{id:ay},children:[{type:b,tag:j,props:{href:"#notes",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:ad}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"I highly recommend buying 3 years certificates. Despite being more expensive, they will save you from the “overhead” of re-applying for a certificate each year. Moreover, some certificates (like the OV version) require time to build a reputation, and buying a 3 years certificate means you won’t have to rebuild that reputation once a year."}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"If you choose an EV certificate, keep in mind that you will need to have an hardware token (a USB key shipped to you by the certificate authority) connected to the machine while performing the digital signature. This has an important consequence: "},{type:b,tag:C,props:{},children:[{type:a,value:"you won’t be able to use GitHub-hosted CI agents to perform the digital signature"}]},{type:a,value:", as you can’t connect the physical USB token to them. There are several possible workarounds, but a common one used in professional environments consists in running "},{type:b,tag:M,props:{},children:[{type:a,value:"self-hosted"}]},{type:a,value:" runners for your Windows CI integration. In short, you would keep a physical server inside your company’s office with the hardware token always connected. When a CI build is scheduled, GitHub (or your CI provider of choice) will run the build on your server (having the hardware key connected) instead of a cloud VM."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:J,props:{id:az},children:[{type:b,tag:j,props:{href:"#buying-an-ov-certificate-from-sectigo",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aA}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After a thorough evaluation of the possible options, I decided to get an OV certificate from Sectigo (or to be more precise, a reseller), as it was the cheapest option I could find with "},{type:b,tag:M,props:{},children:[{type:a,value:"acceptable"}]},{type:a,value:" reviews online (just search for “Comodo reviews” online to get an idea)."}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"For context: Comodo was rebranded to Sectigo in 2018, but there is the same company behind them."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"While you could buy a code-signing certificate directly from Sectigo’s website, I decided to buy it from a reseller, as the end result would be similar at a fraction of the price. I personally choose "},{type:b,tag:j,props:{href:a_,rel:[q,r,s],target:t},children:[{type:a,value:a$}]},{type:a,value:" as it seemed the reseller "},{type:b,tag:M,props:{},children:[{type:a,value:"with the least bad reviews online"}]},{type:a,value:" (not exactly reassuring, I know)."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"So I went ahead and paid 207$ for a 3 years Sectigo certificate."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Shortly after, I received an email with a link to submit a "},{type:b,tag:M,props:{},children:[{type:a,value:"Certificate Signing Request"}]},{type:a,value:" (CSR), a file containing your public key and other information. This will be used by the certificate authority to generate the certificate."}]},{type:a,value:e},{type:b,tag:R,props:{id:aB},children:[{type:b,tag:j,props:{href:"#generating-a-certificate-signing-request-csr",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aC}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"As discussed above, we need to submit a CSR to the Certificate Authority to generate a certificate. While there are multiple ways to create a CSR, these are the steps to generate one using "},{type:b,tag:h,props:{},children:[{type:a,value:ak}]},{type:a,value:n}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Note: If you are on Windows, the easiest way to get "},{type:b,tag:h,props:{},children:[{type:a,value:ak}]},{type:a,value:" is by using the executable distributed as part of a "},{type:b,tag:h,props:{},children:[{type:a,value:"git"}]},{type:a,value:" installation. In my case, after installing Git, I had access to the "},{type:b,tag:h,props:{},children:[{type:a,value:"openssl.exe"}]},{type:a,value:" executable in this path: "},{type:b,tag:h,props:{},children:[{type:a,value:"'C:\\Program Files\\Git\\usr\\bin\\openssl.exe"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:al,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Open a Powershell terminal"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Run this command to launch the generation wizard:"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,E]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ba}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bb}]},{type:a,value:" req "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"newkey rsa"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:"4096"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"keyout "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:H}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"out "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"MYCSR"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"csr"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:al,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"You will be presented with a series of prompts:\n"},{type:b,tag:al,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Create and verify a password. This is the password used to protect your private key, "},{type:b,tag:C,props:{},children:[{type:a,value:"make sure to save it somewhere, as we will need it later"}]}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:$},{type:b,tag:C,props:{},children:[{type:a,value:"Country name"}]},{type:a,value:", a two-letter code for your country (see a"},{type:b,tag:j,props:{href:"https:\u002F\u002Fwww.ssl.com\u002Fcountry-codes\u002F",rel:[q,r,s],target:t},children:[{type:a,value:" list of possible values"}]},{type:a,value:an}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:$},{type:b,tag:C,props:{},children:[{type:a,value:"Locality name"}]},{type:a,value:", the name of your city or town"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:$},{type:b,tag:C,props:{},children:[{type:a,value:"Organization name"}]},{type:a,value:", the name of your company\u002Forganization\u002Fpersonal name"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:$},{type:b,tag:C,props:{},children:[{type:a,value:"Common name"}]},{type:a,value:", the name of your website (such as "},{type:b,tag:h,props:{},children:[{type:a,value:"espanso.org"}]},{type:a,value:an}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:$},{type:b,tag:C,props:{},children:[{type:a,value:"Email address"}]}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Skip the challenge password"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"At the end of this process, you should find a "},{type:b,tag:h,props:{},children:[{type:a,value:bc}]},{type:a,value:" file containing your private key and a "},{type:b,tag:h,props:{},children:[{type:a,value:bd}]},{type:a,value:" file containing your certificate signing request. Keep both of them in a safe place as we will need them soon"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Submit the "},{type:b,tag:h,props:{},children:[{type:a,value:bd}]},{type:a,value:" file to the Certificate Authority"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:R,props:{id:aD},children:[{type:b,tag:j,props:{href:"#completing-the-verification-process",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aE}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After your request has been sent, the Certificate Authority will request additional information to verify your identity. This will usually take a few days or weeks, but in the end, you should receive a certificate."}]},{type:a,value:e},{type:b,tag:ae,props:{id:"preparing-the-certificate"},children:[{type:b,tag:j,props:{href:"#preparing-the-certificate",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:"Preparing the Certificate"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After the certificate has been issued, we need to turn it into a format compatible with our target CI pipeline. The following steps are necessary for Sectigo-issued certificates, but keep in mind the process might be slightly different with other Certificate Authorities. Our goal is to obtain the code-signing certificate in "},{type:b,tag:h,props:{},children:[{type:a,value:"PFX"}]},{type:a,value:" format, encoded as base64."}]},{type:a,value:e},{type:b,tag:J,props:{id:aF},children:[{type:b,tag:j,props:{href:"#verify-that-the-certificate-and-private-key-match",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aG}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Before diving into the actual conversion process, it’s a good idea to verify that the certificate being issued matches our private key (the one generated with the CSR)."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"To verify that, we need to run two commands:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,E]},children:[{type:b,tag:h,props:{},children:[{type:a,value:be},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:N}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:H}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:ac}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"and also (with "},{type:b,tag:h,props:{},children:[{type:a,value:T}]},{type:a,value:" being the certificate issued by the CA):"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,E]},children:[{type:b,tag:h,props:{},children:[{type:a,value:af},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:N}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:O}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:ac}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If the output of the two previous commands match, then the certificate is correct!"}]},{type:a,value:e},{type:b,tag:R,props:{id:aH},children:[{type:b,tag:j,props:{href:"#troubleshooting-expecting-trusted-certificate-error",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:"Troubleshooting “"},{type:b,tag:C,props:{},children:[{type:a,value:"Expecting: TRUSTED CERTIFICATE” error"}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In my case, the previous commands returned the following error:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,E]},children:[{type:b,tag:h,props:{},children:[{type:a,value:bf},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bj}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,bk,bl]},children:[{type:a,value:bm}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bo},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:bq},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bs}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bt}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,ap]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bv}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bw}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"This error is due to the "},{type:b,tag:h,props:{},children:[{type:a,value:T}]},{type:a,value:" file being encoded in the wrong format. Luckily, we can solve this problem by following "},{type:b,tag:j,props:{href:"https:\u002F\u002Ffedericoterzi.com\u002Fblog\u002Ffixing-the-expecting-trusted-certificate-error-with-sectigo-certificates",rel:[q,r,s],target:t},children:[{type:a,value:"these steps"}]},{type:a,value:m}]},{type:a,value:e},{type:b,tag:J,props:{id:aI},children:[{type:b,tag:j,props:{href:"#convert-the-certificate-to-pfx-format",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aJ}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After verifying that the certificate matches our private key, we are ready to “bundle” all of them together into a PFX certificate. We will use "},{type:b,tag:h,props:{},children:[{type:a,value:ak}]},{type:a,value:" for this step as well:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,E]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ba}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bb}]},{type:a,value:" pkcs12 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L,"module"]},children:[{type:a,value:"export"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"out codesign"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"inkey "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:a,value:"\\"},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:H}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:N}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:a,value:"\\certificate"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:O}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Where:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:bc}]},{type:a,value:" is the private key we generated during the CSR step."}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:bx}]},{type:a,value:" is the public certificate issued by the Certificate Authority. In the case of Sectigo certificates, "},{type:b,tag:C,props:{},children:[{type:a,value:"this file is not the"}]},{type:a,value:l},{type:b,tag:C,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:T}]}]},{type:a,value:" certificate directly issued by the CA, but refers to the converted certificate after "},{type:b,tag:j,props:{href:"https:\u002F\u002Ffedericoterzi.com\u002Fblog\u002Ffixing-the-expecting-trusted-certificate-error-with-sectigo-certificates\u002F",rel:[q,r,s],target:t},children:[{type:a,value:"following these steps"}]},{type:a,value:m}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:by}]},{type:a,value:" is the output PFX certificate file."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:J,props:{id:aK},children:[{type:b,tag:j,props:{href:"#test-the-code-signing-process-manually",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aL}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Before diving into the process to build an automatic signing pipeline, let’s verify that the code-signing certificate works as expected by attempting a manual signature."}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"We will need Microsoft’s "},{type:b,tag:h,props:{},children:[{type:a,value:bz}]},{type:a,value:" to perform the following steps. You can get it by installing the Windows 10 SDK using Visual Studio. More info on this "},{type:b,tag:j,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F31869552\u002Fhow-to-install-signtool-exe-for-windows-10",rel:[q,r,s],target:t},children:[{type:a,value:"StackOverflow thread"}]},{type:a,value:m}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"We can sign an executable by opening a terminal and running the following command:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,E]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bA}]},{type:a,value:" sign "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"fd "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"SHA256"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"p "},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bB}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"ac "},{type:b,tag:c,props:{className:[d,ap]},children:[{type:a,value:bC}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:O}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"f codesign"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"tr http"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"timestamp"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"sectigo"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"com"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"rfc3161 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:"td sha256 yourProgram"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"exe"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"where:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:bA}]},{type:a,value:" is the path to "},{type:b,tag:h,props:{},children:[{type:a,value:U}]},{type:a,value:". This path will vary depending on the Windows 10 SDK version being installed, so make sure to update the path accordingly."}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:bB}]},{type:a,value:" should be replaced by your private key’s password (the one we choose during the CSR generation)"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"SectigoPublicCodeSigningRootR46_AAA.crt"}]},{type:a,value:" is the path to an appropriate "},{type:b,tag:M,props:{},children:[{type:a,value:"intermediate certificate"}]},{type:a,value:". You can download the appropriate ones for "},{type:b,tag:j,props:{href:"https:\u002F\u002Fsupport.sectigo.com\u002Farticles\u002FKnowledge\u002FSectigo-Intermediate-Certificates",rel:[q,r,s],target:t},children:[{type:a,value:"Sectigo here"}]},{type:a,value:" and for "},{type:b,tag:j,props:{href:"https:\u002F\u002Fknowledge.digicert.com\u002Falerts\u002Fcode-signing-new-minimum-rsa-keysize.html",rel:[q,r,s],target:t},children:[{type:a,value:"DigiCert here"}]},{type:a,value:m}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:by}]},{type:a,value:" is the path to the certificate we generated in the previous step."}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:"yourProgram.exe"}]},{type:a,value:" is the path to the executable we want to sign"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After running this command, right-click on the executable and choose “Properties” \u003E Digital Signatures tab. If everything was correct, you should now see an entry for your signature, as shown in the image below."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:b,tag:"img",props:{alt:"",src:"\u002Fposts\u002F2022-09-21-automatic-codesigning-on-windows-using-github-actions\u002Fimage0.png"},children:[]}]},{type:a,value:e},{type:b,tag:Z,props:{},children:[{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If you don’t see a “Digital Signatures” tab, then it means the signature process didn’t complete successfully. Make sure to double check all the paths used in the above command."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ae,props:{id:"automating-the-signing-process-on-a-ci-pipeline"},children:[{type:b,tag:j,props:{href:"#automating-the-signing-process-on-a-ci-pipeline",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:"Automating the signing process on a CI pipeline"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Now that we successfully signed an executable with our new certificate, we are ready to automate the process as part of a CI pipeline. For this example, we are going to use GitHub Actions as platform, but these steps could be adapted to most providers with minimal changes."}]},{type:a,value:e},{type:b,tag:J,props:{id:aM},children:[{type:b,tag:j,props:{href:"#a-note-on-ev-certificates",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aN}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If you are using a company’s EV certificate, you will likely need a hardware token (a USB key sent by the certificate authority) to sign your executables. As a result, "},{type:b,tag:C,props:{},children:[{type:a,value:"you won’t be able to use cloud-hosted CI agents"}]},{type:a,value:", as there is no way for you to connect the hardware token there."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In these scenarios, a common solution is to maintain a physical server in your company’s office with the hardware token always connected. At this point, you can use GitHub’s self-hosted runners to execute the CI pipelines from your local server, which will be connected to the required hardware token."}]},{type:a,value:e},{type:b,tag:J,props:{id:aO},children:[{type:b,tag:j,props:{href:"#converting-the-certificate-to-base64",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aP}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In order to store the certificate as a GitHub Action "},{type:b,tag:M,props:{},children:[{type:a,value:"Secret"}]},{type:a,value:", we need to encode it as base64 string. An easy way to do that on Windows is to run the following command:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,E]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"certutil "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"encode codesign"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:a,value:" base64cert"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"txt"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If you also want to use an intermediate certificate (the "},{type:b,tag:h,props:{},children:[{type:a,value:bC}]},{type:a,value:" one we used above), you should generate the base64 of that one as well."}]},{type:a,value:e},{type:b,tag:J,props:{id:aQ},children:[{type:b,tag:j,props:{href:"#preparing-github-secrets",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aR}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"At this point, we are ready to add the information we gathered so far as Secrets. Open your project’s repository and navigate to Settings \u003E Security \u003E Secrets \u003E Actions and add the following variables:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:bD}]},{type:a,value:" should contain the certificate encoded as base64, the one we prepared in the previous section"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:b,tag:h,props:{},children:[{type:a,value:bE}]},{type:a,value:" should contain the private key’s password"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"(Optional) "},{type:b,tag:h,props:{},children:[{type:a,value:bF}]},{type:a,value:" the base64 of the intermediate certificate, if you’re using one"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:J,props:{id:aS},children:[{type:b,tag:j,props:{href:"#automating-the-code-sign-process",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aT}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"At this point, we are finally ready to automate the code-signing process. For the sake of this example, we will sign an executable located in path: "},{type:b,tag:h,props:{},children:[{type:a,value:"target\u002Frelease\u002Fespanso.exe"}]},{type:a,value:" , make sure to update it with the actual path of your program."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The final Action step configuration will look like the following:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[B,"language-yaml"]},children:[{type:b,tag:h,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:o}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,H,V]},children:[{type:a,value:"name"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:" Sign executable\n  "},{type:b,tag:c,props:{className:[d,H,V]},children:[{type:a,value:"env"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,H,V]},children:[{type:a,value:bE}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:a,value:" secrets.CODESIGN_PWD"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:X}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,H,V]},children:[{type:a,value:bF}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:a,value:" secrets.CODESIGN_INTERMEDIATE_BASE64 "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:X}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,H,V]},children:[{type:a,value:bD}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:W}]},{type:a,value:" secrets.CODESIGN_BASE64"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:X}]},{type:a,value:"\n  "},{type:b,tag:c,props:{className:[d,H,V]},children:[{type:a,value:"run"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,"scalar",G]},children:[{type:a,value:"\n    New-Item -ItemType directory -Path certificate\n    Set-Content -Path certificate\\certificate.txt -Value $env:CODESIGN_BASE64\n    certutil -decode certificate\\certificate.txt certificate\\certificate.pfx\n    Set-Content -Path certificate\\intermediate.txt -Value $env:CODESIGN_INTERMEDIATE_BASE64\n    certutil -decode certificate\\intermediate.txt certificate\\intermediate.crt"}]},{type:a,value:"\n\n    & 'C"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:"\u002FProgram Files (x86)\u002FWindows Kits\u002F10\u002Fbin\u002F10.0.22621.0\u002Fx86\u002Fsigntool.exe' sign \u002Ffd SHA256 \u002Fp $env"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:"CODESIGN_PWD \u002Fac certificate\\intermediate.crt \u002Ff certificate\\certificate.pfx \u002Ftr \"http"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:n}]},{type:a,value:"\u002F\u002Ftimestamp.sectigo.com\u002Frfc3161\" \u002Ftd sha256 target\u002Frelease\u002Fespanso.exe\n    \n    Remove"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:o}]},{type:a,value:"Item "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:o}]},{type:a,value:"Recurse "},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:o}]},{type:a,value:"Force certificate\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In a nutshell, these are the steps performed above:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Load the secrets as environmental variables"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Load the base64 certificates and convert them back to their original format"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Invoke "},{type:b,tag:h,props:{},children:[{type:a,value:bz}]},{type:a,value:" with the relevant parameters"}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Remove the temporary certificate files"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:R,props:{id:aU},children:[{type:b,tag:j,props:{href:"#notes-1",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:ad}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"If you are not using an intermediate certificate, you can remove the "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Fac certificate\\intermediate.crt"}]},{type:a,value:" flag and all the lines that contain “intermediate”"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:R,props:{id:aV},children:[{type:b,tag:j,props:{href:"#alternative-approaches",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:aW}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"There are also other approaches you might prefer:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"If your project is written in Rust, you could take inspiration from our PR: "},{type:b,tag:j,props:{href:bG,rel:[q,r,s],target:t},children:[{type:a,value:bG}]}]},{type:a,value:e},{type:b,tag:k,props:{},children:[{type:a,value:"Use a pre-built GitHub Action such as: "},{type:b,tag:j,props:{href:bH,rel:[q,r,s],target:t},children:[{type:a,value:bH}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:ae,props:{id:"conclusion"},children:[{type:b,tag:j,props:{href:"#conclusion",ariaHidden:u,tabIndex:v},children:[{type:b,tag:c,props:{className:[w,x]},children:[]}]},{type:a,value:"Conclusion"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"In this article, we discussed the process to get your Windows program code-signed, starting from the choice of certificate authority, all the way down to a fully automated CI pipeline. The article was mostly focused on Sectigo certificates and GitHub actions, but most steps can be applied to other certificate authorities and CI platforms."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"If you are also distributing your app on macOS, you might also enjoy my article on "},{type:b,tag:j,props:{href:aj,rel:[q,r,s],target:t},children:[{type:a,value:"automatic code-signing and notarization for macOS apps"}]},{type:a,value:m}]}]},excerpt:{type:Q,children:[{type:b,tag:g,props:{},children:[{type:a,value:aX},{type:b,tag:j,props:{href:aj,rel:[q,r,s],target:t},children:[{type:a,value:aY}]},{type:a,value:aZ}]}]},dir:at,path:"\u002Farticles\u002F2022-09-21-automatic-codesigning-on-windows-using-github-actions",extension:au,createdAt:Y,updatedAt:Y,cleanedSlug:"automatic-codesigning-on-windows-using-github-actions"},{slug:"2022-08-27-fixing-the-error-signersign-failed-during-signtool-codesigning",description:"Today I was working on the automatic code-signing CI for Espanso. As suggested by various articles, I went ahead and tried to sign the executable with this signtool command:",layout:ah,title:bI,author:ai,date:"2022-08-27T00:00:00.000Z",categories:"code sign code-signing signtool sign windows certificate sectigo",social_title:bI,toc:[],body:{type:Q,children:[{type:b,tag:g,props:{},children:[{type:a,value:bJ},{type:b,tag:j,props:{href:bK,rel:[q,r,s],target:t},children:[{type:a,value:av}]},{type:a,value:bL},{type:b,tag:h,props:{},children:[{type:a,value:U}]},{type:a,value:bM}]},{type:a,value:e},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[ag,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:bN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bO}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bQ}]},{type:a,value:bR},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bS}]},{type:a,value:" \u002Ff YOUR_PFX_HERE \u002Ftr http:\u002F\u002Ftimestamp.sectigo.com\u002Frfc3161 "},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bT}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Unfortunately, I was greeted with this cryptic error message:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[ag,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"SignTool Error: An unexpected internal error has occurred.\nError information: "},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:"\"Error: SignerSign() failed.\""}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"("}]},{type:a,value:"-2146869243\u002F0x80096005"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:an}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After a bit of investigation, it turned out to be due to a missing flag in the "},{type:b,tag:h,props:{},children:[{type:a,value:U}]},{type:a,value:" invocation:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[ag,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:"\u002Ftd sha256\n"}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"This flag instructs "},{type:b,tag:h,props:{},children:[{type:a,value:U}]},{type:a,value:" to use a SHA256 digest for the RFC 3161 timestamp server, solving the above problem."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"So in the end, I got it working with the following command:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[ag,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:bN},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bO}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bQ}]},{type:a,value:bR},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bS}]},{type:a,value:" \u002Ff YOUR_PFX_HERE \u002Ftd sha256 \u002Ftr http:\u002F\u002Ftimestamp.sectigo.com\u002Frfc3161 "},{type:b,tag:c,props:{className:[d,G]},children:[{type:a,value:bT}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"PS: I would also suggest adding the "},{type:b,tag:h,props:{},children:[{type:a,value:"\u002Ffd SHA256"}]},{type:a,value:" flag, as that instructs "},{type:b,tag:h,props:{},children:[{type:a,value:U}]},{type:a,value:" to use the stronger SHA256 and not SHA1 for the actual signature."}]}]},excerpt:{type:Q,children:[{type:b,tag:g,props:{},children:[{type:a,value:bJ},{type:b,tag:j,props:{href:bK,rel:[q,r,s],target:t},children:[{type:a,value:av}]},{type:a,value:bL},{type:b,tag:h,props:{},children:[{type:a,value:U}]},{type:a,value:bM}]}]},dir:at,path:"\u002Farticles\u002F2022-08-27-fixing-the-error-signersign-failed-during-signtool-codesigning",extension:au,createdAt:Y,updatedAt:Y,cleanedSlug:"fixing-the-error-signersign-failed-during-signtool-codesigning"},{slug:"2022-08-20-fixing-the-expecting-trusted-certificate-error-with-sectigo-certificates",description:"The other day, I finally received the code-signing certificate from Sectigo. In the confirmation email, they explained the steps to download the certificate, and after following them, I found myself with a user.crt file.",layout:ah,title:bU,author:ai,date:"2022-08-20T00:00:00.000Z",categories:"digital certificates certificate sectigo comodo code sign windows openssl",social_title:bU,toc:[],body:{type:Q,children:[{type:b,tag:g,props:{},children:[{type:a,value:bV},{type:b,tag:h,props:{},children:[{type:a,value:T}]},{type:a,value:bW}]},{type:a,value:e},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Firstly, I wanted to make sure that the certificate matched my private key, so I tried the steps explained in "},{type:b,tag:j,props:{href:"https:\u002F\u002Fsupport.comodo.com\u002Findex.php?\u002FKnowledgebase\u002FArticle\u002FView\u002F684\u002F17\u002Fhow-do-i-verify-that-a-private-key-matches-a-certificate-openssl",rel:[q,r,s],target:t},children:[{type:a,value:"this Comodo article"}]},{type:a,value:m}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"I started by getting the private key’s modulus hash with:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[E,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:be},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:N}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:"private"}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:H}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:ac}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Then, I tried doing the same with the certificate:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[E,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:af},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:N}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:O}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:ac}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Ideally, the two output would match, and that would indicate a correct certificate\u002Fprivate key pair."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Unfortunately, the second command crashed with this message:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[E,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:bf},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bj}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,bk,bl]},children:[{type:a,value:bm}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bo},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:bq},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:D}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bs}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,_]},children:[{type:a,value:bt}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:b,tag:c,props:{className:[d,ap]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:n}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bv}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bw}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After a bit of researching, I found out that the "},{type:b,tag:h,props:{},children:[{type:a,value:T}]},{type:a,value:" file downloaded from Sectigo was not in the correct "},{type:b,tag:h,props:{},children:[{type:a,value:"CRT"}]},{type:a,value:" format. Luckily, the solution was converting the certificate to the correct one, as explained in "},{type:b,tag:j,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F36565316\u002Fssl-unable-to-load-certificate\u002F51290883#51290883",rel:[q,r,s],target:t},children:[{type:a,value:"this Stackoverflow question"}]},{type:a,value:", with:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[E,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:af},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"inform "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"DER"}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:N}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:O}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:"out certificate"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:O}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"After this command, OpenSSL produced a new "},{type:b,tag:h,props:{},children:[{type:a,value:bx}]},{type:a,value:" file with the correct CRT format, which we could then use:"}]},{type:a,value:e},{type:b,tag:y,props:{className:[z]},children:[{type:b,tag:A,props:{className:[E,B]},children:[{type:b,tag:h,props:{},children:[{type:a,value:af},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,L]},children:[{type:a,value:N}]},{type:a,value:" certificate"},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:O}]},{type:a,value:l},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:ac}]}]}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Luckily, the hash of the private key’s modulo was equal to the certificate one, so we had a matching pair!"}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"The same workaround is likely to work with Comodo certificates."}]},{type:a,value:e},{type:b,tag:g,props:{},children:[{type:a,value:"Up next: it’s finally time to code-sign "},{type:b,tag:j,props:{href:"https:\u002F\u002Fespanso.org\u002F",rel:[q,r,s],target:t},children:[{type:a,value:av}]},{type:a,value:" on Windows"}]}]},excerpt:{type:Q,children:[{type:b,tag:g,props:{},children:[{type:a,value:bV},{type:b,tag:h,props:{},children:[{type:a,value:T}]},{type:a,value:bW}]}]},dir:at,path:"\u002Farticles\u002F2022-08-20-fixing-the-expecting-trusted-certificate-error-with-sectigo-certificates",extension:au,createdAt:Y,updatedAt:Y,cleanedSlug:"fixing-the-expecting-trusted-certificate-error-with-sectigo-certificates"}]}],fetch:{},mutations:void 0}}("text","element","span","token","\n","operator","p","code","punctuation","a","li"," ",".",":","-","property-access","nofollow","noopener","noreferrer","_blank","true",-1,"icon","icon-link","div","nuxt-content-highlight","pre","line-numbers","strong","\u002F","language-javascript","constant","string","key",2,"h2","ul","keyword","em","in","crt",3,"root","h3","|","user.crt","signtool","atrule","{","}","2022-09-21T19:26:19.103Z","blockquote","number","Insert the ","modulus ","noout "," openssl md5\n","Notes","h1","openssl x509 ","language-bash","post","Federico Terzi","https:\u002F\u002Ffedericoterzi.com\u002Fblog\u002Fautomatic-code-signing-and-notarization-for-macos-apps-using-github-actions","openssl","ol","PRIVATEKEY",")"," user","maybe-class-name","pfx","\n    "," $","\u002Farticles",".md","Espanso","choosing-a-certificate-authority","Choosing a Certificate Authority","notes","buying-an-ov-certificate-from-sectigo","Buying an OV certificate from Sectigo","generating-a-certificate-signing-request-csr","Generating a Certificate Signing Request (CSR)","completing-the-verification-process","Completing the verification process","verify-that-the-certificate-and-private-key-match","Verify that the Certificate and Private key match","troubleshooting-expecting-trusted-certificate-error","convert-the-certificate-to-pfx-format","Convert the certificate to PFX format","test-the-code-signing-process-manually","Test the code-signing process manually","a-note-on-ev-certificates","A note on EV certificates","converting-the-certificate-to-base64","Converting the certificate to base64","preparing-github-secrets","Preparing GitHub Secrets","automating-the-code-sign-process","Automating the code-sign process","notes-1","alternative-approaches","Alternative approaches","After our previous article on ","automatic code-signing for macOS applications",", we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines.","http:\u002F\u002FCodeSigningStore.com","CodeSigningStore.com","&","'C:\\Program Files\\Git\\usr\\bin\\openssl.exe'","PRIVATEKEY.key","MYCSR.csr","openssl rsa ","unable to load certificate\n","34359836736","error","0909006C","PEM","literal-property","property","routines","get_name","no start line","crypto","pem","pem_lib","c","745","Expecting","TRUSTED","CERTIFICATE","certificate.crt","codesign.pfx","signtool.exe","\"C:\\Program Files (x86)\\Windows Kits\\10\\bin\\10.0.19041.0\\x86\\signtool\"","\"\u003CPASSWORD_HERE\u003E\"","SectigoPublicCodeSigningRootR46_AAA","CODESIGN_BASE64","CODESIGN_PWD","CODESIGN_INTERMEDIATE_BASE64","https:\u002F\u002Fgithub.com\u002Fespanso\u002Fespanso\u002Fpull\u002F1352\u002Ffiles","https:\u002F\u002Fgithub.com\u002FDana-Prajea\u002Fcode-sign-action","Fixing “Error: SignerSign() failed.” during SignTool code-signing","Today I was working on the automatic code-signing CI for ","https:\u002F\u002Fespanso.org",". As suggested by various articles, I went ahead and tried to sign the executable with this "," command:","signtool.exe sign \u002Fv \u002Fp ","\u003C","your PFX password","\u003E"," \u002Fac ","'CROSS_SIGNED_SECTIGO_CA_HERE'","'FULL_PATH_TO_FILE_TO_SIGN'","Fixing the “Expecting: TRUSTED CERTIFICATE” error with Sectigo certificates","The other day, I finally received the code-signing certificate from Sectigo. In the confirmation email, they explained the steps to download the certificate, and after following them, I found myself with a "," file.")));
__NUXT_JSONP__("/", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy){return {data:[{articles:[{slug:"2022-10-17-solving-github-status-stuck-on-pending-with-circlecis-approvals",description:"At Anima, we are always looking for new ways to automate our workflows. One of these efforts involved creating a new CircleCI pipeline to automatically deploy some NPM packages, removing the need for tedious manual work. The plan was straightforward: once started, the pipeline would bump the version of our packages (using Lerna), build them and finally publish them on our NPM registry.",layout:ap,title:aJ,author:aq,date:"2022-10-17T00:00:00.000Z",categories:"circle ci circleci github status pending stuck approval",social_title:aJ,toc:[{id:aK,depth:G,text:aL},{id:aM,depth:G,text:aN},{id:aO,depth:G,text:aP},{id:ag,depth:Q,text:T},{id:ar,depth:G,text:as}],body:{type:U,children:[{type:b,tag:h,props:{},children:[{type:a,value:aQ},{type:b,tag:k,props:{href:aR,rel:[v,w,x],target:y},children:[{type:a,value:aS}]},{type:a,value:aT},{type:b,tag:k,props:{href:aU,rel:[v,w,x],target:y},children:[{type:a,value:aV}]},{type:a,value:aW}]},{type:a,value:e},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Given that we didn’t want to create a new release for every change pushed on "},{type:b,tag:i,props:{},children:[{type:a,value:"main"}]},{type:a,value:", we decided to use CircleCI’s manual approvals as “deployment gates”. The idea was to have the project owner decide when to perform a release by "},{type:b,tag:J,props:{},children:[{type:a,value:"approving"}]},{type:a,value:" it through the CircleCI UI."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In practice, this can be easily implemented by using CircleCI’s job dependencies. For example, starting from a workflow in which we always run the deploy, such as:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[V,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:at},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" build\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"We could decide to only run the deploy after a manual approval with:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[V,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:at},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:aY},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"approval\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"With this configuration, the "},{type:b,tag:i,props:{},children:[{type:a,value:aa}]},{type:a,value:" job would only be started if both the "},{type:b,tag:i,props:{},children:[{type:a,value:"build"}]},{type:a,value:" succeeded and the "},{type:b,tag:i,props:{},children:[{type:a,value:au}]},{type:a,value:" job was manually approved."}]},{type:a,value:e},{type:b,tag:H,props:{id:aK},children:[{type:b,tag:k,props:{href:"#the-problem-github-status-gets-stuck-on-pending-for-unapproved-workflows",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:aL}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"This approach worked flawlessly for our use-case, except for a small (but really annoying) problem: "},{type:b,tag:z,props:{},children:[{type:a,value:"approval jobs would always appear as “pending” on GitHub statuses unless manually approved."}]},{type:a,value:" Although this was not a blocker, we lost the ability to understand at a glance which commits passed all CI checks."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:av,props:{alt:aw,src:"\u002Fposts\u002F2022-10-17-solving-github-status-stuck-on-pending-with-circlecis-approvals\u002Fimage0.png"},children:[]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After a bit of digging, I realized we weren’t the only ones struggling with this issue, as it was "},{type:b,tag:k,props:{href:"https:\u002F\u002Fcircleci.canny.io\u002Fcloud-feature-requests\u002Fp\u002Fshow-overall-all-checks-have-passed-status-in-github-even-on-builds-with-incompl",rel:[v,w,x],target:y},children:[{type:a,value:"one of the most requested features on CircleCI’s feedback channels"}]},{type:a,value:". Unfortunately, the thread didn’t offer any useful information or workaround, so we were stuck with this sub-optimal solution."}]},{type:a,value:e},{type:b,tag:H,props:{id:aM},children:[{type:b,tag:k,props:{href:"#the-workaround-overriding-github-commit-statuses-manually",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:aN}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Fast forward a few weeks, and I find myself developing a new CI integration. While going through the GitHub API documentation, I stumble upon the "},{type:b,tag:k,props:{href:"https:\u002F\u002Fdocs.github.com\u002Fen\u002Frest\u002Fcommits\u002Fstatuses",rel:[v,w,x],target:y},children:[{type:a,value:"GitHub’s Commit Status API"}]},{type:a,value:", which allows users to programmatically access commit statuses."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Among other things, you can "},{type:b,tag:J,props:{},children:[{type:a,value:"create"}]},{type:a,value:" a new commit status with this HTTP request:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[V,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:"curl \\\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"X POST \\\n  "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"-H \"Accept"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" application\u002Fvnd.github+json\" \\\n  "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"-H \"Authorization"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" Bearer \u003CYOUR"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"TOKEN"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ac}]},{type:a,value:"\" \\\n  https"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\u002F\u002Fapi.github.com\u002Frepos\u002FOWNER\u002FREPO\u002Fstatuses\u002FSHA \\\n  "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"d '"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:a,value:a$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ba}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"https:\u002F\u002Fexample.com\u002Fbuild\u002Fstatus\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:bc},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"The build succeeded!\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:bd},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"continuous-integration\u002Fjenkins\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:"'\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"What captures my attention is the "},{type:b,tag:i,props:{},children:[{type:a,value:ai}]},{type:a,value:" field, which acts as a sort of "},{type:b,tag:J,props:{},children:[{type:a,value:"id"}]},{type:a,value:" for the commit status. While experimenting, I ask myself: what happens if you specify a "},{type:b,tag:i,props:{},children:[{type:a,value:ai}]},{type:a,value:" value of an existing status? I was expecting the "},{type:b,tag:i,props:{},children:[{type:a,value:ai}]},{type:a,value:" to be specific to a given GitHub’s access token, but that turned out to be an incorrect assumption. As it turns out, "},{type:b,tag:z,props:{},children:[{type:a,value:"specifying the same"}]},{type:a,value:p},{type:b,tag:z,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:ai}]}]},{type:a,value:p},{type:b,tag:z,props:{},children:[{type:a,value:"of an existing status overrides the status, regardless of the entity that created it… Bingo!"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"We finally got a possible workaround: we could wait for CircleCI’s approval status to appear on GitHub’s commit statuses, and then override it using the above request to appear as successful."}]},{type:a,value:e},{type:b,tag:H,props:{id:aO},children:[{type:b,tag:k,props:{href:"#the-solution-a-bash-script-to-patch-commit-statuses",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:aP}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"I spent the following 20 minutes putting together a script that would:"}]},{type:a,value:e},{type:b,tag:aj,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Wait for the approval status to appear on the GitHub commit statuses"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Override it with a “success” state"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Here it is (make sure to replace the values at the top with the correct ones):"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[V,E]},children:[{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{className:[d,ak]},children:[{type:a,value:"#!\u002Fbin\u002Fbash"}]},{type:a,value:"\n\nset "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"e\n\n"},{type:b,tag:c,props:{className:[d,ak]},children:[{type:a,value:"# Note that the CIRCLECI_JOB_NAME should also include the workflow name"}]},{type:a,value:"\nCIRCLECI_JOB_NAME=\"your"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"workflow\u002Fdeploy"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"approval\"\nREPO_NAME=\"your"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"repo"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"name\"\nREPO_OWNER=\"your"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"github"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"account\"\n"},{type:b,tag:c,props:{className:[d,ak]},children:[{type:a,value:"# Note: you should also set a valid GitHub token in the GITHUB_ACCESS_TOKEN variable"}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"echo \"Patching approval job named"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" $CIRCLECI_JOB_NAME\"\n\nfor i in "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:a,value:"1..10"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:"\ndo\n  echo \"waiting for status to appear"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bf}]},{type:a,value:"\"\n\n  sleep 10\n\n  curl "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"request GET \\\n    "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\u002F\u002Fapi.github.com\u002Frepos\u002F$REPO_OWNER\u002F$REPO_NAME\u002Fstatuses\u002F$CIRCLE_SHA1\" \\\n    "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bh}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" application\u002Fvnd.github.v3+json' \\\n    "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bi}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" Bearer $GITHUB_ACCESS_TOKEN\" "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ac}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"statuses.json\n\n  cat commit"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"statuses.json\n  cat commit"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"statuses.json "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:N}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"r '."},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bl}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bm}]},{type:a,value:".context' "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:ac}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"statuses.txt\n\n  "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"if grep -q \"ci\u002Fcircleci"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" $CIRCLECI_JOB_NAME\" \"commit"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"statuses.txt\"; then\n    echo \"status appeared"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:" patching the pending state\"\n    URL=$(cat commit"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"statuses.json"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:N}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"r "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"arg name \"$CIRCLECI_JOB_NAME\" "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"c 'map(select(.context "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:N}]},{type:a,value:" contains($name))) "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:N}]},{type:a,value:" ."},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bl}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bm}]},{type:a,value:".target_url' "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:N}]},{type:a,value:" head "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"1)\n\n    curl "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"request POST \\\n      "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\u002F\u002Fapi.github.com\u002Frepos\u002F$REPO_OWNER\u002F$REPO_NAME\u002Fstatuses\u002F$CIRCLE_SHA1\" \\\n      "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bh}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" application\u002Fvnd.github.v3+json' \\\n      "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bi}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" Bearer $GITHUB_ACCESS_TOKEN\" \\\n      "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"--header 'Content-Type"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" application\u002Fjson' \\\n      "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"data '"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:a$}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ba}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bb}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" \"'\"$URL\"'\""},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"Patched pending state, please visit circleCI to start the approval.\""}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bd}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" \"ci\u002Fcircleci"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" '\"$CIRCLECI_JOB_NAME\"'\"\n      "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:"'\n\n    exit 0\n  fi\ndone\n\necho \"Could not patch CircleCI approval"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:O}]},{type:a,value:" timed out\"\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In order for it to work, it has to be spawned roughly at the same time as the approval job, so having the same job dependencies is important. For example, starting from the case described at the top of our article, we could refactor the pipeline to:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[V,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:at},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:aY},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:$},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" patch"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"approval"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"status\n          "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:" build "},{type:b,tag:c,props:{className:[d,ak]},children:[{type:a,value:"# same dependency as approval, so that they are triggered at the same time"}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"approval\n\n"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:bf}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"patch-deploy-approval-status"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"steps"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:_},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bo}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"Patch deploy approval status\""}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"command"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,bp,A]},children:[{type:a,value:"\n          ... the code of the script above"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:R,props:{id:ag},children:[{type:b,tag:k,props:{href:bq,ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:T}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"You will need to have "},{type:b,tag:i,props:{},children:[{type:a,value:"jq"}]},{type:a,value:" and "},{type:b,tag:i,props:{},children:[{type:a,value:"curl"}]},{type:a,value:" installed for the script to work"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"You will need to store a GitHub token (a personal access token could work as well) in a CircleCI environment variable for the API request to work"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:ar},children:[{type:b,tag:k,props:{href:br,ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:as}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After more than a month of endless pending states, we finally got our green checks back!"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:av,props:{alt:aw,src:"\u002Fposts\u002F2022-10-17-solving-github-status-stuck-on-pending-with-circlecis-approvals\u002Fimage1.png"},children:[]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Hopefully, CircleCI will fix this behavior soon, but in the meantime, this workaround should work well for our purposes."}]}]},excerpt:{type:U,children:[{type:b,tag:h,props:{},children:[{type:a,value:aQ},{type:b,tag:k,props:{href:aR,rel:[v,w,x],target:y},children:[{type:a,value:aS}]},{type:a,value:aT},{type:b,tag:k,props:{href:aU,rel:[v,w,x],target:y},children:[{type:a,value:aV}]},{type:a,value:aW}]}]},dir:ax,path:"\u002Farticles\u002F2022-10-17-solving-github-status-stuck-on-pending-with-circlecis-approvals",extension:ay,createdAt:Y,updatedAt:Y,cleanedSlug:"solving-github-status-stuck-on-pending-with-circlecis-approvals"},{slug:"2022-09-21-automatic-codesigning-on-windows-using-github-actions",description:"After our previous article on automatic code-signing for macOS applications, we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines.",layout:ap,title:"Automatic Code-signing on Windows using GitHub Actions",author:aq,date:"2022-09-21T00:00:00.000Z",categories:"code sign signing signtool certificate sectigo authority ci automatic github actions",social_title:"Automatic Code-signing on Windows",social_subtitle:"using GitHub Actions",toc:[{id:bs,depth:G,text:bt},{id:ag,depth:Q,text:T},{id:bu,depth:G,text:bv},{id:bw,depth:Q,text:bx},{id:by,depth:Q,text:bz},{id:bA,depth:G,text:bB},{id:bC,depth:Q,text:"Troubleshooting “Expecting: TRUSTED CERTIFICATE” error"},{id:bD,depth:G,text:bE},{id:bF,depth:G,text:bG},{id:bH,depth:G,text:bI},{id:bJ,depth:G,text:bK},{id:bL,depth:G,text:bM},{id:bN,depth:G,text:bO},{id:bP,depth:Q,text:T},{id:bQ,depth:Q,text:bR}],body:{type:U,children:[{type:b,tag:h,props:{},children:[{type:a,value:bS},{type:b,tag:k,props:{href:az,rel:[v,w,x],target:y},children:[{type:a,value:bT}]},{type:a,value:bU}]},{type:a,value:e},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"The article summarizes the steps we went through to code-sign Espanso, a cross-platform text expander. If you get stuck in the process, I also recommend checking out "},{type:b,tag:k,props:{href:"https:\u002F\u002Fgithub.com\u002Fespanso\u002Fespanso",rel:[v,w,x],target:y},children:[{type:a,value:"Espanso’s source code"}]},{type:a,value:u}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:am,props:{id:"getting-a-code-signing-certificate"},children:[{type:b,tag:k,props:{href:"#getting-a-code-signing-certificate",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:"Getting a Code-signing Certificate"}]},{type:a,value:e},{type:b,tag:H,props:{id:bs},children:[{type:b,tag:k,props:{href:"#choosing-a-certificate-authority",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bt}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Before coding our way into the automatic CI pipeline, we first need to obtain a Code-signing certificate. There are multiple companies you can get one from, so the first challenge is to figure out which one to choose. We could talk to great lengths about the pros\u002Fcons of the various providers, but for the sake of this article, let’s summarize it by asking two questions:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Are you trying to sign the executable as a company or as an individual?"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"What is your budget?"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"These are my recommendations depending on the above answers:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:z,props:{},children:[{type:a,value:"Company with a large budget"}]},{type:a,value:": buy an EV certificate from DigiCert, those are the most expensive (currently at ~700$\u002Fyear) but they offer the best reputation and customer support."}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:z,props:{},children:[{type:a,value:"Individual with a large budget"}]},{type:a,value:": buy an OV certificate from DigiCert. These are still expensive (~500$\u002Fyear), but don’t offer as much reputation as an EV certificate (your users will still see Windows’ SafeScreen at first). Unfortunately, individuals can’t buy EV certificates, so this is likely the best you could find"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:z,props:{},children:[{type:a,value:"Individual with a small budget"}]},{type:a,value:": buy an OV certificate from a Sectigo reseller, like CodeSigningStore.com. I went down this route as Espanso is an open-source project and I had to be careful about the budget. Overall, the experience was "},{type:b,tag:J,props:{},children:[{type:a,value:"ok"}]},{type:a,value:", and after about 3 weeks of back and forth with their customer support, I managed to get a valid certificate at the price of ~70$\u002Fyear, thus significantly cheaper than the other options"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In short, if you are a company I recommend buying an EV certificate from DigiCert, as they offer the best reputation for your executable. On the other hand, if you are looking to code-sign your program (maybe an open-source project) on a budget, then an OV certificate from a reseller like "},{type:b,tag:k,props:{href:bV,rel:[v,w,x],target:y},children:[{type:a,value:bW}]},{type:a,value:" could be an option."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"The next section will describe the process we went through to get an OV certificate from Sectigo. Feel free to jump to the next one if you already have a certificate or you decide to use a different provider."}]},{type:a,value:e},{type:b,tag:R,props:{id:ag},children:[{type:b,tag:k,props:{href:bq,ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:T}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"I highly recommend buying 3 years certificates. Despite being more expensive, they will save you from the “overhead” of re-applying for a certificate each year. Moreover, some certificates (like the OV version) require time to build a reputation, and buying a 3 years certificate means you won’t have to rebuild that reputation once a year."}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"If you choose an EV certificate, keep in mind that you will need to have an hardware token (a USB key shipped to you by the certificate authority) connected to the machine while performing the digital signature. This has an important consequence: "},{type:b,tag:z,props:{},children:[{type:a,value:"you won’t be able to use GitHub-hosted CI agents to perform the digital signature"}]},{type:a,value:", as you can’t connect the physical USB token to them. There are several possible workarounds, but a common one used in professional environments consists in running "},{type:b,tag:J,props:{},children:[{type:a,value:"self-hosted"}]},{type:a,value:" runners for your Windows CI integration. In short, you would keep a physical server inside your company’s office with the hardware token always connected. When a CI build is scheduled, GitHub (or your CI provider of choice) will run the build on your server (having the hardware key connected) instead of a cloud VM."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:bu},children:[{type:b,tag:k,props:{href:"#buying-an-ov-certificate-from-sectigo",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bv}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After a thorough evaluation of the possible options, I decided to get an OV certificate from Sectigo (or to be more precise, a reseller), as it was the cheapest option I could find with "},{type:b,tag:J,props:{},children:[{type:a,value:"acceptable"}]},{type:a,value:" reviews online (just search for “Comodo reviews” online to get an idea)."}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"For context: Comodo was rebranded to Sectigo in 2018, but there is the same company behind them."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"While you could buy a code-signing certificate directly from Sectigo’s website, I decided to buy it from a reseller, as the end result would be similar at a fraction of the price. I personally choose "},{type:b,tag:k,props:{href:bV,rel:[v,w,x],target:y},children:[{type:a,value:bW}]},{type:a,value:" as it seemed the reseller "},{type:b,tag:J,props:{},children:[{type:a,value:"with the least bad reviews online"}]},{type:a,value:" (not exactly reassuring, I know)."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"So I went ahead and paid 207$ for a 3 years Sectigo certificate."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Shortly after, I received an email with a link to submit a "},{type:b,tag:J,props:{},children:[{type:a,value:"Certificate Signing Request"}]},{type:a,value:" (CSR), a file containing your public key and other information. This will be used by the certificate authority to generate the certificate."}]},{type:a,value:e},{type:b,tag:R,props:{id:bw},children:[{type:b,tag:k,props:{href:"#generating-a-certificate-signing-request-csr",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bx}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"As discussed above, we need to submit a CSR to the Certificate Authority to generate a certificate. While there are multiple ways to create a CSR, these are the steps to generate one using "},{type:b,tag:i,props:{},children:[{type:a,value:aA}]},{type:a,value:j}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Note: If you are on Windows, the easiest way to get "},{type:b,tag:i,props:{},children:[{type:a,value:aA}]},{type:a,value:" is by using the executable distributed as part of a "},{type:b,tag:i,props:{},children:[{type:a,value:"git"}]},{type:a,value:" installation. In my case, after installing Git, I had access to the "},{type:b,tag:i,props:{},children:[{type:a,value:"openssl.exe"}]},{type:a,value:" executable in this path: "},{type:b,tag:i,props:{},children:[{type:a,value:"'C:\\Program Files\\Git\\usr\\bin\\openssl.exe"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:aj,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Open a Powershell terminal"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Run this command to launch the generation wizard:"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,S]},children:[{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bX}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bY}]},{type:a,value:" req "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:"newkey rsa"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"4096"}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:"keyout "},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:m}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:"out "},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:"MYCSR"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"csr"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:aj,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"You will be presented with a series of prompts:\n"},{type:b,tag:aj,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Create and verify a password. This is the password used to protect your private key, "},{type:b,tag:z,props:{},children:[{type:a,value:"make sure to save it somewhere, as we will need it later"}]}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:af},{type:b,tag:z,props:{},children:[{type:a,value:"Country name"}]},{type:a,value:", a two-letter code for your country (see a"},{type:b,tag:k,props:{href:"https:\u002F\u002Fwww.ssl.com\u002Fcountry-codes\u002F",rel:[v,w,x],target:y},children:[{type:a,value:" list of possible values"}]},{type:a,value:aD}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:af},{type:b,tag:z,props:{},children:[{type:a,value:"Locality name"}]},{type:a,value:", the name of your city or town"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:af},{type:b,tag:z,props:{},children:[{type:a,value:"Organization name"}]},{type:a,value:", the name of your company\u002Forganization\u002Fpersonal name"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:af},{type:b,tag:z,props:{},children:[{type:a,value:"Common name"}]},{type:a,value:", the name of your website (such as "},{type:b,tag:i,props:{},children:[{type:a,value:"espanso.org"}]},{type:a,value:aD}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:af},{type:b,tag:z,props:{},children:[{type:a,value:"Email address"}]}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Skip the challenge password"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"At the end of this process, you should find a "},{type:b,tag:i,props:{},children:[{type:a,value:bZ}]},{type:a,value:" file containing your private key and a "},{type:b,tag:i,props:{},children:[{type:a,value:b_}]},{type:a,value:" file containing your certificate signing request. Keep both of them in a safe place as we will need them soon"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Submit the "},{type:b,tag:i,props:{},children:[{type:a,value:b_}]},{type:a,value:" file to the Certificate Authority"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:R,props:{id:by},children:[{type:b,tag:k,props:{href:"#completing-the-verification-process",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bz}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After your request has been sent, the Certificate Authority will request additional information to verify your identity. This will usually take a few days or weeks, but in the end, you should receive a certificate."}]},{type:a,value:e},{type:b,tag:am,props:{id:"preparing-the-certificate"},children:[{type:b,tag:k,props:{href:"#preparing-the-certificate",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:"Preparing the Certificate"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After the certificate has been issued, we need to turn it into a format compatible with our target CI pipeline. The following steps are necessary for Sectigo-issued certificates, but keep in mind the process might be slightly different with other Certificate Authorities. Our goal is to obtain the code-signing certificate in "},{type:b,tag:i,props:{},children:[{type:a,value:"PFX"}]},{type:a,value:" format, encoded as base64."}]},{type:a,value:e},{type:b,tag:H,props:{id:bA},children:[{type:b,tag:k,props:{href:"#verify-that-the-certificate-and-private-key-match",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bB}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Before diving into the actual conversion process, it’s a good idea to verify that the certificate being issued matches our private key (the one generated with the CSR)."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"To verify that, we need to run two commands:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,S]},children:[{type:b,tag:i,props:{},children:[{type:a,value:"openssl rsa "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:b$},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:ca},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,an]},children:[{type:a,value:aE}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:m}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:N}]},{type:a,value:cb}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"and also (with "},{type:b,tag:i,props:{},children:[{type:a,value:aF}]},{type:a,value:" being the certificate issued by the CA):"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,S]},children:[{type:b,tag:i,props:{},children:[{type:a,value:"openssl x509 "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:b$},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:ca},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,an]},children:[{type:a,value:aE}]},{type:a,value:" user"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aG}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:N}]},{type:a,value:cb}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"If the output of the two previous commands match, then the certificate is correct!"}]},{type:a,value:e},{type:b,tag:R,props:{id:bC},children:[{type:b,tag:k,props:{href:"#troubleshooting-expecting-trusted-certificate-error",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:"Troubleshooting “"},{type:b,tag:z,props:{},children:[{type:a,value:"Expecting: TRUSTED CERTIFICATE” error"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In my case, the previous commands returned the following error:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,S]},children:[{type:b,tag:i,props:{},children:[{type:a,value:"unable to load certificate\n"},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"34359836736"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:a,value:"error"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:a,value:"0909006C"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:"PEM"}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,"literal-property","property"]},children:[{type:a,value:"routines"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:a,value:"get_name"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:a,value:"no start line"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:a,value:"crypto"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"pem"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"pem_lib"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"c"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"745"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,cc]},children:[{type:a,value:"Expecting"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:"TRUSTED"}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:"CERTIFICATE"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"This error is due to the "},{type:b,tag:i,props:{},children:[{type:a,value:aF}]},{type:a,value:" file being encoded in the wrong format. Luckily, we can solve this problem by following "},{type:b,tag:k,props:{href:"https:\u002F\u002Ffedericoterzi.com\u002Fblog\u002Ffixing-the-expecting-trusted-certificate-error-with-sectigo-certificates",rel:[v,w,x],target:y},children:[{type:a,value:"these steps"}]},{type:a,value:u}]},{type:a,value:e},{type:b,tag:H,props:{id:bD},children:[{type:b,tag:k,props:{href:"#convert-the-certificate-to-pfx-format",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bE}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After verifying that the certificate matches our private key, we are ready to “bundle” all of them together into a PFX certificate. We will use "},{type:b,tag:i,props:{},children:[{type:a,value:aA}]},{type:a,value:" for this step as well:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,S]},children:[{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bX}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bY}]},{type:a,value:" pkcs12 "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,an,"module"]},children:[{type:a,value:"export"}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:"out codesign"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aH}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:"inkey "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\\"},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:aC}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:m}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,an]},children:[{type:a,value:aE}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:a,value:"\\certificate"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aG}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Where:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:bZ}]},{type:a,value:" is the private key we generated during the CSR step."}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:"certificate.crt"}]},{type:a,value:" is the public certificate issued by the Certificate Authority. In the case of Sectigo certificates, "},{type:b,tag:z,props:{},children:[{type:a,value:"this file is not the"}]},{type:a,value:p},{type:b,tag:z,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:aF}]}]},{type:a,value:" certificate directly issued by the CA, but refers to the converted certificate after "},{type:b,tag:k,props:{href:"https:\u002F\u002Ffedericoterzi.com\u002Fblog\u002Ffixing-the-expecting-trusted-certificate-error-with-sectigo-certificates\u002F",rel:[v,w,x],target:y},children:[{type:a,value:"following these steps"}]},{type:a,value:u}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:cd}]},{type:a,value:" is the output PFX certificate file."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:bF},children:[{type:b,tag:k,props:{href:"#test-the-code-signing-process-manually",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bG}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Before diving into the process to build an automatic signing pipeline, let’s verify that the code-signing certificate works as expected by attempting a manual signature."}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"We will need Microsoft’s "},{type:b,tag:i,props:{},children:[{type:a,value:ce}]},{type:a,value:" to perform the following steps. You can get it by installing the Windows 10 SDK using Visual Studio. More info on this "},{type:b,tag:k,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F31869552\u002Fhow-to-install-signtool-exe-for-windows-10",rel:[v,w,x],target:y},children:[{type:a,value:"StackOverflow thread"}]},{type:a,value:u}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"We can sign an executable by opening a terminal and running the following command:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,S]},children:[{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cf}]},{type:a,value:" sign "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"fd "},{type:b,tag:c,props:{className:[d,P]},children:[{type:a,value:"SHA256"}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"p "},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cg}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"ac "},{type:b,tag:c,props:{className:[d,cc]},children:[{type:a,value:ch}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aG}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"f codesign"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aH}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"tr http"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"timestamp"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"sectigo"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"com"}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"rfc3161 "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:I}]},{type:a,value:"td sha256 yourProgram"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"exe"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"where:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:cf}]},{type:a,value:" is the path to "},{type:b,tag:i,props:{},children:[{type:a,value:Z}]},{type:a,value:". This path will vary depending on the Windows 10 SDK version being installed, so make sure to update the path accordingly."}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:cg}]},{type:a,value:" should be replaced by your private key’s password (the one we choose during the CSR generation)"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:"SectigoPublicCodeSigningRootR46_AAA.crt"}]},{type:a,value:" is the path to an appropriate "},{type:b,tag:J,props:{},children:[{type:a,value:"intermediate certificate"}]},{type:a,value:". You can download the appropriate ones for "},{type:b,tag:k,props:{href:"https:\u002F\u002Fsupport.sectigo.com\u002Farticles\u002FKnowledge\u002FSectigo-Intermediate-Certificates",rel:[v,w,x],target:y},children:[{type:a,value:"Sectigo here"}]},{type:a,value:" and for "},{type:b,tag:k,props:{href:"https:\u002F\u002Fknowledge.digicert.com\u002Falerts\u002Fcode-signing-new-minimum-rsa-keysize.html",rel:[v,w,x],target:y},children:[{type:a,value:"DigiCert here"}]},{type:a,value:u}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:cd}]},{type:a,value:" is the path to the certificate we generated in the previous step."}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:"yourProgram.exe"}]},{type:a,value:" is the path to the executable we want to sign"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After running this command, right-click on the executable and choose “Properties” \u003E Digital Signatures tab. If everything was correct, you should now see an entry for your signature, as shown in the image below."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:av,props:{alt:aw,src:"\u002Fposts\u002F2022-09-21-automatic-codesigning-on-windows-using-github-actions\u002Fimage0.png"},children:[]}]},{type:a,value:e},{type:b,tag:ae,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"If you don’t see a “Digital Signatures” tab, then it means the signature process didn’t complete successfully. Make sure to double check all the paths used in the above command."}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:am,props:{id:"automating-the-signing-process-on-a-ci-pipeline"},children:[{type:b,tag:k,props:{href:"#automating-the-signing-process-on-a-ci-pipeline",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:"Automating the signing process on a CI pipeline"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Now that we successfully signed an executable with our new certificate, we are ready to automate the process as part of a CI pipeline. For this example, we are going to use GitHub Actions as platform, but these steps could be adapted to most providers with minimal changes."}]},{type:a,value:e},{type:b,tag:H,props:{id:bH},children:[{type:b,tag:k,props:{href:"#a-note-on-ev-certificates",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bI}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"If you are using a company’s EV certificate, you will likely need a hardware token (a USB key sent by the certificate authority) to sign your executables. As a result, "},{type:b,tag:z,props:{},children:[{type:a,value:"you won’t be able to use cloud-hosted CI agents"}]},{type:a,value:", as there is no way for you to connect the hardware token there."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In these scenarios, a common solution is to maintain a physical server in your company’s office with the hardware token always connected. At this point, you can use GitHub’s self-hosted runners to execute the CI pipelines from your local server, which will be connected to the required hardware token."}]},{type:a,value:e},{type:b,tag:H,props:{id:bJ},children:[{type:b,tag:k,props:{href:"#converting-the-certificate-to-base64",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bK}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In order to store the certificate as a GitHub Action "},{type:b,tag:J,props:{},children:[{type:a,value:"Secret"}]},{type:a,value:", we need to encode it as base64 string. An easy way to do that on Windows is to run the following command:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,S]},children:[{type:b,tag:i,props:{},children:[{type:a,value:"certutil "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:g}]},{type:a,value:"encode codesign"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:aH}]},{type:a,value:" base64cert"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"txt"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"If you also want to use an intermediate certificate (the "},{type:b,tag:i,props:{},children:[{type:a,value:ch}]},{type:a,value:" one we used above), you should generate the base64 of that one as well."}]},{type:a,value:e},{type:b,tag:H,props:{id:bL},children:[{type:b,tag:k,props:{href:"#preparing-github-secrets",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bM}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"At this point, we are ready to add the information we gathered so far as Secrets. Open your project’s repository and navigate to Settings \u003E Security \u003E Secrets \u003E Actions and add the following variables:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:ci}]},{type:a,value:" should contain the certificate encoded as base64, the one we prepared in the previous section"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:b,tag:i,props:{},children:[{type:a,value:cj}]},{type:a,value:" should contain the private key’s password"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"(Optional) "},{type:b,tag:i,props:{},children:[{type:a,value:ck}]},{type:a,value:" the base64 of the intermediate certificate, if you’re using one"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:H,props:{id:bN},children:[{type:b,tag:k,props:{href:"#automating-the-code-sign-process",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bO}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"At this point, we are finally ready to automate the code-signing process. For the sake of this example, we will sign an executable located in path: "},{type:b,tag:i,props:{},children:[{type:a,value:"target\u002Frelease\u002Fespanso.exe"}]},{type:a,value:" , make sure to update it with the actual path of your program."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"The final Action step configuration will look like the following:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,V]},children:[{type:b,tag:i,props:{},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"name"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:" Sign executable\n  "},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:"env"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:cj}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:a,value:" secrets.CODESIGN_PWD"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:ck}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:a,value:" secrets.CODESIGN_INTERMEDIATE_BASE64 "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:ci}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:L}]},{type:a,value:" secrets.CODESIGN_BASE64"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:M}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,m,o]},children:[{type:a,value:bo}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,bp,A]},children:[{type:a,value:"\n    New-Item -ItemType directory -Path certificate\n    Set-Content -Path certificate\\certificate.txt -Value $env:CODESIGN_BASE64\n    certutil -decode certificate\\certificate.txt certificate\\certificate.pfx\n    Set-Content -Path certificate\\intermediate.txt -Value $env:CODESIGN_INTERMEDIATE_BASE64\n    certutil -decode certificate\\intermediate.txt certificate\\intermediate.crt"}]},{type:a,value:"\n\n    & 'C"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\u002FProgram Files (x86)\u002FWindows Kits\u002F10\u002Fbin\u002F10.0.22621.0\u002Fx86\u002Fsigntool.exe' sign \u002Ffd SHA256 \u002Fp $env"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"CODESIGN_PWD \u002Fac certificate\\intermediate.crt \u002Ff certificate\\certificate.pfx \u002Ftr \"http"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\u002F\u002Ftimestamp.sectigo.com\u002Frfc3161\" \u002Ftd sha256 target\u002Frelease\u002Fespanso.exe\n    \n    Remove"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"Item "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"Recurse "},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:g}]},{type:a,value:"Force certificate\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In a nutshell, these are the steps performed above:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Load the secrets as environmental variables"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Load the base64 certificates and convert them back to their original format"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Invoke "},{type:b,tag:i,props:{},children:[{type:a,value:ce}]},{type:a,value:" with the relevant parameters"}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Remove the temporary certificate files"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:R,props:{id:bP},children:[{type:b,tag:k,props:{href:"#notes-1",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:T}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"If you are not using an intermediate certificate, you can remove the "},{type:b,tag:i,props:{},children:[{type:a,value:"\u002Fac certificate\\intermediate.crt"}]},{type:a,value:" flag and all the lines that contain “intermediate”"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:R,props:{id:bQ},children:[{type:b,tag:k,props:{href:"#alternative-approaches",ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:bR}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"There are also other approaches you might prefer:"}]},{type:a,value:e},{type:b,tag:K,props:{},children:[{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"If your project is written in Rust, you could take inspiration from our PR: "},{type:b,tag:k,props:{href:cl,rel:[v,w,x],target:y},children:[{type:a,value:cl}]}]},{type:a,value:e},{type:b,tag:n,props:{},children:[{type:a,value:"Use a pre-built GitHub Action such as: "},{type:b,tag:k,props:{href:cm,rel:[v,w,x],target:y},children:[{type:a,value:cm}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:am,props:{id:ar},children:[{type:b,tag:k,props:{href:br,ariaHidden:q,tabIndex:r},children:[{type:b,tag:c,props:{className:[s,t]},children:[]}]},{type:a,value:as}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"In this article, we discussed the process to get your Windows program code-signed, starting from the choice of certificate authority, all the way down to a fully automated CI pipeline. The article was mostly focused on Sectigo certificates and GitHub actions, but most steps can be applied to other certificate authorities and CI platforms."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"If you are also distributing your app on macOS, you might also enjoy my article on "},{type:b,tag:k,props:{href:az,rel:[v,w,x],target:y},children:[{type:a,value:"automatic code-signing and notarization for macOS apps"}]},{type:a,value:u}]}]},excerpt:{type:U,children:[{type:b,tag:h,props:{},children:[{type:a,value:bS},{type:b,tag:k,props:{href:az,rel:[v,w,x],target:y},children:[{type:a,value:bT}]},{type:a,value:bU}]}]},dir:ax,path:"\u002Farticles\u002F2022-09-21-automatic-codesigning-on-windows-using-github-actions",extension:ay,createdAt:Y,updatedAt:Y,cleanedSlug:"automatic-codesigning-on-windows-using-github-actions"},{slug:"2022-08-27-fixing-the-error-signersign-failed-during-signtool-codesigning",description:"Today I was working on the automatic code-signing CI for Espanso. As suggested by various articles, I went ahead and tried to sign the executable with this signtool command:",layout:ap,title:cn,author:aq,date:"2022-08-27T00:00:00.000Z",categories:"code sign code-signing signtool sign windows certificate sectigo",social_title:cn,toc:[],body:{type:U,children:[{type:b,tag:h,props:{},children:[{type:a,value:co},{type:b,tag:k,props:{href:cp,rel:[v,w,x],target:y},children:[{type:a,value:cq}]},{type:a,value:cr},{type:b,tag:i,props:{},children:[{type:a,value:Z}]},{type:a,value:cs}]},{type:a,value:e},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[ao,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:ct},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:cu}]},{type:a,value:cv},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ac}]},{type:a,value:cw},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cx}]},{type:a,value:" \u002Ff YOUR_PFX_HERE \u002Ftr http:\u002F\u002Ftimestamp.sectigo.com\u002Frfc3161 "},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cy}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Unfortunately, I was greeted with this cryptic error message:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[ao,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:"SignTool Error: An unexpected internal error has occurred.\nError information: "},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"Error: SignerSign() failed.\""}]},{type:a,value:p},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:"("}]},{type:a,value:"-2146869243\u002F0x80096005"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:aD}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"After a bit of investigation, it turned out to be due to a missing flag in the "},{type:b,tag:i,props:{},children:[{type:a,value:Z}]},{type:a,value:" invocation:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[ao,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:"\u002Ftd sha256\n"}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"This flag instructs "},{type:b,tag:i,props:{},children:[{type:a,value:Z}]},{type:a,value:" to use a SHA256 digest for the RFC 3161 timestamp server, solving the above problem."}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"So in the end, I got it working with the following command:"}]},{type:a,value:e},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[ao,E]},children:[{type:b,tag:i,props:{},children:[{type:a,value:ct},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:cu}]},{type:a,value:cv},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ac}]},{type:a,value:cw},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cx}]},{type:a,value:" \u002Ff YOUR_PFX_HERE \u002Ftd sha256 \u002Ftr http:\u002F\u002Ftimestamp.sectigo.com\u002Frfc3161 "},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cy}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"PS: I would also suggest adding the "},{type:b,tag:i,props:{},children:[{type:a,value:"\u002Ffd SHA256"}]},{type:a,value:" flag, as that instructs "},{type:b,tag:i,props:{},children:[{type:a,value:Z}]},{type:a,value:" to use the stronger SHA256 and not SHA1 for the actual signature."}]}]},excerpt:{type:U,children:[{type:b,tag:h,props:{},children:[{type:a,value:co},{type:b,tag:k,props:{href:cp,rel:[v,w,x],target:y},children:[{type:a,value:cq}]},{type:a,value:cr},{type:b,tag:i,props:{},children:[{type:a,value:Z}]},{type:a,value:cs}]}]},dir:ax,path:"\u002Farticles\u002F2022-08-27-fixing-the-error-signersign-failed-during-signtool-codesigning",extension:ay,createdAt:Y,updatedAt:Y,cleanedSlug:"fixing-the-error-signersign-failed-during-signtool-codesigning"}]}],fetch:{},mutations:void 0}}("text","element","span","token","\n","punctuation","-","p","code",":","a","operator","key","li","atrule"," ","true",-1,"icon","icon-link",".","nofollow","noopener","noreferrer","_blank","strong","string","div","nuxt-content-highlight","pre","line-numbers","property-access",2,"h2","\u002F","em","ul","{","}","|",",","constant",3,"h3","language-javascript","Notes","root","language-yaml","requires","\n            ","2022-10-17T20:20:19.029Z","signtool","\n      "," build\n      ","deploy","\n          ","\u003E","\n        ","blockquote","Insert the ","notes","jobs","context","ol","comment","\n    ","h1","keyword","language-bash","post","Federico Terzi","conclusion","Conclusion","    ","deploy-approval","img","","\u002Farticles",".md","https:\u002F\u002Ffedericoterzi.com\u002Fblog\u002Fautomatic-code-signing-and-notarization-for-macos-apps-using-github-actions","openssl","number","PRIVATEKEY",")","in","user.crt","crt","pfx"," $","Solving GitHub Status stuck on Pending with CircleCI’s Approvals","the-problem-github-status-gets-stuck-on-pending-for-unapproved-workflows","The problem: GitHub status gets stuck on “Pending” for unapproved workflows","the-workaround-overriding-github-commit-statuses-manually","The workaround: overriding GitHub Commit Statuses manually","the-solution-a-bash-script-to-patch-commit-statuses","The solution: a bash script to patch Commit statuses","At ","https:\u002F\u002Fwww.animaapp.com\u002F","Anima",", we are always looking for new ways to automate our workflows. One of these efforts involved creating a new ","https:\u002F\u002Fcircleci.com\u002F","CircleCI"," pipeline to automatically deploy some NPM packages, removing the need for tedious manual work. The plan was straightforward: once started, the pipeline would bump the version of our packages (using Lerna), build them and finally publish them on our NPM registry.","type"," approval\n          "," build\n            "," deploy","\"state\"","\"success\"","\"target_url\"","\"description\"","\"context\"","\n\n","...","url \"https","--header 'Accept","--header \"Authorization"," commit"," jq ","[","]","\n  ","run","scalar","#notes","#conclusion","choosing-a-certificate-authority","Choosing a Certificate Authority","buying-an-ov-certificate-from-sectigo","Buying an OV certificate from Sectigo","generating-a-certificate-signing-request-csr","Generating a Certificate Signing Request (CSR)","completing-the-verification-process","Completing the verification process","verify-that-the-certificate-and-private-key-match","Verify that the Certificate and Private key match","troubleshooting-expecting-trusted-certificate-error","convert-the-certificate-to-pfx-format","Convert the certificate to PFX format","test-the-code-signing-process-manually","Test the code-signing process manually","a-note-on-ev-certificates","A note on EV certificates","converting-the-certificate-to-base64","Converting the certificate to base64","preparing-github-secrets","Preparing GitHub Secrets","automating-the-code-sign-process","Automating the code-sign process","notes-1","alternative-approaches","Alternative approaches","After our previous article on ","automatic code-signing for macOS applications",", we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines.","http:\u002F\u002FCodeSigningStore.com","CodeSigningStore.com","&","'C:\\Program Files\\Git\\usr\\bin\\openssl.exe'","PRIVATEKEY.key","MYCSR.csr","modulus ","noout "," openssl md5\n","maybe-class-name","codesign.pfx","signtool.exe","\"C:\\Program Files (x86)\\Windows Kits\\10\\bin\\10.0.19041.0\\x86\\signtool\"","\"\u003CPASSWORD_HERE\u003E\"","SectigoPublicCodeSigningRootR46_AAA","CODESIGN_BASE64","CODESIGN_PWD","CODESIGN_INTERMEDIATE_BASE64","https:\u002F\u002Fgithub.com\u002Fespanso\u002Fespanso\u002Fpull\u002F1352\u002Ffiles","https:\u002F\u002Fgithub.com\u002FDana-Prajea\u002Fcode-sign-action","Fixing “Error: SignerSign() failed.” during SignTool code-signing","Today I was working on the automatic code-signing CI for ","https:\u002F\u002Fespanso.org","Espanso",". As suggested by various articles, I went ahead and tried to sign the executable with this "," command:","signtool.exe sign \u002Fv \u002Fp ","\u003C","your PFX password"," \u002Fac ","'CROSS_SIGNED_SECTIGO_CA_HERE'","'FULL_PATH_TO_FILE_TO_SIGN'")));
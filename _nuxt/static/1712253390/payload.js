__NUXT_JSONP__("/", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn,do0,dp,dq,dr,ds,dt,du,dv,dw,dx,dy,dz,dA,dB,dC,dD,dE,dF,dG,dH,dI,dJ,dK,dL,dM,dN,dO,dP,dQ,dR,dS,dT,dU,dV,dW,dX){return {data:[{articles:[{slug:"2024-02-25-understanding-crdts-improving-our-set-chapter-2",description:"In the previous article, we implemented a basic Set with support for additions and removals, as well as basic CRDT semantics. Despite working in simple cases, we also highlighted two significant limitations:",layout:bQ,title:"Understanding CRDTs: Improving our Set (Chapter 2)",author:bR,date:"2024-02-25T00:00:00.000Z",categories:cv,social_title:cw,social_subtitle:"Improving our Set (Chapter 2)",header:cx,adaptive_images:cy,toc:[{id:cz,depth:aO,text:cA},{id:cB,depth:aO,text:cC},{id:cD,depth:aO,text:cE},{id:cF,depth:aO,text:cG},{id:cH,depth:aO,text:cI},{id:cJ,depth:aO,text:cK}],body:{type:a$,children:[{type:b,tag:l,props:{},children:[{type:a,value:bS},{type:b,tag:bT,props:{to:cL},children:[{type:a,value:cM}]},{type:a,value:cN}]},{type:a,value:f},{type:a,value:f},{type:b,tag:bx,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"An element cannot be re-added to the Set after being removed"}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Although a removal would "},{type:b,tag:P,props:{},children:[{type:a,value:cO}]},{type:a,value:" remove an element from the Set, the underlying data structure’s size keeps increasing over time. If we perform many deletions, this could bloat the size of the structure significantly."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"In this article, we’ll try to tackle the first problem, discussing different approaches and tradeoffs."}]},{type:a,value:f},{type:b,tag:by,props:{id:"supporting-additions-after-removals"},children:[{type:b,tag:z,props:{href:"#supporting-additions-after-removals",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:"Supporting additions after removals"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As we mentioned, our current Set implementation does not allow an element to be restored after being deleted:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Add 'a' back"}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F false! Ouch, it should be true"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"For some use cases, this is a significant limitation: imaging building a grocery list application. You might add some elements to your “to buy” set, and later remove them after the purchase. This would work for a while, but then you might find yourself needing to buy the same product again. In this case, you would need to add elements to the set again after deleting them."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The reason why we are unable to add an element back after its removal is that our current implementation always prioritizes the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" set. Let’s take the following scenario as an example:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"In this case, our Set will logically contain only element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:", as element "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" is present in the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" set and thus ignored."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:cz},children:[{type:b,tag:z,props:{href:"#attempt-0-removing-elements",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:cA}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"If having "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" in the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" Set prevents us from restoring it, can’t we simply remove "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" from "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" after re-adding it? For example:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Then user calls set.add(\"b\")"}]},{type:a,value:"\n\nelements "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Unfortunately, as we’ve seen in the previous chapter, removing elements from our sets becomes problematic once replicas and synchronization enter the picture. In those cases, deleting "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" from the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" set could cause it to randomly disappear again during synchronization, so we need a better solution."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:cB},children:[{type:b,tag:z,props:{href:"#attempt-1-adding-timestamps",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:cC}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Let’s take a step back and focus on our expected outcome: our goal is to be able to add an element to the Set "},{type:b,tag:P,props:{},children:[{type:a,value:bm}]},{type:a,value:" removing it. If we had a way to determine whether our element was added before or after its removal, we could decide whether to ignore it or not. For example, if element "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:cP},{type:b,tag:P,props:{},children:[{type:a,value:bm}]},{type:a,value:cQ},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:", then element "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" should be included, but if element "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:cP},{type:b,tag:P,props:{},children:[{type:a,value:"before"}]},{type:a,value:cQ},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:", then it should be ignored. In other words, we need some kind of "},{type:b,tag:P,props:{},children:[{type:a,value:cR}]},{type:a,value:" between our Set operations."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"An initial approach to achieve ordering is to attach a timestamp to our additions and removals. We are going to do this by converting our "},{type:b,tag:n,props:{},children:[{type:a,value:aq}]},{type:a,value:bz},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" Sets into "},{type:b,tag:P,props:{},children:[{type:a,value:"Maps:"}]}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Before"}]},{type:a,value:cS},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F After"}]},{type:a,value:cS},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bU}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"In this case, the keys of our map represent the elements, while the values represent the time in which the elements were added or removed."}]},{type:a,value:f},{type:b,tag:bn,props:{},children:[{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Note: in the previous example, timestamps are represented as string dates to make them easier to read and understand by humans. This implementation would be quite inefficient in practice, so we are going to use Unix timestamps in the actual code."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The time information will be provided by the "},{type:b,tag:n,props:{},children:[{type:a,value:Y}]},{type:a,value:bz},{type:b,tag:n,props:{},children:[{type:a,value:aH}]},{type:a,value:" methods:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:bo},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:cT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:cU}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:cT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:cU}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"With the time information, we can finally refine our Set logic to support additions after removals:"}]},{type:a,value:f},{type:b,tag:bn,props:{},children:[{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"An element is present in our Set if:"}]},{type:a,value:f},{type:b,tag:bx,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"It’s present in the "},{type:b,tag:n,props:{},children:[{type:a,value:aq}]},{type:a,value:" and not in the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"OR if the timestamp in the "},{type:b,tag:n,props:{},children:[{type:a,value:aq}]},{type:a,value:" is greater or equal than the timestamp in the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]}]},{type:a,value:f}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Thanks to the second condition, we are now able to add an element back after its removal. This works because whenever we "},{type:b,tag:n,props:{},children:[{type:a,value:Y}]},{type:a,value:" an element, we also update its timestamp, and if this timestamp is greater than the current "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" timestamp, we consider the element to be present."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"A possible implementation for the "},{type:b,tag:n,props:{},children:[{type:a,value:S}]},{type:a,value:" method could be:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:bo},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:" additionTime "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:bA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"additionTime "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bV}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w,bB]},children:[{type:a,value:bW}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Element was never added"}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bC]},children:[{type:a,value:cV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:cW},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:bA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"removalTime"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Was the element removed before or after its addition?"}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:cW},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"\u003C="}]},{type:a,value:bX},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F The element was never removed"}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bC]},children:[{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Finally, to make our Set a proper CRDT, we’ll need to update the "},{type:b,tag:n,props:{},children:[{type:a,value:ae}]},{type:a,value:" method as well:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:bo},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:bY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:bZ}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bX},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:b_}]},{type:a,value:b$},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:" existingAdditionTime "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:bA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Update the local addition time only if the remote addition time is greater"}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:cX},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bV}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w,bB]},children:[{type:a,value:bW}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:cY}]},{type:a,value:cX},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:a,value:" additionTime\n      "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bX},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:bY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:bZ}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:cZ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:b_}]},{type:a,value:b$},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:" existingRemovalTime "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:bA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Update the local removal time only if the remote removal time is greater"}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:c_},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bV}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w,bB]},children:[{type:a,value:bW}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:cY}]},{type:a,value:c_},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:a,value:" removalTime\n      "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:cZ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"We are now ready to test our Set again (the full code is available "},{type:b,tag:z,props:{href:"https:\u002F\u002Fgithub.com\u002Ffederico-terzi\u002Fcrdt-experiments\u002Fblob\u002Fmain\u002Fcrdt-article-examples\u002Fpart-2\u002Fset-with-timestamps.js",rel:[af,ag,ah],target:ai},children:[{type:b,tag:br,props:{},children:[{type:a,value:ca}]}]},{type:a,value:c$}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:bo},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"\n  replicaA"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Wait for some time between operation."}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F This way, the new Date.getTime() call can't return the same value"}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:cb}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:cd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:da},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:da},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:cb}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:cd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:db},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:cb}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:cd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:db},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F true! Yay, 'a' is back!"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Yay, our Set can now handle additions after removals! Is this ready for production? Well, not exactly. Our current implementation suffers from a subtle, but very problematic edge case, which we’ll discuss in the next section."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:cD},children:[{type:b,tag:z,props:{href:"#physical-time-and-distributed-systems",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:cE}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"In the implementation we just discussed, timestamps play an important role: they allow us to tell which operation comes first. In other words, we are relying on timestamps to determine the "},{type:b,tag:P,props:{},children:[{type:a,value:"ordering of operations"}]},{type:a,value:", which in turn determines which elements are present in the set and which are not. Unfortunately, this approach can break down in subtle ways when dealing with distributed systems."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Most of our devices, including laptops and mobile phones, rely on a hardware device to keep track of time: the clock. These clocks are usually based on quartz oscillators and are not very precise, so every device has its own notion of time. For example, this is a picture of my car’s clock:"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:dc,src:"\u002Fposts\u002F2024-02-25-understanding-crdts-improving-our-set\u002Fimage0.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Every few weeks, I might need to adjust the time, as it might have drifted by one or two minutes. Some of you might be wondering: why isn’t this time drift happening on our phones and laptops? Well… it is! The reason we don’t notice is a protocol known as "},{type:b,tag:z,props:{href:dd,rel:[af,ag,ah],target:ai},children:[{type:a,value:"NTP "}]},{type:a,value:j},{type:b,tag:P,props:{},children:[{type:a,value:"Network Time Protocol)"}]},{type:a,value:", which allows internet-connected devices to periodically sync their time with NTP servers, down to a \u003C100ms precision. Unfortunately, my car is quite old and doesn’t have any kind of internet connectivity, so NTP is not an option there. Until I keep my car, I’ll need to keep the time up to date manually (though as you can see from the year, I’m not particularly good at it :D )."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As long as the NTP protocol works, our devices will have a reasonably precise clock, so why shouldn’t we rely on timestamps for the operation ordering?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"In software systems, data integrity is usually one of the top concerns. For example, let’s take two hypothetical bugs:"}]},{type:a,value:f},{type:b,tag:bd,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"A bug causing application instances to crash"}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"A bug silently corrupting data in our database"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Which one sounds scarier?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As a result, when designing a data structure like our CRDT Set, we should always think about the worst-case scenarios: what happens if the time in our local machine goes off? Let’s see an example, starting from this Set state:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bU}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Let’s say for some reason, our local time is completely off and we decide to remove element "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:". As we discussed before, this causes a new entry to be added to the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:de}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bU}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:df}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bo},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F \u003C- year is set to 2099"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"From the user perspective, this works correctly: the element "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" is removed (because 2099 \u003E 2024)."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"After a while, the CRDT Set is replicated to another replica, which might decide to add element "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" again. As a result, we update the timestamp of entry "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:"  in the "},{type:b,tag:n,props:{},children:[{type:a,value:aq}]},{type:a,value:de}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F \u003C- updated, but still less than 2099!"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:df}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"But this time, the "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" element does not come back… In fact, it will not come back for the next 75 years! By relying on physical timestamps to determine the order of operations, we might cause silent data loss or corruption in the case of out-of-time clocks. We can do better than that."}]},{type:a,value:f},{type:b,tag:bn,props:{},children:[{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Aside: How likely is this out-of-time scenario to happen?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Despite being a rare occurrence, these are some scenarios in which a device’s time could experience some edge-case behaviors:"}]},{type:a,value:f},{type:b,tag:bd,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Firewalls could be misconfigured and temporarily block NTP synchronization, making the local clock slowly drift over time."}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"When the drift between the local clock and the NTP server clock is too large, the NTP protocol might decide to reset the local clock. From the perspective of local applications, the clock would have jumped forward or backward in time."}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Users could even misconfigure their local time on purpose, for example, trying to elude “trial periods” of certain proprietary software."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"If you want to know more about this topic, I highly recommend reading the “Unreliable Clocks” chapter from "},{type:b,tag:z,props:{href:"https:\u002F\u002Fwww.oreilly.com\u002Flibrary\u002Fview\u002Fdesigning-data-intensive-applications\u002F9781491903063\u002F",rel:[af,ag,ah],target:ai},children:[{type:a,value:"Designing Data-Intensive Applications"}]},{type:a,value:" by Martin Kleppmann, one of the best software engineering books ever written."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"So if physical timestamps are not a good option for this use case, what should we use? A better mechanism to determine the order of operations in distributed systems is "},{type:b,tag:z,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FVersion_vector",rel:[af,ag,ah],target:ai},children:[{type:b,tag:P,props:{},children:[{type:a,value:"Version Vectors"}]}]},{type:b,tag:P,props:{},children:[{type:a,value:C}]},{type:a,value:" which we are going to cover in the next section."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:cF},children:[{type:b,tag:z,props:{href:"#attempt-2-version-vectors",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:cG}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Version Vectors are a mechanism for tracking changes to data in a distributed system. Most importantly, they can do so without relying on physical time."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"To introduce Version Vectors, let’s imagine a distributed scenario in which two replicas exist. We’ll call them Alice and Bob:"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:dc,src:"\u002Fposts\u002F2024-02-25-understanding-crdts-improving-our-set\u002Fimage1.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"When using Version Vectors, each replica has to have a "},{type:b,tag:br,props:{},children:[{type:a,value:dg}]},{type:a,value:" ID, which we’ll call "},{type:b,tag:P,props:{},children:[{type:a,value:"replica ID"}]},{type:a,value:". For simplicity, Alice will have "},{type:b,tag:n,props:{},children:[{type:a,value:"ID = alice"}]},{type:a,value:" and Bob will have "},{type:b,tag:n,props:{},children:[{type:a,value:"ID = bob"}]},{type:a,value:o}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Version Vectors can be thought of as "},{type:b,tag:P,props:{},children:[{type:a,value:"maps"}]},{type:a,value:", in which the keys are the replica IDs and the values are the number of changes to the data by the given replica. For example, when Alice adds a new element, the corresponding Version Vector will be:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"which can be read as “Alice has made one edit to the data so far”. If Alice performs another update, the Version Vector will become:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"And if this value is then modified by Bob, the Version Vector will become:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"which can be read as “Alice has made 2 edits to the data, while Bob made one edit”."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"When executing an operation (either "},{type:b,tag:n,props:{},children:[{type:a,value:Y}]},{type:a,value:" or "},{type:b,tag:n,props:{},children:[{type:a,value:aH}]},{type:a,value:" ), our CRDT Set will attach a Version Vector to the value, in the same way as we did with the timestamps:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:T}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"All good so far, but we still haven’t discussed how Version Vectors can help us. To answer that question, let’s take a step back: our goal is to determine whether a removal occurred "},{type:b,tag:P,props:{},children:[{type:a,value:"before or after"}]},{type:a,value:" the corresponding addition, as that will determine whether the element is present in the set or not. In other words, we need a way to determine an "},{type:b,tag:P,props:{},children:[{type:a,value:cR}]},{type:a,value:" between the additions and removals of the same element. Version Vectors serve exactly that purpose, let’s see how:"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Every time a replica executes an operation on a given element, it increments the corresponding counter in the Version Vector:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F After an operation by Alice"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Because we know that replica IDs are unique (more on this below), we can derive a partial ordering by comparing two version vectors. For example, given these two Version Vectors:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"we know that "},{type:b,tag:n,props:{},children:[{type:a,value:bs}]},{type:a,value:g},{type:b,tag:br,props:{},children:[{type:a,value:"must"}]},{type:a,value:" have come "},{type:b,tag:P,props:{},children:[{type:a,value:bm}]},{type:a,value:g},{type:b,tag:n,props:{},children:[{type:a,value:bD}]},{type:a,value:" (because the replica IDs are unique and each operation causes an increment in the current replica counter). For example, let’s consider the following scenario:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"In this case, because "},{type:b,tag:n,props:{},children:[{type:a,value:bs}]},{type:a,value:dh},{type:b,tag:P,props:{},children:[{type:a,value:bm}]},{type:a,value:g},{type:b,tag:n,props:{},children:[{type:a,value:bD}]},{type:a,value:", we know that element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" was removed. On the other hand, the following scenario displays a Set in which the element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" is present:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bt}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F \u003C- 3 is greater than 2, so 'a' is present"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"When multiple replicas modify the same data, each replica increments its own counter. For example:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F After Bob modifies the data"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"By comparing these two version vectors, we know that "},{type:b,tag:n,props:{},children:[{type:a,value:ce}]},{type:a,value:dh},{type:b,tag:P,props:{},children:[{type:a,value:bm}]},{type:a,value:g},{type:b,tag:n,props:{},children:[{type:a,value:bD}]},{type:a,value:", because the former is a superset of the latter. In other words, a version vector A is greater than a version vector B if all counters of A are greater or equal to the corresponding counters on B."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"So in the following scenario, we know that "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" is not present in the Set:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F \u003C- This VV is greater than {alice: 1}"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The trickiest scenario happens when two replicas modify the same data concurrently:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Alice modifies the value"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F At the same time, Bob modifies the value"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Does "},{type:b,tag:n,props:{},children:[{type:a,value:bs}]},{type:a,value:"  come before or after "},{type:b,tag:n,props:{},children:[{type:a,value:ce}]},{type:a,value:"? Neither of the two! The two version vectors are "},{type:b,tag:P,props:{},children:[{type:a,value:"concurrent"}]},{type:a,value:". In other words, we can’t tell which update came first by just looking at their version vectors. What should we do in this case? Let’s discuss an example to illustrate a possible approach."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Let’s assume both Alice and Bob start from the following state:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"From the rules we discussed before, we know that this Set contains element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" ."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Then, each replica updates its set concurrently. In particular, Alice removes and then adds "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" again:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bt}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"While Bob only removes "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:", without adding it back:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"When the two replicas synchronize, a conflict occurs: should "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" be present or not? Should the actions of Alice take precedence over the ones from Bob, or vice versa? It depends on the application, as different use cases require different approaches."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"A safe approach we could use is "},{type:b,tag:P,props:{},children:[{type:a,value:"prioritizing additions over removals when a conflict occurs"}]},{type:a,value:", a policy known as "},{type:b,tag:P,props:{},children:[{type:a,value:"Add Wins"}]},{type:a,value:". According to this logic, if some replica deletes an element while another replica adds it, then the addition should “win”. This policy is the safest as it minimizes the risk of unwanted data loss. For example, it would be easy for Bob to remove element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" again if he’s really convinced about his choice, with minimal UX impact. But if we didn’t adopt the Add-Win policy, Alice might have element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" silently disappear after the synchronization, which could lead to a bad UX."}]},{type:a,value:f},{type:b,tag:bn,props:{},children:[{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Note: Different approaches to conflict resolution are possible, the most suitable of which depends on the specific use case. For example, some applications might require to “merge” elements when a conflict occurs, rather than having one override the other. Others might prefer the removal operation to take precedence."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"If we opt for the Add-Wins policy in our CRDT Set, Alice’s addition will win over Bob’s removal. The only thing left to figure out is what the Version Vector will be."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"When a conflict occurs, we are going to "},{type:b,tag:P,props:{},children:[{type:a,value:ae}]},{type:a,value:" the two Version Vectors. A merge consists of creating a Version Vector whose counters are the maximum value across all conflicting vectors’ counters. For example, merging "},{type:b,tag:n,props:{},children:[{type:a,value:bs}]},{type:a,value:" with "},{type:b,tag:n,props:{},children:[{type:a,value:ce}]},{type:a,value:" will result in "},{type:b,tag:n,props:{},children:[{type:a,value:"{alice: 2, bob: 1}"}]},{type:a,value:". By applying this logic to our previous example, we’ll end up with the following state:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bt}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F \u003C- merged vector"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:z}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F The value of the removals version vector doesn't really matter, as long as it's smaller than the addition version vector"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The resulting set will contain element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" , because the resulting vector ("},{type:b,tag:n,props:{},children:[{type:a,value:"{alice: 3, bob: 1}"}]},{type:a,value:" ) is greater than the vector in "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:o}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"An important side-effect of the merge, which might not be obvious at first, is that the resulting version vector now “encodes” the fact that it came after "},{type:b,tag:br,props:{},children:[{type:a,value:"both"}]},{type:a,value:" concurrent updates. In other words, we can tell for sure that this addition comes after both Alice’s addition and Bob’s removal. This allows us to accurately track the way our data evolves when multiple replicas update it."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"We now have all the necessary ingredients to implement our Version Vector CRDT Set in JS. Because the implementation is quite long, I’ve decided to not include it in the article, but you can find it on the GitHub repo "},{type:b,tag:z,props:{href:"https:\u002F\u002Fgithub.com\u002Ffederico-terzi\u002Fcrdt-experiments\u002Fblob\u002Fmain\u002Fcrdt-article-examples\u002Fpart-2\u002Fset-with-version-vector.js",rel:[af,ag,ah],target:ai},children:[{type:a,value:ca}]},{type:a,value:o}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"All right! We now have implemented a CRDT Set that supports additions, removals, and concurrent updates without relying on physical clocks, making it more robust for use in distributed systems."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:cH},children:[{type:b,tag:z,props:{href:"#remarks-on-replica-ids",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:cI}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"An important discussion we should have is related to Replica IDs. Version Vectors (as well as other approaches we’ll discuss in the upcoming chapters) rely on the fact that every replica has a "},{type:b,tag:br,props:{},children:[{type:a,value:dg}]},{type:a,value:" ID. Without the uniqueness guarantee, we couldn’t infer an ordering between two Version Vectors. For example, if two replicas had "},{type:b,tag:n,props:{},children:[{type:a,value:"Alice"}]},{type:a,value:" as replica ID, we couldn’t tell for sure if the version vector "},{type:b,tag:n,props:{},children:[{type:a,value:bs}]},{type:a,value:" comes after "},{type:b,tag:n,props:{},children:[{type:a,value:bD}]},{type:a,value:". We can infer an ordering only when we can safely assume that a replica counter will only be incremented by a single replica (based on the ReplicaID)."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"You will find this ID uniqueness requirement in most CRDT implementations. In fact, many CRDTs explicitly mention that it’s up to you to guarantee unique replica IDs, otherwise you might face data corruption (eg. "},{type:b,tag:z,props:{href:"https:\u002F\u002Fdocs.rs\u002Fyrs\u002Flatest\u002Fyrs\u002F#quick-start",rel:[af,ag,ah],target:ai},children:[{type:a,value:ca}]},{type:a,value:di}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"This requirement is made more complex by the fact that CRDTs are typically used in distributed P2P scenarios. In those cases, we can’t rely on a central authority to assign IDs that are guaranteed to be globally unique. The most popular solution in those cases is to generate a random replica ID large enough to be statistically unlikely to conflict with another replica ID. The downside of large replica IDs is that they can take up quite a bit of storage within our CRDT, depending on the implementation. So in these cases, we need to balance our accepted risk of data corruption with our efficiency requirements or introduce a global “coordination” entity to assign unique IDs."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:cJ},children:[{type:b,tag:z,props:{href:"#remarks-on-version-vectors-storage",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:cK}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Version Vectors are a powerful tool in our distributed systems toolbox. Their main downside is that they can take quite a bit of storage in our data structure, and in certain scenarios, a "},{type:b,tag:P,props:{},children:[{type:a,value:"lot"}]},{type:a,value:" of storage."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The ideal scenario for Version Vectors is when any given data entry is only ever modified by a single replica:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aK}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bt}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As you can see, because our data is only modified by Alice, our Version Vector’s size doesn’t grow."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"If at some point another replica decides to modify the data, our Version Vector’s size grows by one:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bt}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Therefore, the worst-case scenario happens when a data entry is modified by a different replica every time:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:dj}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ax}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:Q}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:dj}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:"david"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"That adds up quickly!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The problem is that we can fall into this worst-case scenario quite easily if we are not careful. For example, given that replica IDs have to be unique, we could decide to solve the problem by generating a random ID every time our CRDT is initialized. At this point, every time we modify the same entry, the Version Vector size will grow by one. Given that our CRDT is likely to be initialized at least once every time the user starts our application, modifying the same entries will cause the Version Vector size to grow fast!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"For some use cases, this might not be a significant problem, for example in scenarios in which the creation of new objects is more common than edits or when Replica IDs can be reused among different sessions. There is also a more efficient version of Version Vectors called "},{type:b,tag:P,props:{},children:[{type:a,value:"Dotted Version Vectors"}]},{type:a,value:", which in some cases can bring significant space savings. We’ll hopefully cover it in a future chapter of the series, so stay tuned :)"}]},{type:a,value:f},{type:b,tag:by,props:{id:"conclusions"},children:[{type:b,tag:z,props:{href:"#conclusions",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:"Conclusions"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"That was quite a ride! We finally have a working CRDT Set implementation, but there is still a lot to discuss:"}]},{type:a,value:f},{type:b,tag:bd,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Our CRDT Set only keeps growing over time, even after we remove elements. Can we implement deletes more efficiently?"}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"When we synchronize the replicas of our CRDT, we currently need to send the entire state to each other, which could become prohibitive expensive after a certain size. Can we implement a more efficient synchronization in which only the “new” data is sent over the wire?"}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"What about other data structures like Lists and Maps?"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"These will be the topics of the next chapters, so stay tuned!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"PS: All the code is available in this repository: "},{type:b,tag:z,props:{href:bE,rel:[af,ag,ah],target:ai},children:[{type:a,value:bE}]}]}]},excerpt:{type:a$,children:[{type:b,tag:l,props:{},children:[{type:a,value:bS},{type:b,tag:bT,props:{to:cL},children:[{type:a,value:cM}]},{type:a,value:cN}]}]},dir:cf,path:"\u002Farticles\u002F2024-02-25-understanding-crdts-improving-our-set-chapter-2",extension:cg,createdAt:be,updatedAt:be,cleanedSlug:"understanding-crdts-improving-our-set-chapter-2"},{slug:"2024-01-27-screencapturekit-failing-to-capture-the-entire-display",description:ch,layout:bQ,title:dk,author:bR,date:"2024-01-27T00:00:00.000Z",categories:"macos screencapturekit screen recording objective c bug",social_title:dk,toc:[],body:{type:a$,children:[{type:b,tag:l,props:{},children:[{type:a,value:ch}]},{type:a,value:f},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Here was a simplified version of my first attempt, in Objective-C:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:"#"},{type:b,tag:c,props:{className:[d,w,bF]},children:[{type:a,value:bG}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:ci}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:ci}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bH}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bf}]},{type:a,value:cj},{type:b,tag:c,props:{className:[d,w,bF]},children:[{type:a,value:bG}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:ck}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:ck}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bH}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bf}]},{type:a,value:cj},{type:b,tag:c,props:{className:[d,w,bF]},children:[{type:a,value:bG}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cl}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cl}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bH}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bf}]},{type:a,value:cj},{type:b,tag:c,props:{className:[d,w,bF]},children:[{type:a,value:bG}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:dl}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bu}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:dl}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bH}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bf}]},{type:a,value:"\n\n@"},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"interface"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:bI}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"NSObject"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"SCStreamOutput"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bf}]},{type:a,value:"\n@end\n\n@implementation "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bI}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"void"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"stream"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cm}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"stream didOutputSampleBuffer"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"CMSampleBufferRef"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"sampleBuffer ofType"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"SCStreamOutputType"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"type\n"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,r]},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bJ}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bK},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"buffer received!\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Analysis here"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:"\n@end\n\nint "},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"main"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:"int argc"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:" char "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:" argv"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n    @autoreleasepool "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"CGPreflightScreenCaptureAccess"}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,r]},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bJ}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bK},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"CGPreflightScreenCaptureAccess failed\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"CGSize"}]},{type:a,value:" displaySize "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r]},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"CGDisplayBounds"}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"CGMainDisplayID"}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"size"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Get the first display"}]},{type:a,value:"\n        __block "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"SCDisplay"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:"display "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:"NULL"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"\n        dispatch_semaphore_t semaphore "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cn}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bL}]},{type:a,value:dm},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:co}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bL}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:dn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bM,E]},children:[{type:a,value:bN}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:cp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n            display "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:cq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:do0}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cr}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cs}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ct}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cu}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:dp},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:dq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Select display, excluding no window"}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bv}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:dr},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bv}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:ds},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:"display excludingWindows"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:dt},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:du}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:" config "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:du}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:dv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:dw}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:dx},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:dw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:dy}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:dx},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:dy}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"queueDepth"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"8"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"showsCursor"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bC]},children:[{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"pixelFormat"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:" kCVPixelFormatType_32BGRA"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"colorSpaceName"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:" kCGColorSpaceSRGB"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bI}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:" delegate "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bI}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:dv},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cm}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:" stream "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cm}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:" initWithFilter"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:"filter configuration"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:"config delegate"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:bB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,bM,E]},children:[{type:a,value:bN}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:" error "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:dz},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:"BOOL"}]},{type:a,value:" did_add_output "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:a,value:"stream addStreamOutput"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:"delegate\n                                                "},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:"type"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"SCStreamOutputTypeScreen"}]},{type:a,value:"\n                                   "},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:"sampleHandlerQueue"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:"nil\n                                                "},{type:b,tag:c,props:{className:[d,x,y]},children:[{type:a,value:dA}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"&"}]},{type:a,value:dA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:"did_add_output"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,r]},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bJ}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bK},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"addStreamOutput failed\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:R}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:"\n\n        dispatch_semaphore_t semaphore2 "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cn}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:a,value:"stream startCaptureWithCompletionHandler"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:co}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,bM,E]},children:[{type:a,value:bN}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:cp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,r]},children:[{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bJ}]}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bK},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"\"capture started\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cr}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:dB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cs}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:dB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ct}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"NSRunLoop"}]},{type:a,value:" currentRunLoop"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:" run"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"We can compile and run this program from the terminal by running:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:a,value:"clang "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:"mmacosx"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:"version"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:"min"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"12.3"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:"fobjc"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:"arc "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:ci}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cl}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:ck}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"AppKit"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"m"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:a,value:"o main "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"&&"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bu}]},{type:a,value:"main\n"}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"After providing the necessary permissions on the Settings, we are greeted with this output:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"19"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"41.567"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"6246"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"145858"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:" capture started\n"}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"So the capture started, but where are all our juicy buffers? I expected "},{type:b,tag:n,props:{},children:[{type:a,value:"buffer received"}]},{type:a,value:" to be printed many times per second, but it seems like our callback is never called."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"I’ve spent many hours trying to debug the issue, until I’ve started experimenting more with the "},{type:b,tag:n,props:{},children:[{type:a,value:bv}]},{type:a,value:": instead of calling the "},{type:b,tag:n,props:{},children:[{type:a,value:dC}]},{type:a,value:" initialization, I’ve tried "},{type:b,tag:n,props:{},children:[{type:a,value:"initWithDesktopIndependentWindow:"}]},{type:a,value:", passing a random window… To my surprise, many "},{type:b,tag:n,props:{},children:[{type:a,value:"buffer received!"}]},{type:a,value:" logs started to appear!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"For some reason, it seems that passing an empty windows array to "},{type:b,tag:n,props:{},children:[{type:a,value:dC}]},{type:a,value:" causes the stream to never start (apparently "},{type:b,tag:z,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F77513220\u002Fhow-can-i-use-screencapturekit-to-capture-an-entire-desktop",rel:[af,ag,ah],target:ai},children:[{type:a,value:"I’m not the only one that experienced this problem"}]},{type:a,value:di}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"A workaround I’ve came up with is using the "},{type:b,tag:n,props:{},children:[{type:a,value:"initWithDisplay:includingApplications:exceptingWindows:"}]},{type:a,value:" initialization method instead, passing all the available applications as input:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F ..."}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Get all the running applications"}]},{type:a,value:"\n__block "},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cu}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:"SCRunningApplication"}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:bf}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:"apps "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:dz},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"\ndispatch_semaphore_t semaphore "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cn}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bL}]},{type:a,value:dm},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:co}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bL}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:dn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bM,E]},children:[{type:a,value:bN}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:cp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n    display "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:cq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:do0}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:bg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"\n    apps "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:cq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"applications"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cr}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:cs}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,ab]},children:[{type:a,value:ct}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:cu}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:dp},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:dq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Select display, including all applications"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bv}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aj}]},{type:a,value:dr},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,F]},children:[{type:a,value:bv}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:ds},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:"display includingApplications"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:"apps exceptingWindows"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:a,value:dt},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Running this program produces:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[K,J]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.269"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.278"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.287"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.294"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.303"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.311"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.320"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.328"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.336"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.345"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.352"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.361"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.369"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.378"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ar}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:as}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:L}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:at}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:au}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:"04.386"}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:M}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,i]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:N}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:am}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Success!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Note: I’m currently running macOS 12.6.3, so newer versions might have already fixed this problem."}]}]},excerpt:{type:a$,children:[{type:b,tag:l,props:{},children:[{type:a,value:ch}]}]},dir:cf,path:"\u002Farticles\u002F2024-01-27-screencapturekit-failing-to-capture-the-entire-display",extension:cg,createdAt:be,updatedAt:be,cleanedSlug:"screencapturekit-failing-to-capture-the-entire-display"},{slug:"2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1",description:"In the past two months, I’ve been diving deeper into the realm of distributed systems. The catalyst that started my research was discovering the world of local-first applications, a class of software that allows users to access and modify their data locally, while seamlessly synchronizing across devices, even in the face of connection failures.",layout:bQ,title:"Understanding CRDTs: A Gentle Introduction (Chapter 1)",author:bR,date:"2024-01-19T00:00:00.000Z",categories:cv,social_title:cw,social_subtitle:"A Gentle Introduction (Chapter 1)",header:cx,adaptive_images:cy,toc:[{id:dD,depth:aO,text:dE},{id:dF,depth:aO,text:dG},{id:dH,depth:aO,text:dI},{id:dJ,depth:aO,text:dK}],body:{type:a$,children:[{type:b,tag:l,props:{},children:[{type:a,value:dL},{type:b,tag:z,props:{href:dM,rel:[af,ag,ah],target:ai},children:[{type:a,value:dN}]},{type:a,value:dO}]},{type:a,value:f},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"From the lens of distributed system theory, local-first applications could be defined as multi-master, eventually-consistent, distributed databases. A replica of the database would run on every user’s device, allowing writes at all times and, when a connection with another replica is available, synchronize the changes. Moreover, depending on the specific algorithm chosen to implement this distributed database, we could relax many of the topology constraints of traditional systems: imagine a system that could seamlessly synchronize across user devices (eg. P2P), while also "},{type:b,tag:P,props:{},children:[{type:a,value:"optionally"}]},{type:a,value:" synchronizing with a central server."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"An arbitrary network topology",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage0.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"This architecture allows applications to offer a superb UX, allowing users to work even without an internet connection (eg. when flying on a plane or in the subway), without sacrificing the convenience of synchronization across devices, something that we take for granted nowadays. But if the UX is so much better for the end user, why do so many apps fail to implement such a model? For example, Notion, a very popular knowledge-base app, can’t work without an internet connection, leading to poor user experience in low-connectivity scenarios."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The answer is that implementing a robust multi-master replication is not trivial, and introduces several challenges. For example, what happens when two users write to the same entry concurrently?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"Example of a concurrent write across different replicas.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage1.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"A traditional centralized database does not suffer from this problem, as all writes are handled by a single entity, which can decide with no ambiguity which update should take precedence."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"The centralized database has the final say on what update has priority.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage2.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"But in a multi-master architecture, all replicas typically have the same priority, so how do we decide which update “win”?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"In a multi-master scenario, dealing with conflicts is not trivial.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage3.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"A first approach could be to have the "},{type:b,tag:P,props:{},children:[{type:a,value:"last"}]},{type:a,value:" update take precedence, a concept known as "},{type:b,tag:P,props:{},children:[{type:a,value:"Last Write Wins"}]},{type:a,value:" (LWW): in this scenario, the last update being performed overwrites the previous one. So theoretically, we could just attach to each update a timestamp, and the update with the highest timestamp wins. Sounds easy, right?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"Concurrent write in a multi-master scenario, with timestamps attached.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage4.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Well, we have a problem, in fact, a serious problem: in a distributed system, clocks are never perfectly in sync. They can drift forward, backward, and even be completely off. And while most operating systems "},{type:b,tag:z,props:{href:dd,rel:[af,ag,ah],target:ai},children:[{type:a,value:"will try their best to keep clocks in sync"}]},{type:a,value:", it’s not something we should rely on to guarantee correctness or integrity. Would you trust a database that 99.99% of the time works perfectly, but silently corrupts the data if the clock goes off?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"And it gets worse, because even if clocks are perfectly in sync, the LWW semantic isn’t always appropriate. Imagine the scenario of a distributed counter: what happens if two replicas increment the counter concurrently? If we adopt the LWW semantic, one of the two increments is going to be lost."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"We can’t represent a counter with an LWW semantic, as concurrent increments would be lost.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage5.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"It turns out that different use cases and data structures require different approaches to deal with conflicts. As you can imagine, this could get complex pretty quickly. Luckily for us, distributed system theory comes to the rescue with the concept of CRDT."}]},{type:a,value:f},{type:b,tag:by,props:{id:"introducing-crdts"},children:[{type:b,tag:z,props:{href:"#introducing-crdts",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:"Introducing CRDTs"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:z,props:{href:dP,rel:[af,ag,ah],target:ai},children:[{type:b,tag:P,props:{},children:[{type:a,value:"Conflict-free Replicated Data Types"}]}]},{type:a,value:", or CRDTs for short, are a class of data structures that can be replicated across nodes in a network, with the following features (quoting "},{type:b,tag:z,props:{href:dP,rel:[af,ag,ah],target:ai},children:[{type:a,value:"Wikipedia"}]},{type:a,value:c$}]},{type:a,value:f},{type:b,tag:bx,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"The application can update any replica independently, "},{type:b,tag:z,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FConcurrent_computing",rel:[af,ag,ah],target:ai},children:[{type:a,value:"concurrently"}]},{type:a,value:", and without "},{type:b,tag:z,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FConcurrency_control",rel:[af,ag,ah],target:ai},children:[{type:a,value:"coordinating"}]},{type:a,value:" with other replicas."}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"An algorithm (itself part of the data type) automatically resolves any inconsistencies that might occur."}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Although replicas may have different state at any particular point in time, they are guaranteed to eventually converge."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"In other words, nodes can always access and modify their local copy of the CRDT as if it was a plain data structure (eg. a HashMap), and the CRDT algorithm takes care of conflict resolution and eventual convergence. It’s important to keep in mind that CRDTs do not require "},{type:b,tag:z,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FConsensus_(computer_science)",rel:[af,ag,ah],target:ai},children:[{type:a,value:"consensus"}]},{type:a,value:" to operate: generally, there is no distinction between replicas in a CRDT, which contrasts with typical replicated databases, in which a particular node acts as a master, and others as read-only replicas."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"The term "},{type:b,tag:P,props:{},children:[{type:a,value:"data structure"}]},{type:a,value:" we used previously is purposefully generic: depending on the chosen approach, CRDTs can model widely different types of data structures: maps, lists, strings, trees, etc. So if you need a distributed data structure with the semantics of a HashMap, you can use a CRDT-based HashMap, and if you need to implement real-time text editing (eg. Google Docs) you can use a CRDT-based List of characters. Moreover, CRDTs can be composed nicely, so if you have a CRDT Map and a CRDT List, you can compose them to represent a JSON-like CRDT data structure, with nested objects and values."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Before diving into our first CRDT, it’s important to discuss the concept of "},{type:b,tag:P,props:{},children:[{type:a,value:"intent preservation"}]},{type:a,value:". We defined CRDTs as data structures that automatically resolve conflicts and eventually converge to the same value across replicas, but that’s only part of the picture. For example, we could think of a HashMap that never stores any value that is given to it:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,"language-text"]},children:[{type:b,tag:n,props:{},children:[{type:a,value:"class NoopMap {\n  set(key, value) {\n    \u002F\u002F DO NOTHING\n  }\n  \n  get(key) {\n        return undefined;\n  }\n}\n"}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As crazy as it sounds, this data structure is a perfectly valid CRDT:"}]},{type:a,value:f},{type:b,tag:bd,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Conflicts are automatically handled because no conflict can ever occur if we don’t store values"}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Every replica always converges to the same value, an empty map"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As you can imagine, despite being formally definable as a CRDT, this data structure is of little practical use. The reason is that in order for a CRDT algorithm to be "},{type:b,tag:P,props:{},children:[{type:a,value:"good"}]},{type:a,value:" for practical purposes, it should try as much as possible to resolve conflicts while preserving the user’s intent, which has several important implications in our conflict resolution choices. We are going to cover this topic more in the following sections and chapters."}]},{type:a,value:f},{type:b,tag:by,props:{id:"our-first-crdt-set"},children:[{type:b,tag:z,props:{href:"#our-first-crdt-set",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:"Our first CRDT: Set"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Our CRDT adventure will start with a simple, yet very useful data structure: the Set."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"A generic Set data structure.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage6.png"},children:[]}]},{type:a,value:f},{type:b,tag:aQ,props:{id:dD},children:[{type:b,tag:z,props:{href:"#first-step-add-only-set",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:dE}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"To make our lives easier, we’ll narrow down our goal at first by creating an "},{type:b,tag:P,props:{},children:[{type:a,value:"Add-only"}]},{type:a,value:" Set, that is, a set to which we can add elements but not remove them (this is an important aspect, more on this later)."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Our goal is to create a CRDT with the semantics of an Add-only Set. In simple terms, we want a data structure with these features:"}]},{type:a,value:f},{type:b,tag:bd,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Elements can be added to the structure ("},{type:b,tag:n,props:{},children:[{type:a,value:Y}]},{type:a,value:dQ}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"We can check if an element is present in the structure ("},{type:b,tag:n,props:{},children:[{type:a,value:S}]},{type:a,value:dQ}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Elements are not ordered (Set semantics)"}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"No duplicates (Set semantics)"}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"For these examples, we will use JavaScript as it’s popular enough to be understood by most people (although some might argue that no one "},{type:b,tag:P,props:{},children:[{type:a,value:"really"}]},{type:a,value:" understands JavaScript \u002Fs)."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Let’s start by implementing our "},{type:b,tag:n,props:{},children:[{type:a,value:aE}]},{type:a,value:" class:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:dR}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aR}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:dS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aw}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:"Set"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:dT},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:dU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:dU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Pretty straightforward so far: we created a "},{type:b,tag:n,props:{},children:[{type:a,value:aE}]},{type:a,value:" class that wraps a Set and exposes the "},{type:b,tag:n,props:{},children:[{type:a,value:Y}]},{type:a,value:bz},{type:b,tag:n,props:{},children:[{type:a,value:S}]},{type:a,value:" operations."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Things start to get interesting when we introduce "},{type:b,tag:n,props:{},children:[{type:a,value:"CRDT"}]},{type:a,value:" semantics, which we are going to cover in the next section."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:dF},children:[{type:b,tag:z,props:{href:"#adding-crdt-semantics",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:dG}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:dV},{type:b,tag:n,props:{},children:[{type:a,value:aR}]},{type:a,value:" currently lacks one of the most important features of a CRDT: convergence. In particular, we want every replica of our data structure to eventually converge to the same value."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"Replicas eventually converge to the same Set value.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage7.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"At this point, we are not interested in the specific protocol used by different replicas to send each others’ changes. Let’s just assume that each replica will periodically send its "},{type:b,tag:n,props:{},children:[{type:a,value:aR}]},{type:a,value:" value to the other replicas."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"Replicas sending to each other their entire values.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage8.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"To handle the merging process, we’ll add a new method to our "},{type:b,tag:n,props:{},children:[{type:a,value:aE}]},{type:a,value:" structure: "},{type:b,tag:n,props:{},children:[{type:a,value:ae}]},{type:a,value:". This method takes another "},{type:b,tag:n,props:{},children:[{type:a,value:aR}]},{type:a,value:" and merges all its elements with the current set:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:bY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:bZ}]},{type:a,value:" element "},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:b_}]},{type:a,value:b$},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"With the "},{type:b,tag:n,props:{},children:[{type:a,value:ae}]},{type:a,value:" method, we can now propagate changes among replicas. In this example, we propagate changes from replica B to replica A:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Here we propagate the changes from replica B to replica A"}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:a_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Despite its simplicity, this approach offers some surprising advantages over traditional synchronization techniques:"}]},{type:a,value:f},{type:b,tag:bd,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"It’s highly "},{type:b,tag:P,props:{},children:[{type:a,value:"decentralized"}]},{type:a,value:": the algorithm imposes no constraint over the topology and communication between replicas. In particular, because the merging process is commutative and transitive, if replica A synchronizes with replica B, and then replica B synchronizes with replica C, then replica A and C will be in sync (as long as no concurrent update in A has happened in the meantime), despite having never communicated directly with each other."}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"As a result, the system is extremely robust against network problems and downtimes, as it can transparently make use of a "},{type:b,tag:z,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FMesh_networking#:~:text=A%20mesh%20network%20is%20a,data%20to%20and%20from%20clients.",rel:[af,ag,ah],target:ai},children:[{type:a,value:"mesh network"}]},{type:a,value:" rather than a traditional centralized solution."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As you can imagine, there are downsides as well, which we’ll gradually cover in the following sections."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:dH},children:[{type:b,tag:z,props:{href:"#adding-support-for-removals-a-naive-%CE%B1ttempt",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:dI}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Although an Add-only Set could be useful in some cases, many scenarios would also require removal operations, so our next goal is to add support for them. In short, we want to introduce a "},{type:b,tag:n,props:{},children:[{type:a,value:aH}]},{type:a,value:" method that replicas can use to remove an element from the Set."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"A first attempt could look as follows:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aw}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:"delete"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"And if we try to run it:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:dT},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:dW},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:dW},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"It works! Wait… does it? Apparently, the remove operation works correctly, but what happens when we synchronize the set across multiple replicas?"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:dX},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Sync replica B with replica A"}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:dX},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F Sync replica A with replica B"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F true!!! The 'a' came back!"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"We have a problem: although replica A deleted element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:", synchronizing with replica B causes the "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" element to come back!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:b,tag:aJ,props:{alt:"After the second synchronization, the “a” element is undeleted from replica A, which is not the expected behavior.",src:"\u002Fposts\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1\u002Fimage9.png"},children:[]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:dV},{type:b,tag:n,props:{},children:[{type:a,value:aH}]},{type:a,value:" operation is quite flaky: depending on the synchronization sequence, elements can be randomly undeleted. How can we solve this problem?"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Turns out that delete operations are one of the core complexities of CRDTs, and multiple approaches exist to deal with them. Each has its own set of tradeoffs, so we’ll discuss some of them in the upcoming sections."}]},{type:a,value:f},{type:b,tag:aQ,props:{id:dJ},children:[{type:b,tag:z,props:{href:"#adding-support-for-removals-the-set-pair-approach",ariaHidden:ao,tabIndex:aB},children:[{type:b,tag:c,props:{className:[aC,aD]},children:[]}]},{type:a,value:dK}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"A first approach to deal with removals is the Set-pair technique. In a nutshell, instead of using a Set to represent the elements, we are going to use "},{type:b,tag:P,props:{},children:[{type:a,value:"two"}]},{type:a,value:": one for the additions and one for the removals. It might seem confusing at first, so let’s try to take it step by step."}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Let’s start with an empty set, which will be represented internally by two add-only sets:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Then, we add elements "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:bz},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:m}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"If we now want to remove "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:", we could try deleting it directly from the "},{type:b,tag:n,props:{},children:[{type:a,value:aq}]},{type:a,value:" set, but we would then experience the same flakiness problem saw previously. Instead, we are going to "},{type:b,tag:P,props:{},children:[{type:a,value:Y}]},{type:a,value:" the "},{type:b,tag:n,props:{},children:[{type:a,value:T}]},{type:a,value:" element to the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" set:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:a,value:ap},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bb},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:ad},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"We can now define the content of the Set as:"}]},{type:a,value:f},{type:b,tag:bn,props:{},children:[{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"All the elements in the "},{type:b,tag:n,props:{},children:[{type:a,value:aq}]},{type:a,value:" Set that are not present in the "},{type:b,tag:n,props:{},children:[{type:a,value:Z}]},{type:a,value:" Set."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"We can implement this Set by elegantly composing two "},{type:b,tag:n,props:{},children:[{type:a,value:aR}]},{type:a,value:" together:"}]},{type:a,value:f},{type:b,tag:G,props:{className:[H]},children:[{type:b,tag:I,props:{className:[J,K]},children:[{type:b,tag:n,props:{},children:[{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:dR}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:dS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aR}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aY}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,bC]},children:[{type:a,value:cV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,w,_]},children:[{type:a,value:aT}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:b}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:b},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:aM},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aG]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bq},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:Z}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:U},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:s}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aL}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ak}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:u}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:al}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,E]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bk},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:aH}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:aP}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:ae}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,D,E]},children:[{type:a,value:D}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,v,r,p]},children:[{type:a,value:S}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:g},{type:b,tag:c,props:{className:[d,B]},children:[{type:a,value:"\u002F\u002F false (still false, yey!)"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"As you can see, our new Set remembers the removed element "},{type:b,tag:n,props:{},children:[{type:a,value:z}]},{type:a,value:" even after a synchronization!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"Unfortunately, our current "},{type:b,tag:n,props:{},children:[{type:a,value:aE}]},{type:a,value:" still has some problems:"}]},{type:a,value:f},{type:b,tag:bx,props:{},children:[{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"What happens if a replica adds an element after removing it? With the current implementation, once an element has been removed it won’t be restorable."}]},{type:a,value:f},{type:b,tag:W,props:{},children:[{type:a,value:"Although we are "},{type:b,tag:P,props:{},children:[{type:a,value:cO}]},{type:a,value:" removing elements, the size of our data structure keeps increasing over time. If we perform many removals, that would bloat our memory consumption significantly."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:bS},{type:b,tag:bT,props:{to:"\u002Fblog\u002Funderstanding-crdts-improving-our-set-chapter-2"},children:[{type:a,value:"next chapter"}]},{type:a,value:", we are going to answer these two questions and more, so stay tuned!"}]},{type:a,value:f},{type:b,tag:l,props:{},children:[{type:a,value:"PS: All the code is available in this repository: "},{type:b,tag:z,props:{href:bE,rel:[af,ag,ah],target:ai},children:[{type:a,value:bE}]}]}]},excerpt:{type:a$,children:[{type:b,tag:l,props:{},children:[{type:a,value:dL},{type:b,tag:z,props:{href:dM,rel:[af,ag,ah],target:ai},children:[{type:a,value:dN}]},{type:a,value:dO}]}]},dir:cf,path:"\u002Farticles\u002F2024-01-19-understanding-crdts-a-gentle-introduction-chapter-1",extension:cg,createdAt:be,updatedAt:be,cleanedSlug:"understanding-crdts-a-gentle-introduction-chapter-1"}]}],fetch:{},mutations:void 0}}("text","element","span","token","punctuation","\n"," ","operator","number","(",")","p",":","code",".","property-access",";","function","}","{","=","method","keyword","literal-property","property","a","string","comment",",","console","class-name","maybe-class-name","div","nuxt-content-highlight","pre","line-numbers","language-javascript","-","[","]","\n  ","em","alice","1","has","b","\n    ","\n        ","li","log","add","removals","control-flow","this","replicaA","constant","'a'","\nremovals ","merge","nofollow","noopener","noreferrer","_blank","*","const","new","!"," main","true","elements ","elements","2024","01","27","20","\n\n","set","VV","34","6365"," buffer received",-1,"icon","icon-link","CRDTSet","\"a\"","parameter","remove","\n      ","img","2","\u002F\u002F true","\n\n    ","bob",2,"\u002F\u002F false","h2","CRDTAddOnlySet","replicaB","return","\n\n        ","\u003C","\n            ","151907","if","151896","'b'","root","\nreplicaA"," b","\"2024-02-24\"","ul","2024-04-04T17:55:39.722Z","\u003E","0","\n        config"," replicaA "," replicaB ","\nreplicaB","\n\nreplicaA","after","blockquote","  ","\n\n  ","otherSet","strong","{alice: 2}","3","\u002F","SCContentFilter"," alloc","ol","h1"," and ","get","nil","boolean","{alice: 1}","https:\u002F\u002Fgithub.com\u002Ffederico-terzi\u002Fcrdt-experiments","module","import","h","StreamOutputDelegate","NSLog","@","SCShareableContent","known-class-name","NSError","semaphore","framework ","post","Federico Terzi","In the ","nuxt-link","\"2024-02-23\"","===","undefined"," additionTime","for","let","of"," otherSet","here","await","waitFor","10","{alice: 1, bob: 1}","\u002Farticles",".md","I’ve just spend a good portion of this afternoon trying to understand why Apple’s ScreenCaptureKit did not behave as expected. My goal was simple: creating the simplest possible program to capture the entire display and analyse the generated buffers.","Foundation","\n#","ScreenCaptureKit","CoreGraphics","SCStream","dispatch_semaphore_create","^"," _Nullable error"," content","dispatch_semaphore_signal","dispatch_semaphore_wait","DISPATCH_TIME_FOREVER","NSArray","distributed systems crdt set eventual convergence real time collaboration","Understanding CRDTs","understanding-crdt",true,"attempt-0-removing-elements","Attempt 0: Removing elements","attempt-1-adding-timestamps","Attempt 1: Adding timestamps","physical-time-and-distributed-systems","Physical time and distributed systems","attempt-2-version-vectors","Attempt 2: Version Vectors","remarks-on-replica-ids","Remarks on Replica IDs","remarks-on-version-vectors-storage","Remarks on Version Vectors storage","\u002Fblog\u002Funderstanding-crdts-a-gentle-introduction-chapter-1","previous article",", we implemented a basic Set with support for additions and removals, as well as basic CRDT semantics. Despite working in simple cases, we also highlighted two significant limitations:","logically"," was added "," removing element ","ordering","\nelements ","Date","getTime","false"," removalTime ","\n        existingAdditionTime ","||"," removalTime","\n        existingRemovalTime ","):","\n  replicaB","\n\n  replicaA","","https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FNetwork_Time_Protocol"," map:","\"2099-02-24\"","unique"," comes ",").","carl","ScreenCaptureKit failing to capture the entire Display","AVFoundation"," getShareableContentWithCompletionHandler"," _Nullable content","displays","empty "," @","filter "," initWithDisplay","empty","SCStreamConfiguration"," init","width"," displaySize","height"," nil","error","semaphore2","initWithDisplay:excludingWindows:","first-step-add-only-set","First step: Add-only Set","adding-crdt-semantics","Adding CRDT semantics","adding-support-for-removals-a-naive-αttempt","Adding support for Removals: a Naive Αttempt","adding-support-for-removals-the-set-pair-approach","Adding support for Removals: the Set-pair Approach","In the past two months, I’ve been diving deeper into the realm of distributed systems. The catalyst that started my research was discovering the world of ","https:\u002F\u002Flocalfirstweb.dev\u002F","local-first applications",", a class of software that allows users to access and modify their data locally, while seamlessly synchronizing across devices, even in the face of connection failures.","https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FConflict-free_replicated_data_type"," operation)","class","constructor"," set ","\n\nset","Our ","\nset","       ")));
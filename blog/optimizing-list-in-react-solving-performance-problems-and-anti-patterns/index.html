<!doctype html>
<!-- 
  Hi there! Welcome to my website :)
  It seems you are interested in the source code, did you
  know that the website is open-source? See:
  https://github.com/federico-terzi/federico-terzi.github.io
-->
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Optimizing Lists in React - Solving Performance Problems and Anti-patterns - Federico Terzi - A Software Engineering Journey</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="title" name="title" content="Federico Terzi - A Software Engineering Journey"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" data-hid="description" name="description" content="React is the most popular front-end framework, and that’s for a reason. Besides being funded by one of the largest companies on the planet, it’s also built around a few key concepts (one-way data flow, immutable data, functional components, hooks) that make it easier than ever to create robust applications. That said, it’s not without pitfalls."><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="Optimizing Lists in React - Solving Performance Problems and Anti-patterns"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="React is the most popular front-end framework, and that’s for a reason. Besides being funded by one of the largest companies on the planet, it’s also built around a few key concepts (one-way data flow, immutable data, functional components, hooks) that make it easier than ever to create robust applications. That said, it’s not without pitfalls."><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://federicoterzi.com/social/2022-02-04-optimizing-list-in-react-solving-performance-problems-and-anti-patterns.png"><meta data-n-head="ssr" name="twitter:card" content="summary"><meta data-n-head="ssr" name="twitter:site" content="@terzi_federico"><meta data-n-head="ssr" name="twitter:title" content="Optimizing Lists in React - Solving Performance Problems and Anti-patterns"><meta data-n-head="ssr" name="twitter:description" content="React is the most popular front-end framework, and that’s for a reason. Besides being funded by one of the largest companies on the planet, it’s also built around a few key concepts (one-way data flow, immutable data, functional components, hooks) that make it easier than ever to create robust applications. That said, it’s not without pitfalls."><meta data-n-head="ssr" name="twitter:image" content="https://federicoterzi.com/social/2022-02-04-optimizing-list-in-react-solving-performance-problems-and-anti-patterns.png"><link data-n-head="ssr" rel="stylesheet" href="/colors.css"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><link data-n-head="ssr" rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><link data-n-head="ssr" rel="manifest" href="/site.webmanifest"><link data-n-head="ssr" rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"><link data-n-head="ssr" rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="preload" href="/_nuxt/0fff19e.js" as="script"><link rel="preload" href="/_nuxt/17ba505.js" as="script"><link rel="preload" href="/_nuxt/4293a24.js" as="script"><link rel="preload" href="/_nuxt/90cdebc.js" as="script"><link rel="preload" href="/_nuxt/f5ea8a1.js" as="script"><style data-vue-ssr-id="c3ae2b30:0 d75bdb94:0 fa7ff0ca:0 56b15182:0 7ab12987:0 68efd426:0 4c3275e1:0 1dd63c10:0 0356ed00:0 fcd77316:0 44de9599:0 71a90360:0">@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(/_nuxt/fonts/inter-v7-latin-regular.33e43c3.eot);src:local(""),url(/_nuxt/fonts/inter-v7-latin-regular.33e43c3.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/inter-v7-latin-regular.5e6a773.woff2) format("woff2"),url(/_nuxt/fonts/inter-v7-latin-regular.cefb4aa.woff) format("woff"),url(/_nuxt/fonts/inter-v7-latin-regular.0e67589.ttf) format("truetype"),url(/_nuxt/b8db5cf5416facf0c5ec4489d0ee9bbe.svg#Inter) format("svg")}@font-face{font-family:Inter;font-style:normal;font-weight:700;font-display:swap;src:url(/_nuxt/fonts/inter-v7-latin-700.129e115.eot);src:local(""),url(/_nuxt/fonts/inter-v7-latin-700.129e115.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/inter-v7-latin-700.c2ceaa0.woff2) format("woff2"),url(/_nuxt/fonts/inter-v7-latin-700.7f5a89b.woff) format("woff"),url(/_nuxt/fonts/inter-v7-latin-700.6bb53f6.ttf) format("truetype"),url(/_nuxt/0a85e1f2fd11f8afbfa155c7c5ec0a12.svg#Inter) format("svg")}@font-face{font-family:"PT Serif";font-style:normal;font-weight:400;font-display:swap;src:url(/_nuxt/fonts/pt-serif-v16-latin-regular.ef9b698.eot);src:local(""),url(/_nuxt/fonts/pt-serif-v16-latin-regular.ef9b698.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.511cda7.woff2) format("woff2"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.b4f2a8d.woff) format("woff"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.1602721.ttf) format("truetype"),url(/_nuxt/2b24347634a541da72419674a1818855.svg#PTSerif) format("svg")}html{--content-primary:#1a1a1a;--content-primary-inverted:#fff;--accent-primary:#c84c32;--accent-secondary:#2e4364;--accent-tertiary:#ecdbba;--accent-menu:#2e4364;--background-primary:#fff;--background-elevated:#f1f1f1;--background-semitransparent:hsla(0,0%,100%,0.7);--details:rgba(26,26,26,0.1)}html[data-theme=dark]{--content-primary:#fff;--content-primary-inverted:#1a1a1a;--accent-primary:#ef6b50;--accent-secondary:#8bb8ff;--accent-tertiary:#ecdbba;--accent-menu:#fff;--background-primary:#000;--background-elevated:#343434;--background-semitransparent:rgba(0,0,0,0.7);--details:hsla(0,0%,100%,0.1)}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}body,html{font-family:Inter,sans-serif;color:var(--content-primary);background-color:transparent;margin:0;padding:0}*{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.main-layout-container{max-width:1512px;margin:auto}.main-layout-content{padding-top:95px;min-height:100vh}@media (max-width:992px){.main-layout-content{padding-top:50px;max-width:100vw;overflow-x:hidden}}.container[data-v-71b3c000]{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;overflow:hidden;z-index:-10;background-color:var(--background-primary);transition:all .5s ease}.blurred[data-v-71b3c000]{filter:blur(50px);height:450px;width:450px}.animate[data-v-71b3c000]{-webkit-animation:rotate-center-data-v-71b3c000 120s linear infinite both;animation:rotate-center-data-v-71b3c000 120s linear infinite both}.red[data-v-71b3c000]{top:25vh;left:-10vw;background-color:var(--accent-primary)}.blue[data-v-71b3c000],.red[data-v-71b3c000]{position:absolute;opacity:.15}.blue[data-v-71b3c000]{top:0;right:-10vw;background-color:var(--accent-secondary)}.yellow[data-v-71b3c000]{position:absolute;top:75vh;left:40vw;background-color:var(--accent-tertiary);opacity:.4}html[data-theme=dark] .yellow[data-v-71b3c000]{opacity:.2}@media (max-width:992px){.blurred[data-v-71b3c000]{height:300px;width:300px}}@-webkit-keyframes rotate-center-data-v-71b3c000{0%{transform:rotate(0) translateX(0) translateY(0)}50%{transform:rotate(180deg) translateX(300px) translateY(300px)}to{transform:rotate(1turn) translateX(0) translateY(0)}}@keyframes rotate-center-data-v-71b3c000{0%{transform:rotate(0) translateX(0) translateY(0)}50%{transform:rotate(180deg) translateX(300px) translateY(300px)}to{transform:rotate(1turn) translateX(0) translateY(0)}}.header[data-v-47a7b6cf]{position:fixed;top:0;right:0;left:0;z-index:20;background-color:transparent;box-shadow:none;transition:all .2s ease-in-out}html:not([data-scroll="0"]) .header[data-v-47a7b6cf]{background-color:var(--background-primary);box-shadow:0 4px 43px rgba(0,0,0,.1)}.content[data-v-47a7b6cf]{display:flex;align-items:center;justify-content:space-between;padding:25px;max-width:1512px;margin:auto}.logo-link[data-v-47a7b6cf]{text-decoration:none}.details[data-v-47a7b6cf]{display:flex}.logo[data-v-47a7b6cf]{margin-right:16px}.details-text[data-v-47a7b6cf]{display:flex;flex-direction:column;justify-content:center}.name[data-v-47a7b6cf]{font-size:24px;line-height:28px;color:var(--accent-primary)}.name[data-v-47a7b6cf],.tagline[data-v-47a7b6cf]{font-weight:700;text-shadow:0 4px 4px rgba(0,0,0,.05)}.tagline[data-v-47a7b6cf]{font-size:14px;line-height:17px;opacity:.8;color:var(--content-primary)}html[data-theme=dark] .tagline[data-v-47a7b6cf]{opacity:.9}.menu-link[data-v-47a7b6cf]{position:relative;font-style:normal;font-weight:700;font-size:18px;line-height:22px;color:var(--accent-menu);margin-left:48px;text-decoration:none;transition:all .3s ease}.menu-link[data-v-47a7b6cf]:hover{color:var(--accent-primary)}.menu-link[data-v-47a7b6cf]:after{content:"";position:absolute;display:block;width:100%;height:2px;bottom:-3px;left:0;background-color:var(--accent-secondary);transform:scaleX(0);opacity:0;transition:all .3s ease}.menu-link[data-v-47a7b6cf]:hover:after{transform:scaleX(1);opacity:1;background-color:var(--accent-primary)}.open-mobile-menu[data-v-47a7b6cf]{display:none}.mobile-menu[data-v-47a7b6cf]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:var(--background-semitransparent);z-index:1000;box-shadow:0 3px 18px rgba(0,0,0,.1);display:flex;flex-direction:column;justify-content:center;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);perspective:1000px}.menu-divider[data-v-47a7b6cf]{opacity:.05;border-bottom:2px solid #2e4364;margin-right:32px;margin-left:32px}.fade-enter-active[data-v-47a7b6cf],.fade-leave-active[data-v-47a7b6cf]{transition:opacity .5s}.fade-enter[data-v-47a7b6cf],.fade-leave-to[data-v-47a7b6cf]{opacity:0;-webkit-backdrop-filter:blur(0);backdrop-filter:blur(0)}@media (max-width:992px){.name[data-v-47a7b6cf]{font-size:14px;line-height:17px}.tagline[data-v-47a7b6cf]{display:none}.details-text[data-v-47a7b6cf]{opacity:0;transition:opacity .2s ease-in-out}html:not([data-scroll="0"]) .details-text[data-v-47a7b6cf]{opacity:1}.content[data-v-47a7b6cf]{padding:14px}.extended-menu[data-v-47a7b6cf]{display:none}.open-mobile-menu[data-v-47a7b6cf]{display:block;margin-right:4px;filter:drop-shadow(0 4px 16px rgba(0,0,0,.25))}.menu-link[data-v-47a7b6cf]{text-align:center;margin-left:0;margin-top:18px;margin-bottom:18px;-webkit-animation:slide-in-bck-center-data-v-47a7b6cf .7s cubic-bezier(.25,.46,.45,.94) both;animation:slide-in-bck-center-data-v-47a7b6cf .7s cubic-bezier(.25,.46,.45,.94) both}.mobile-menu-links[data-v-47a7b6cf]{display:flex;flex-direction:column;justify-content:center;flex:1}.mobile-menu-label[data-v-47a7b6cf]{text-align:center;font-size:12px;margin-bottom:100px}}@-webkit-keyframes slide-in-bck-center-data-v-47a7b6cf{0%{transform:translateZ(600px);opacity:0}to{transform:translateZ(0);opacity:1}}@keyframes slide-in-bck-center-data-v-47a7b6cf{0%{transform:translateZ(600px);opacity:0}to{transform:translateZ(0);opacity:1}}.container[data-v-66baf38d]{position:relative;width:46px;height:46px}.f[data-v-66baf38d],.t[data-v-66baf38d]{position:absolute}.t[data-v-66baf38d]{left:-3px;top:-1px}@media (max-width:992px){.container[data-v-66baf38d],.f[data-v-66baf38d],.t[data-v-66baf38d]{height:32px;width:32px}.t[data-v-66baf38d]{left:-1px;top:0}}.post-title[data-v-c2aeccce]{font-style:normal;font-weight:700;font-size:36px;line-height:44px;color:var(--content-primary);margin-top:0;margin-bottom:6px}.post-details[data-v-c2aeccce]{font-size:14px;line-height:17px;color:var(--content-secondary);margin-bottom:34px}.post-footer[data-v-c2aeccce]{margin-top:28px}.short-page-container{max-width:700px;margin-right:auto;margin-left:auto;margin-top:30px;padding:28px}.short-page-title{margin-bottom:50px;margin-left:-8px}@media (max-width:992px){.short-page-container{margin-top:10px}}.post-footer-container[data-v-63505c64]{font-size:18px;line-height:22px;border-top:1px solid var(--details);padding-top:28px;display:flex}.post-footer-image[data-v-63505c64]{height:138px;width:138px}.post-footer-content[data-v-63505c64]{margin-left:28px}.post-footer-content p[data-v-63505c64]:first-child{margin-top:0}.red[data-v-63505c64]{color:var(--accent-primary)}.blue[data-v-63505c64],.red[data-v-63505c64]{font-weight:700}.blue[data-v-63505c64]{color:var(--accent-secondary)}a[data-v-63505c64]{text-underline-offset:2px;text-decoration-thickness:2px}@media (max-width:992px){.post-footer-container[data-v-63505c64]{align-items:center;flex-direction:column}.post-footer-content[data-v-63505c64]{margin-left:0;margin-top:28px}}.footer-container[data-v-83760644]{font-size:14px;line-height:17px;text-align:center;color:var(--accent-menu);margin-top:40px;padding-right:16px;padding-left:16px}.bold[data-v-83760644]{font-weight:700}.red[data-v-83760644]{color:var(--accent-primary)}.social-bar-container{position:fixed;left:24px;bottom:24px;background:var(--background-elevated);border:1px solid var(--details);box-sizing:border-box;box-shadow:0 3px 8px 2px rgba(0,0,0,.1);border-radius:4px;display:flex;justify-content:space-evenly;width:360px;padding-top:10px;padding-bottom:10px;transition:all .3s ease}html[data-scrolled-to-bottom=true] .social-bar-container{opacity:0;transform:translateY(100px)}.social-bar-container a{display:flex;align-items:center;filter:drop-shadow(0 4px 6px rgba(0,0,0,.25));transition:all .3s ease}.social-bar-container a:hover{transform:scale(1.2) translateY(-3px)}.social-bar-container a path{stroke:var(--accent-primary)}.social-bar-divider{border-left:1px solid var(--details)}@media (max-width:992px){.social-bar-container{left:0;right:0;bottom:0;width:100%;border-radius:0}}</style><link rel="preload" href="/_nuxt/static/1705674514/blog/optimizing-list-in-react-solving-performance-problems-and-anti-patterns/state.js" as="script"><link rel="preload" href="/_nuxt/static/1705674514/blog/optimizing-list-in-react-solving-performance-problems-and-anti-patterns/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1705674514/manifest.js" as="script">
    <script>const debounce=t=>{let c;return(...e)=>{c&&cancelAnimationFrame(c),c=requestAnimationFrame(()=>{t(...e)})}},handleScroll=()=>{document.documentElement.dataset.scroll=window.scrollY,document.documentElement.dataset.scrolledToBottom=window.innerHeight+window.scrollY>=document.body?.offsetHeight?"true":"false"};function switchTheme(e){"dark"===e?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light")}document.addEventListener("scroll",debounce(handleScroll),{passive:!0}),handleScroll();const prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)");prefersDarkScheme.matches&&switchTheme("dark"),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches?switchTheme("dark"):switchTheme("light"))</script>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="main-layout-container"><div class="container" data-v-71b3c000><div class="blurred red animate" data-v-71b3c000></div> <div class="blurred yellow animate" data-v-71b3c000></div> <div class="blurred blue animate" data-v-71b3c000></div></div> <div id="header" class="header" data-v-47a7b6cf><div class="content" data-v-47a7b6cf><a href="/" class="logo-link nuxt-link-active" data-v-47a7b6cf><div class="details" data-v-47a7b6cf><div class="container logo" data-v-66baf38d data-v-47a7b6cf><svg width="51" height="47" viewBox="0 0 51 47" fill="none" xmlns="http://www.w3.org/2000/svg" class="f" data-v-66baf38d data-v-66baf38d><g filter="url(#filter0_d_15_34)" data-v-66baf38d data-v-66baf38d><path d="M2.09039 44.1666V2H48L2.09039 44.1666Z" fill="#C84C32" data-v-66baf38d data-v-66baf38d></path></g><defs data-v-66baf38d data-v-66baf38d><filter id="filter0_d_15_34" x="0.0543151" y="0.506876" width="49.9818" height="46.2388" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" data-v-66baf38d data-v-66baf38d><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-66baf38d data-v-66baf38d></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" data-v-66baf38d data-v-66baf38d></feColorMatrix><feOffset dy="0.542954" data-v-66baf38d data-v-66baf38d></feOffset><feGaussianBlur stdDeviation="1.01804" data-v-66baf38d data-v-66baf38d></feGaussianBlur><feComposite in2="hardAlpha" operator="out" data-v-66baf38d data-v-66baf38d></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" data-v-66baf38d data-v-66baf38d></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_15_34" data-v-66baf38d data-v-66baf38d></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_15_34" result="shape" data-v-66baf38d data-v-66baf38d></feBlend></filter></defs></svg> <svg width="53" height="49" viewBox="0 0 53 49" fill="none" xmlns="http://www.w3.org/2000/svg" class="t" data-v-66baf38d data-v-66baf38d><g filter="url(#filter0_d_15_35)" data-v-66baf38d data-v-66baf38d><path d="M28.0452 45.0836L5 3H51L28.0452 45.0836Z" fill="url(#paint0_linear_15_35)" data-v-66baf38d data-v-66baf38d></path></g><defs data-v-66baf38d data-v-66baf38d><filter id="filter0_d_15_35" x="0.656367" y="0.556706" width="51.9725" height="48.0561" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" data-v-66baf38d data-v-66baf38d><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-66baf38d data-v-66baf38d></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" data-v-66baf38d data-v-66baf38d></feColorMatrix><feOffset dx="-1.35739" dy="0.542954" data-v-66baf38d data-v-66baf38d></feOffset><feGaussianBlur stdDeviation="1.49312" data-v-66baf38d data-v-66baf38d></feGaussianBlur><feComposite in2="hardAlpha" operator="out" data-v-66baf38d data-v-66baf38d></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0" data-v-66baf38d data-v-66baf38d></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_15_35" data-v-66baf38d data-v-66baf38d></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_15_35" result="shape" data-v-66baf38d data-v-66baf38d></feBlend></filter><linearGradient id="paint0_linear_15_35" x1="28" y1="3" x2="28" y2="45.0836" gradientUnits="userSpaceOnUse" data-v-66baf38d data-v-66baf38d><stop stop-color="#ECDBBA" stop-opacity="0.49" data-v-66baf38d data-v-66baf38d></stop><stop offset="1" stop-color="#ECDBBA" data-v-66baf38d data-v-66baf38d></stop></linearGradient></defs></svg></div> <div class="details-text" data-v-47a7b6cf><span class="name" data-v-47a7b6cf>Federico Terzi</span> <span class="tagline" data-v-47a7b6cf>A Software Engineering Journey</span></div></div></a> <div class="extended-menu" data-v-47a7b6cf><a href="/#about" class="menu-link" data-v-47a7b6cf>About</a><a href="/projects" class="menu-link" data-v-47a7b6cf>Projects</a><a href="/blog" class="menu-link nuxt-link-active" data-v-47a7b6cf>Blog</a><a href="/talks" class="menu-link" data-v-47a7b6cf>Talks</a><a href="/contact-me" class="menu-link" data-v-47a7b6cf>Contact me</a></div> <div class="open-mobile-menu" data-v-47a7b6cf><svg width="26" height="18" viewBox="0 0 26 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="menu-icon" data-v-47a7b6cf data-v-47a7b6cf><path d="M2 9.25H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-47a7b6cf data-v-47a7b6cf></path><path d="M2 2H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-47a7b6cf data-v-47a7b6cf></path><path d="M2 16.5H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-47a7b6cf data-v-47a7b6cf></path></svg></div> <!----></div></div> <div class="main-layout-content"><article data-v-c2aeccce><div class="short-page-container" data-v-c2aeccce><!----> <h1 class="post-title" data-v-c2aeccce>Optimizing Lists in React - Solving Performance Problems and Anti-patterns</h1> <p class="post-details" data-v-c2aeccce>
      February 4th, 2022 - by Federico Terzi
    </p> <div class="post-content" data-v-c2aeccce><!----> <div class="nuxt-content" data-v-c2aeccce><p data-v-c2aeccce>React is the most popular front-end framework, and that’s for a reason. Besides being funded by one of the largest companies on the planet, it’s also built around a few key concepts (one-way data flow, immutable data, functional components, hooks) that make it easier than ever to create robust applications. That said, it’s not without pitfalls.</p>

<p data-v-c2aeccce>It’s easy to write inefficient code in React, with useless re-renders being the common enemy. Usually, you start from a simple application and gradually build features on top of it. At first, the application is small enough to make the inefficiencies unnoticeable, but as the complexity grows, so does the component hierarchy, and thus, the number of re-renders. Then, once the application speed becomes unbearable (according to your standards), you start profiling and optimizing the problematic areas.</p>
<p data-v-c2aeccce>In this article, we are going to discuss the optimization process for lists, which are notorious sources of performance problems in React. Most of these techniques apply to both React and React Native applications.</p>
<h1 id="starting-from-a-problematic-example" data-v-c2aeccce><a href="#starting-from-a-problematic-example" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Starting from a problematic example</h1>
<p data-v-c2aeccce>We’ll start from a problematic example and gradually discuss the process of identifying and solving the different issues.</p>
<p data-v-c2aeccce><img alt="Problematic List example" src="/posts/react-list/react_list_example.gif" data-v-c2aeccce></p>
<p data-v-c2aeccce>The proposed example is a simple list of selectable items, with a few performance problems. Clicking on an item toggles the selection status, but the operation is visibly laggy. Our goal is to make the selection feel snappy. You can find the complete code as follows (a <a href="https://codesandbox.io/s/commonreactlistmistakes-9f3ex" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>Codesandbox</a> is also available).</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword module" data-v-c2aeccce>import</span> <span class="token imports" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span> useState <span class="token punctuation" data-v-c2aeccce>}</span></span> <span class="token keyword module" data-v-c2aeccce>from</span> <span class="token string" data-v-c2aeccce>"react"</span><span class="token punctuation" data-v-c2aeccce>;</span>

<span class="token comment" data-v-c2aeccce>// Create mock data with elements containing increasing items</span>
<span class="token keyword" data-v-c2aeccce>const</span> data <span class="token operator" data-v-c2aeccce>=</span> <span class="token keyword" data-v-c2aeccce>new</span> <span class="token class-name" data-v-c2aeccce>Array</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token number" data-v-c2aeccce>100</span><span class="token punctuation" data-v-c2aeccce>)</span>
  <span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>fill</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span>
  <span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>_<span class="token punctuation" data-v-c2aeccce>,</span> i</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> i <span class="token operator" data-v-c2aeccce>+</span> <span class="token number" data-v-c2aeccce>1</span><span class="token punctuation" data-v-c2aeccce>)</span>
  <span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>n</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token literal-property property" data-v-c2aeccce>id</span><span class="token operator" data-v-c2aeccce>:</span> n<span class="token punctuation" data-v-c2aeccce>,</span>
    <span class="token literal-property property" data-v-c2aeccce>name</span><span class="token operator" data-v-c2aeccce>:</span> <span class="token template-string" data-v-c2aeccce><span class="token template-punctuation string" data-v-c2aeccce>`</span><span class="token string" data-v-c2aeccce>Item </span><span class="token interpolation" data-v-c2aeccce><span class="token interpolation-punctuation punctuation" data-v-c2aeccce>${</span>n<span class="token interpolation-punctuation punctuation" data-v-c2aeccce>}</span></span><span class="token template-punctuation string" data-v-c2aeccce>`</span></span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>

<span class="token keyword module" data-v-c2aeccce>export</span> <span class="token keyword module" data-v-c2aeccce>default</span> <span class="token keyword" data-v-c2aeccce>function</span> <span class="token function" data-v-c2aeccce><span class="token maybe-class-name" data-v-c2aeccce>App</span></span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token comment" data-v-c2aeccce>// An array containing the selected items</span>
  <span class="token keyword" data-v-c2aeccce>const</span> <span class="token punctuation" data-v-c2aeccce>[</span>selected<span class="token punctuation" data-v-c2aeccce>,</span> setSelected<span class="token punctuation" data-v-c2aeccce>]</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useState</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>[</span><span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>

  <span class="token comment" data-v-c2aeccce>// Select or unselect the given item</span>
  <span class="token keyword" data-v-c2aeccce>const</span> <span class="token function-variable function" data-v-c2aeccce>toggleItem</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token keyword control-flow" data-v-c2aeccce>if</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token operator" data-v-c2aeccce>!</span>selected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
      <span class="token function" data-v-c2aeccce>setSelected</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>[</span><span class="token spread operator" data-v-c2aeccce>...</span>selected<span class="token punctuation" data-v-c2aeccce>,</span> item<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
    <span class="token punctuation" data-v-c2aeccce>}</span> <span class="token keyword control-flow" data-v-c2aeccce>else</span> <span class="token punctuation" data-v-c2aeccce>{</span>
      <span class="token function" data-v-c2aeccce>setSelected</span><span class="token punctuation" data-v-c2aeccce>(</span>selected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>filter</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>current</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> current <span class="token operator" data-v-c2aeccce>!==</span> item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
    <span class="token punctuation" data-v-c2aeccce>}</span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>;</span>

  <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span>div</span> <span class="token attr-name" data-v-c2aeccce>className</span><span class="token attr-value" data-v-c2aeccce><span class="token punctuation attr-equals" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>"</span>App<span class="token punctuation" data-v-c2aeccce>"</span></span><span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>
      </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span>h1</span><span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>List Example</span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;/</span>h1</span><span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>
      </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>List</span></span> <span class="token attr-name" data-v-c2aeccce>data</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>}</span></span> <span class="token attr-name" data-v-c2aeccce>selectedItems</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selected<span class="token punctuation" data-v-c2aeccce>}</span></span> <span class="token attr-name" data-v-c2aeccce>toggleItem</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>toggleItem<span class="token punctuation" data-v-c2aeccce>}</span></span> <span class="token punctuation" data-v-c2aeccce>/></span></span><span class="token plain-text" data-v-c2aeccce>
    </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;/</span>div</span><span class="token punctuation" data-v-c2aeccce>></span></span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
<span class="token punctuation" data-v-c2aeccce>}</span>

<span class="token keyword" data-v-c2aeccce>const</span> <span class="token function-variable function" data-v-c2aeccce><span class="token maybe-class-name" data-v-c2aeccce>List</span></span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span> data<span class="token punctuation" data-v-c2aeccce>,</span> selectedItems<span class="token punctuation" data-v-c2aeccce>,</span> toggleItem <span class="token punctuation" data-v-c2aeccce>}</span></span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span>ul</span><span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>
      </span><span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span>
        <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>ListItem</span></span>
          <span class="token attr-name" data-v-c2aeccce>name</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
          <span class="token attr-name" data-v-c2aeccce>selected</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selectedItems<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
          <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
        <span class="token punctuation" data-v-c2aeccce>/></span></span>
      <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span><span class="token plain-text" data-v-c2aeccce>
    </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;/</span>ul</span><span class="token punctuation" data-v-c2aeccce>></span></span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>;</span>

<span class="token keyword" data-v-c2aeccce>const</span> <span class="token function-variable function" data-v-c2aeccce><span class="token maybe-class-name" data-v-c2aeccce>ListItem</span></span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span> name<span class="token punctuation" data-v-c2aeccce>,</span> selected<span class="token punctuation" data-v-c2aeccce>,</span> onClick <span class="token punctuation" data-v-c2aeccce>}</span></span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token comment" data-v-c2aeccce>// Run an expensive operation to simulate a load</span>
  <span class="token comment" data-v-c2aeccce>// In real-world JS applications, this could be either a custom</span>
  <span class="token comment" data-v-c2aeccce>// JS elaboration or a complex render.</span>
  <span class="token function" data-v-c2aeccce>expensiveOperation</span><span class="token punctuation" data-v-c2aeccce>(</span>selected<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>

  <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span>li</span>
      <span class="token attr-name" data-v-c2aeccce>style</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selected <span class="token operator" data-v-c2aeccce>?</span> <span class="token punctuation" data-v-c2aeccce>{</span> <span class="token literal-property property" data-v-c2aeccce>textDecoration</span><span class="token operator" data-v-c2aeccce>:</span> <span class="token string" data-v-c2aeccce>"line-through"</span> <span class="token punctuation" data-v-c2aeccce>}</span> <span class="token operator" data-v-c2aeccce>:</span> <span class="token keyword nil" data-v-c2aeccce>undefined</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
      <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>onClick<span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>
      </span><span class="token punctuation" data-v-c2aeccce>{</span>name<span class="token punctuation" data-v-c2aeccce>}</span><span class="token plain-text" data-v-c2aeccce>
    </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;/</span>li</span><span class="token punctuation" data-v-c2aeccce>></span></span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>;</span>

<span class="token comment" data-v-c2aeccce>// This is an example of an expensive JS operation that we might</span>
<span class="token comment" data-v-c2aeccce>// execute in the render function to simulate a load.</span>
<span class="token comment" data-v-c2aeccce>// In real-world applications, this operation could be either a custom</span>
<span class="token comment" data-v-c2aeccce>// JS elaboration or just a complex render</span>
<span class="token keyword" data-v-c2aeccce>const</span> <span class="token function-variable function" data-v-c2aeccce>expensiveOperation</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>selected</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token comment" data-v-c2aeccce>// Here we use selected just because we want to simulate</span>
  <span class="token comment" data-v-c2aeccce>// an operation that depends on the props</span>
  <span class="token keyword" data-v-c2aeccce>let</span> total <span class="token operator" data-v-c2aeccce>=</span> selected <span class="token operator" data-v-c2aeccce>?</span> <span class="token number" data-v-c2aeccce>1</span> <span class="token operator" data-v-c2aeccce>:</span> <span class="token number" data-v-c2aeccce>0</span><span class="token punctuation" data-v-c2aeccce>;</span>
  <span class="token keyword control-flow" data-v-c2aeccce>for</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token keyword" data-v-c2aeccce>let</span> i <span class="token operator" data-v-c2aeccce>=</span> <span class="token number" data-v-c2aeccce>0</span><span class="token punctuation" data-v-c2aeccce>;</span> i <span class="token operator" data-v-c2aeccce>&lt;</span> <span class="token number" data-v-c2aeccce>200000</span><span class="token punctuation" data-v-c2aeccce>;</span> i<span class="token operator" data-v-c2aeccce>++</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
    total <span class="token operator" data-v-c2aeccce>+=</span> <span class="token known-class-name class-name" data-v-c2aeccce>Math</span><span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>random</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
  <span class="token punctuation" data-v-c2aeccce>}</span>
  <span class="token keyword control-flow" data-v-c2aeccce>return</span> total<span class="token punctuation" data-v-c2aeccce>;</span>
<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>;</span>

</code></pre></div>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>If you want to practice, feel free to pause reading and try to spot the problems yourself first</p>
</blockquote>
<p data-v-c2aeccce>Let’s dive into the analysis.</p>
<h1 id="missing-key-prop" data-v-c2aeccce><a href="#missing-key-prop" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Missing key prop</h1>
<p data-v-c2aeccce>The first thing we can notice from the console is that we are not passing the <code data-v-c2aeccce>key</code> prop when rendering the list items.</p>
<p data-v-c2aeccce><img alt="Missing key prop warning" src="/posts/react-list/missing_key_prop.png" data-v-c2aeccce></p>
<p data-v-c2aeccce>which is caused by this code:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span>
  <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>ListItem</span></span>
    <span class="token attr-name" data-v-c2aeccce>name</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>selected</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selectedItems<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
  <span class="token punctuation" data-v-c2aeccce>/></span></span>
<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span>
</code></pre></div>
<p data-v-c2aeccce>As you might already know, the <code data-v-c2aeccce>key</code> prop is critical for dynamic lists to work correctly in React, as it helps the framework identify which items have changed, are added, or are removed.</p>
<p data-v-c2aeccce>A common beginners’ anti-pattern is to solve the problem by passing the item’s index:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item<span class="token punctuation" data-v-c2aeccce>,</span> index</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span>
  <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>ListItem</span></span>
    <span class="token attr-name" data-v-c2aeccce>key</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>index<span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>name</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>selected</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selectedItems<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
  <span class="token punctuation" data-v-c2aeccce>/></span></span>
<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span>
</code></pre></div>
<p data-v-c2aeccce>Despite working for simple use-cases, this approach leads to multiple unexpected behaviors when the list is dynamic, with items being added or removed. For example, if you delete an item in the middle of a list at index N, then all list items located at positions N+1 will now have a different key. That causes React to “confuse” which mapped component belongs to which items. If you want to know more about the potential pitfalls of using the index as key, <a href="https://robinpokorny.medium.com/index-as-a-key-is-an-anti-pattern-e0349aece318" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>this article</a> is a great resource.</p>
<p data-v-c2aeccce>Therefore, you should specify a key prop with something that uniquely identifies the item being rendered. If the data you’re receiving is coming from a backend, you might be able to use the database’s unique id as key. Otherwise, you could generate a client-side random id with <a href="https://www.npmjs.com/package/nanoid" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>nanoid</a> when creating the items.</p>
<p data-v-c2aeccce>Luckily, each of our own items has it’s own id property, so we should handle it as follows:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span>
  <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>ListItem</span></span>
    <span class="token attr-name" data-v-c2aeccce>key</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>id</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>name</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>selected</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selectedItems<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
  <span class="token punctuation" data-v-c2aeccce>/></span></span>
<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span>
</code></pre></div>
<p data-v-c2aeccce>Adding the key solves the previous warning, but we still have a significant lag when selecting an item. It’s time to go serious and open the profiler.</p>
<h1 id="profiling-the-list" data-v-c2aeccce><a href="#profiling-the-list" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Profiling the list</h1>
<p data-v-c2aeccce>Now that we solved the <code data-v-c2aeccce>key</code> warning, we are ready to tackle the performance problem. At this stage, using a profiler can help to track down the slow areas and therefore guide our optimization, so that’s what we are going to do.</p>
<p data-v-c2aeccce>When working with React, there are two main profilers you can use: the browser’s built-in profiler, such as the one available inside Chrome’s Dev Tools, and the profiler provided by the React DevTools extension. Both of them are useful in different scenarios. From my experience, the React DevTools’ profiler is a good starting point, as it gives you a component-aware performance representation, which is helpful to track down the specific components that are causing problems, whereas the browser’s profiler works at a lower level and it’s mostly helpful in those cases where the performance problems are not directly related to a component, for example, due to a slow method or Redux reducer.</p>
<p data-v-c2aeccce>For this reason, we are going to start with the React DevTools’ profiler, so make sure to have the extension installed. Then, you can access the Profiler tool from Chrome’s dev tools > Profiler. Before starting, we are going to set up two settings that will help us in the optimization process:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>In Chrome’s Performance tab, set CPU throttling to x6. That will simulate a slower CPU, making slowdowns much more evident.</li>
</ul>
<p data-v-c2aeccce><img alt="CPU throttling" src="/posts/react-list/profiler_cpu_throttle.png" data-v-c2aeccce></p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>In React DevTools Profiler tab, click on the Gear icon > Profiler > “Record why each component rendered while profiling”. This will help us track down the causes for useless re-renders.</li>
</ul>
<p data-v-c2aeccce><img alt="React profiler settings" src="/posts/react-list/react_profile_settings.png" data-v-c2aeccce></p>
<p data-v-c2aeccce>Once the configuration is done, we are ready to profile our sample todo app. Go ahead and click on the Record button, then select some items in the list and, finally, hit stop recording. This is the result we obtain after selecting 3 items:</p>
<p data-v-c2aeccce><img alt="React profiler results" src="/posts/react-list/react_app_profiler_result.png" data-v-c2aeccce></p>
<p data-v-c2aeccce>On the top right side, you see highlighted in red the commits, which, in short, are the renders that caused the DOM to update. As you can see, the current commit took 2671 milliseconds to render. By hovering on the various elements, we can tell that most of the time is spent rendering the list items, with an average of 26 milliseconds per item.</p>
<p data-v-c2aeccce>Spending 26 milliseconds rendering a single item is not inherently bad. As long as the entire operation takes less than 100ms, the action would still be perceived as snappy by the user. Our biggest problem is that selecting a single item causes all the items to be re-rendered, and that’s what we are going to tackle in the next section.</p>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>A question we should ask ourselves at this point is: what’s the expected number of items to re-render after an action? In this particular case, the answer is one, as the result of a click is a new item being selected, with none of the others being affected. Another scenario might be a single-selection list, where at most one item could be selected at any given time. In that case, clicking on an item should cause the re-render of two items, as we need to render both the selected one and the one being unselected.</p>
</blockquote>
<h1 id="preventing-re-renders-with-reactmemo" data-v-c2aeccce><a href="#preventing-re-renders-with-reactmemo" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Preventing re-renders with React.memo</h1>
<p data-v-c2aeccce>In the previous section, we discussed how selecting a single item causes the entire list to be re-rendered.
Ideally, we would like to re-render only the items whose "looks" are affected by the new selection.
We can do that using the <a href="https://reactjs.org/docs/react-api.html#reactmemo" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>React.memo</a> higher-order component.</p>
<p data-v-c2aeccce>In a nutshell, <code data-v-c2aeccce>React.memo</code> compares the new props with the old ones and, if they are equal, it reuses the previous render.
Otherwise, if the props are different, it re-renders the component.
It's important to note that React executes a <strong data-v-c2aeccce>shallow comparison</strong> of the props, which must be taken
into account when passing objects and methods as props.
You can also override the comparison function, though I would advise against it, as it makes
the code less maintainable (more on this later).</p>
<p data-v-c2aeccce>Now that we know the basics of <code data-v-c2aeccce>React.memo</code>, let's create another component by wrapping the <code data-v-c2aeccce>ListItem</code> with it:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword module" data-v-c2aeccce>import</span> <span class="token imports" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span> memo <span class="token punctuation" data-v-c2aeccce>}</span></span> <span class="token keyword module" data-v-c2aeccce>from</span> <span class="token string" data-v-c2aeccce>"react"</span><span class="token punctuation" data-v-c2aeccce>;</span>

<span class="token keyword" data-v-c2aeccce>const</span> <span class="token maybe-class-name" data-v-c2aeccce>MemoizedListItem</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>memo</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token maybe-class-name" data-v-c2aeccce>ListItem</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>We can now use <code data-v-c2aeccce>MemoizedListItem</code> instead of <code data-v-c2aeccce>ListItem</code> in the list:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce>  <span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>MemoizedListItem</span></span>
      <span class="token attr-name" data-v-c2aeccce>key</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>id</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
      <span class="token attr-name" data-v-c2aeccce>name</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
      <span class="token attr-name" data-v-c2aeccce>selected</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selectedItems<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
      <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token punctuation" data-v-c2aeccce>/></span></span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span>
</code></pre></div>
<p data-v-c2aeccce>Nice! We now have memoized the <code data-v-c2aeccce>ListItem</code>. If you go ahead and try the application, you'll notice something is wrong...
The application is still slow!</p>
<p data-v-c2aeccce>If we open up the profiler as we previously did and record a selection, we should be presented with something like the following:</p>
<p data-v-c2aeccce><img alt="React profiler after memoizing" src="/posts/react-list/react_app_memoized_profiler.png" data-v-c2aeccce></p>
<p data-v-c2aeccce>As you can see, <strong data-v-c2aeccce>we are still re-rendering all the items</strong>! Why is it happening?
If you hover on one of the list items, you'll see the "Why did this render?" section. In our case, it says <code data-v-c2aeccce>Props changed: (onClick)</code>,
which means our items are re-rendering due to the <code data-v-c2aeccce>onClick</code> callback we are passing to each item.</p>
<p data-v-c2aeccce>As we previously discussed, <code data-v-c2aeccce>React.memo</code> does a <em data-v-c2aeccce>shallow comparison</em> of the props by default.
Which basically means calling the strick equality operator <code data-v-c2aeccce>===</code> over each prop. In our case, the check would
be roughly equivalent to:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-js" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword" data-v-c2aeccce>function</span> <span class="token function" data-v-c2aeccce>arePropsEqual</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>prevProps<span class="token punctuation" data-v-c2aeccce>,</span> nextProps</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token keyword control-flow" data-v-c2aeccce>return</span> prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span> <span class="token operator" data-v-c2aeccce>&&</span>
         prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>selected</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>selected</span> <span class="token operator" data-v-c2aeccce>&&</span>
         prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>onClick</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>onClick</span>
<span class="token punctuation" data-v-c2aeccce>}</span>
</code></pre></div>
<p data-v-c2aeccce>While <code data-v-c2aeccce>name</code> and <code data-v-c2aeccce>selected</code> are compared by <em data-v-c2aeccce>value</em> (because they are primitive types, string and boolean respectively), <code data-v-c2aeccce>onClick</code> is compared
by <em data-v-c2aeccce>reference</em> (being a function).
When we created the list items, we passed the <code data-v-c2aeccce>onClick</code> callback as an anonymous closure:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce>onClick<span class="token operator" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span>
</code></pre></div>
<p data-v-c2aeccce>Every time the list re-renders, <strong data-v-c2aeccce>each item receives a new callback function</strong>.
From an equality perspective, the callback <em data-v-c2aeccce>has changed</em>, and therefore the <code data-v-c2aeccce>MemoizedListItem</code> is re-rendered.</p>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>If the equality aspect is still unclear to you, go ahead and open the JS console inside your browser.
If you type <code data-v-c2aeccce>true === true</code>, you'll notice that the result is <code data-v-c2aeccce>true</code>.
But if you type <code data-v-c2aeccce>(() => {}) === (() => {})</code>, you'll get <code data-v-c2aeccce>false</code> as result.
That's because two functions are equal only if they share the same identity, and
every time we create a new closure we generate a new identity.</p>
</blockquote>
<p data-v-c2aeccce>Therefore, we need a way to keep the identity of the <code data-v-c2aeccce>onClick</code> callback stable to prevent useless re-renders,
and that's what we are going to discuss in the next sections.</p>
<h2 id="a-common-anti-pattern" data-v-c2aeccce><a href="#a-common-anti-pattern" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>A common anti-pattern</h2>
<p data-v-c2aeccce>Before discussing the proposed solution, let's analyze a common (anti-)pattern being used in these cases.
Given that the <code data-v-c2aeccce>React.memo</code> method accepts a custom comparator, you might be tempted to provide one that
artifically <em data-v-c2aeccce>excludes</em> <code data-v-c2aeccce>onClick</code> from the check. Something like the following:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword" data-v-c2aeccce>const</span> <span class="token maybe-class-name" data-v-c2aeccce>MemoizedListItem</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>memo</span><span class="token punctuation" data-v-c2aeccce>(</span>
  <span class="token maybe-class-name" data-v-c2aeccce>ListItem</span><span class="token punctuation" data-v-c2aeccce>,</span>
  <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>prevProps<span class="token punctuation" data-v-c2aeccce>,</span> nextProps</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span>
    prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span> <span class="token operator" data-v-c2aeccce>&&</span>
    prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>selected</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>selected</span>
    <span class="token comment" data-v-c2aeccce>// The onClick prop is not compared</span>
<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>In this case, even with a changing <code data-v-c2aeccce>onClick</code> callback, the list items won't be re-rendered unless <code data-v-c2aeccce>name</code> or <code data-v-c2aeccce>selected</code> are updated.
If you go ahead and try this approach, you'll notice the list feels snappy now, but something is wrong:</p>
<p data-v-c2aeccce><img alt="React list custom comparator" src="/posts/react-list/react_list_example_custom_comparator.gif" data-v-c2aeccce></p>
<p data-v-c2aeccce>As you can see, selecting multiple items doesn't work as expected now, with items being randomly selected and unselected.
This is happening because the <strong data-v-c2aeccce><code data-v-c2aeccce>toggleItem</code> function is not pure</strong>, as it depends on the previous value of the <code data-v-c2aeccce>selected</code> items.
If you exclude the <code data-v-c2aeccce>onClick</code> callback check from the <code data-v-c2aeccce>React.memo</code> comparator, then your components might receive an outdated (stale)
version of the callback, causing all those glitches.</p>
<p data-v-c2aeccce>In this particular case, the way the <code data-v-c2aeccce>toggleItem</code> is implemented is not optimal and we can easily convert it to a pure function
(in fact, we are going to do that in the next section). But my point here is: <strong data-v-c2aeccce>by excluding the <code data-v-c2aeccce>onClick</code> callback from the <code data-v-c2aeccce>memo</code>
comparator, you're exposing the application to subtle staleness bugs</strong>.</p>
<p data-v-c2aeccce>Some might argue that as long as the <code data-v-c2aeccce>onClick</code> callback is kept <em data-v-c2aeccce>pure</em>, then this approach is perfectly acceptable.
Personally, I consider this an anti-pattern for two reasons:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>In complex codebases is relatively easy to transform a pure function into a non-pure one by mistake.</li>
<li data-v-c2aeccce>By writing a custom comparator,  you're creating an additional maintenance burden. What if the <code data-v-c2aeccce>ListItem</code> needs to accept another <code data-v-c2aeccce>color</code> parameter in the future?</li>
</ul>
<p data-v-c2aeccce>Then, you'll need to refactor to the comparator, as shown below. If you forget to add it (which is relatively easy in complex codebases with multiple contributors), then you are again exposing your component to staleness bugs.</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword" data-v-c2aeccce>const</span> <span class="token maybe-class-name" data-v-c2aeccce>MemoizedListItem</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>memo</span><span class="token punctuation" data-v-c2aeccce>(</span>
  <span class="token maybe-class-name" data-v-c2aeccce>ListItem</span><span class="token punctuation" data-v-c2aeccce>,</span>
  <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>prevProps<span class="token punctuation" data-v-c2aeccce>,</span> nextProps</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span>
    prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span> <span class="token operator" data-v-c2aeccce>&&</span>
    prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>selected</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>selected</span> <span class="token operator" data-v-c2aeccce>&&</span>
    prevProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>color</span> <span class="token operator" data-v-c2aeccce>===</span> nextProps<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>color</span>
<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>If a custom comparator is not advisable, what should we do to solve this problem then?</p>
<h1 id="making-callback-identities-stable" data-v-c2aeccce><a href="#making-callback-identities-stable" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Making callback identities stable</h1>
<p data-v-c2aeccce>Our goal is to use the "base" version of <code data-v-c2aeccce>React.memo</code> without a custom comparator.
Choosing this path will both improve the maintainability of the component and its robustness against future changes.
For the memoization to work correctly though, we'll need to <strong data-v-c2aeccce>refactor the callback to keep its identity stable</strong>, otherwise
the equality check performed by <code data-v-c2aeccce>React.memo</code> will prevent the memoization.</p>
<p data-v-c2aeccce>The traditional way to keep function identities stable in React is to use the <code data-v-c2aeccce>useCallback</code> hook.
The hook accepts a function and a dependency array, and as long as the dependencies won't change, neither will the identity of the callback.
Let's refactor our example to use <code data-v-c2aeccce>useCallback</code>:</p>
<p data-v-c2aeccce>Our first attempt is to move the anonymous closure <code data-v-c2aeccce>() => toggleItem(item)</code> inside a separate method inside <code data-v-c2aeccce>useCallback</code>:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword" data-v-c2aeccce>const</span> <span class="token function-variable function" data-v-c2aeccce><span class="token maybe-class-name" data-v-c2aeccce>List</span></span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span> data<span class="token punctuation" data-v-c2aeccce>,</span> selectedItems<span class="token punctuation" data-v-c2aeccce>,</span> toggleItem <span class="token punctuation" data-v-c2aeccce>}</span></span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token keyword" data-v-c2aeccce>const</span> handleClick <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token operator" data-v-c2aeccce>??</span><span class="token operator" data-v-c2aeccce>??</span><span class="token operator" data-v-c2aeccce>??</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token comment" data-v-c2aeccce>// How do we get the item?</span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span> <span class="token punctuation" data-v-c2aeccce>[</span>toggleItem<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span>

  <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span>ul</span><span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>
      </span><span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span>
        <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>MemoizedListItem</span></span>
          <span class="token attr-name" data-v-c2aeccce>key</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>id</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
          <span class="token attr-name" data-v-c2aeccce>name</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
          <span class="token attr-name" data-v-c2aeccce>selected</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selectedItems<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
          <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>handleClick<span class="token punctuation" data-v-c2aeccce>}</span></span>
        <span class="token punctuation" data-v-c2aeccce>/></span></span>
      <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span><span class="token plain-text" data-v-c2aeccce>
    </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;/</span>ul</span><span class="token punctuation" data-v-c2aeccce>></span></span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>We are now facing a problem: previously, the anonymous closure captured the current <code data-v-c2aeccce>item</code> in the <code data-v-c2aeccce>.map</code> iteration and then passed it to the <code data-v-c2aeccce>toggleItem</code>
function as an argument. But now, we are not declaring the <code data-v-c2aeccce>handleClick</code> handler inside the iteration, so how can we access the "selected item" in the callback?
Let's discuss a possible solution:</p>
<h2 id="refactoring-the-listitem-component" data-v-c2aeccce><a href="#refactoring-the-listitem-component" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Refactoring the ListItem component</h2>
<p data-v-c2aeccce>Currently, the <code data-v-c2aeccce>ListItem</code>'s <code data-v-c2aeccce>onClick</code> callback doesn't provide any information about the item being selected.
If it did, we would be able to easily solve this problem, so let's refactor the <code data-v-c2aeccce>ListItem</code> and <code data-v-c2aeccce>List</code> components to provide this information.</p>
<p data-v-c2aeccce>Firstly, we change the <code data-v-c2aeccce>ListItem</code> component to accept the full <code data-v-c2aeccce>item</code> object, and given that the <code data-v-c2aeccce>name</code> prop is now redundant we remove it.
Then, we introduce an handler for the <code data-v-c2aeccce>onClick</code> event to also provide the <code data-v-c2aeccce>item</code> as argument. This is our end result:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword" data-v-c2aeccce>const</span> <span class="token function-variable function" data-v-c2aeccce><span class="token maybe-class-name" data-v-c2aeccce>ListItem</span></span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span> item<span class="token punctuation" data-v-c2aeccce>,</span> selected<span class="token punctuation" data-v-c2aeccce>,</span> onClick <span class="token punctuation" data-v-c2aeccce>}</span></span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token comment" data-v-c2aeccce>// Run an expensive operation to simulate a load</span>
  <span class="token comment" data-v-c2aeccce>// In real-world JS applications, this could be either a custom</span>
  <span class="token comment" data-v-c2aeccce>// JS elaboration or a complex render.</span>
  <span class="token function" data-v-c2aeccce>expensiveOperation</span><span class="token punctuation" data-v-c2aeccce>(</span>selected<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>

  <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span>li</span>
      <span class="token attr-name" data-v-c2aeccce>style</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selected <span class="token operator" data-v-c2aeccce>?</span> <span class="token punctuation" data-v-c2aeccce>{</span> <span class="token literal-property property" data-v-c2aeccce>textDecoration</span><span class="token operator" data-v-c2aeccce>:</span> <span class="token string" data-v-c2aeccce>"line-through"</span> <span class="token punctuation" data-v-c2aeccce>}</span> <span class="token operator" data-v-c2aeccce>:</span> <span class="token keyword nil" data-v-c2aeccce>undefined</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
      <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token function" data-v-c2aeccce>onClick</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
    <span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>
      </span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>}</span><span class="token plain-text" data-v-c2aeccce>
    </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;/</span>li</span><span class="token punctuation" data-v-c2aeccce>></span></span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>As you can see, the <code data-v-c2aeccce>onClick</code> now provides the current item as a parameter.</p>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>But wait! You used an anonymous closure again in the <code data-v-c2aeccce>li</code>'s <code data-v-c2aeccce>onClick</code> handler, shouldn't we avoid them to prevent re-renderings?
While we <em data-v-c2aeccce>could</em> create another memoized callback with <code data-v-c2aeccce>useCallback</code> inside the <code data-v-c2aeccce>ListItem</code> component to handle the click event, that would offer no performance improvements in this case.
The problem with the anonymous closure we discussed earlier in the <code data-v-c2aeccce>List</code> item was that it broke the <code data-v-c2aeccce>React.memo</code> memoization for the <code data-v-c2aeccce>MemoizedListItem</code>. Given that we are <em data-v-c2aeccce>not</em> memoizing the <code data-v-c2aeccce>li</code> element, then there is no performance benefit from having a stable identity for this callback.</p>
</blockquote>
<p data-v-c2aeccce>We can then refactor the <code data-v-c2aeccce>List</code> component to pass the <code data-v-c2aeccce>item</code> prop instead of <code data-v-c2aeccce>name</code> and to make use of the newly available <code data-v-c2aeccce>item</code> information in the <code data-v-c2aeccce>handleClick</code> callback:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-jsx" data-v-c2aeccce><code data-v-c2aeccce><span class="token keyword" data-v-c2aeccce>const</span> <span class="token function-variable function" data-v-c2aeccce><span class="token maybe-class-name" data-v-c2aeccce>List</span></span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>{</span> data<span class="token punctuation" data-v-c2aeccce>,</span> selectedItems<span class="token punctuation" data-v-c2aeccce>,</span> toggleItem <span class="token punctuation" data-v-c2aeccce>}</span></span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
  <span class="token keyword" data-v-c2aeccce>const</span> handleClick <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>  <span class="token comment" data-v-c2aeccce>// We now receive the selected item</span>
      <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
    <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span>
    <span class="token punctuation" data-v-c2aeccce>[</span>toggleItem<span class="token punctuation" data-v-c2aeccce>]</span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>

  <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span>ul</span><span class="token punctuation" data-v-c2aeccce>></span></span><span class="token plain-text" data-v-c2aeccce>
      </span><span class="token punctuation" data-v-c2aeccce>{</span>data<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>map</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>(</span>
        <span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;</span><span class="token class-name" data-v-c2aeccce>MemoizedListItem</span></span>
          <span class="token attr-name" data-v-c2aeccce>key</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>id</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
          <span class="token attr-name" data-v-c2aeccce>item</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>item<span class="token punctuation" data-v-c2aeccce>}</span></span>  <span class="token comment" data-v-c2aeccce>// We pass the full item instead of the name</span>
          <span class="token attr-name" data-v-c2aeccce>selected</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>selectedItems<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span></span>
          <span class="token attr-name" data-v-c2aeccce>onClick</span><span class="token script language-javascript" data-v-c2aeccce><span class="token script-punctuation punctuation" data-v-c2aeccce>=</span><span class="token punctuation" data-v-c2aeccce>{</span>handleClick<span class="token punctuation" data-v-c2aeccce>}</span></span>
        <span class="token punctuation" data-v-c2aeccce>/></span></span>
      <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>}</span><span class="token plain-text" data-v-c2aeccce>
    </span><span class="token tag" data-v-c2aeccce><span class="token tag" data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>&lt;/</span>ul</span><span class="token punctuation" data-v-c2aeccce>></span></span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>Nice! Let's go ahead and try the refactored version:</p>
<p data-v-c2aeccce><img alt="React list example, after changes" src="/posts/react-list/react_list_example_2.gif" data-v-c2aeccce></p>
<p data-v-c2aeccce>It works... but it's still slow! If we open up the profiler, we can see the whole list is still being rendered:</p>
<p data-v-c2aeccce><img alt="Profiler results after changes" src="/posts/react-list/react_list_perf.png" data-v-c2aeccce></p>
<p data-v-c2aeccce>As you can see from the profiler, the <code data-v-c2aeccce>onClick</code> identity is still changing! That means our <code data-v-c2aeccce>handleClick</code> identity is being changed at every re-render.</p>
<h2 id="another-common-anti-pattern" data-v-c2aeccce><a href="#another-common-anti-pattern" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Another common anti-pattern</h2>
<p data-v-c2aeccce>Before diving into the proper solution, let's discuss a common anti-pattern used in these cases.
Given that the <code data-v-c2aeccce>useCallback</code> accepts a dependency array, you could be tempted to specify an empty one to keep the identity fixed:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-js" data-v-c2aeccce><code data-v-c2aeccce>  <span class="token keyword" data-v-c2aeccce>const</span> handleClick <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span> <span class="token punctuation" data-v-c2aeccce>[</span><span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>Despite keeping the identity stable, <strong data-v-c2aeccce>this approach suffers from the same staleness bugs we discussed in previous sections</strong>.
If we run it, you'll notice the items get unselected as it happened when we specified the custom comparator:</p>
<p data-v-c2aeccce><img alt="React list example with bugs" src="/posts/react-list/react_list_example_3.gif" data-v-c2aeccce></p>
<p data-v-c2aeccce>In general, you should always specify the correct dependencies in <code data-v-c2aeccce>useCallback</code>, <code data-v-c2aeccce>useEffect</code> and <code data-v-c2aeccce>useMemo</code>, otherwise, you're
exposing the application to potentially hard-to-debug staleness bugs.</p>
<h1 id="solving-the-toggleitem-identity-problem" data-v-c2aeccce><a href="#solving-the-toggleitem-identity-problem" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Solving the toggleItem identity problem</h1>
<p data-v-c2aeccce>As we previously discussed, the problem with our <code data-v-c2aeccce>handleClick</code> callback is that its <code data-v-c2aeccce>toggleItem</code> dependency identity changes at each render, causing it to re-render as well:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-js" data-v-c2aeccce><code data-v-c2aeccce>  <span class="token keyword" data-v-c2aeccce>const</span> handleClick <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token function" data-v-c2aeccce>toggleItem</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span> <span class="token punctuation" data-v-c2aeccce>[</span>toggleItem<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>Our first attempt is to wrap <code data-v-c2aeccce>toggleItem</code> with <code data-v-c2aeccce>useCallback</code> as we did with <code data-v-c2aeccce>handleClick</code>:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-js" data-v-c2aeccce><code data-v-c2aeccce>  <span class="token keyword" data-v-c2aeccce>const</span> toggleItem <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span>
    <span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
      <span class="token keyword control-flow" data-v-c2aeccce>if</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token operator" data-v-c2aeccce>!</span>selected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
        <span class="token function" data-v-c2aeccce>setSelected</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>[</span><span class="token spread operator" data-v-c2aeccce>...</span>selected<span class="token punctuation" data-v-c2aeccce>,</span> item<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
      <span class="token punctuation" data-v-c2aeccce>}</span> <span class="token keyword control-flow" data-v-c2aeccce>else</span> <span class="token punctuation" data-v-c2aeccce>{</span>
        <span class="token function" data-v-c2aeccce>setSelected</span><span class="token punctuation" data-v-c2aeccce>(</span>selected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>filter</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>current</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> current <span class="token operator" data-v-c2aeccce>!==</span> item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
      <span class="token punctuation" data-v-c2aeccce>}</span>
    <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span>
    <span class="token punctuation" data-v-c2aeccce>[</span>selected<span class="token punctuation" data-v-c2aeccce>]</span>
  <span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>This does <em data-v-c2aeccce>not</em> solve the problem though, as this callback depends on the external state variable <code data-v-c2aeccce>selected</code>, which changes every time <code data-v-c2aeccce>setSelected</code> is called. If we want its identity to remain stable, we need a way to make <code data-v-c2aeccce>toggleItem</code> pure. Luckily, we can use <a href="https://reactjs.org/docs/hooks-reference.html#functional-updates" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce><code data-v-c2aeccce>useState</code>'s functional updates</a> to accomplish our goal:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-js" data-v-c2aeccce><code data-v-c2aeccce>  <span class="token keyword" data-v-c2aeccce>const</span> toggleItem <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token function" data-v-c2aeccce>setSelected</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>prevSelected</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
      <span class="token keyword control-flow" data-v-c2aeccce>if</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token operator" data-v-c2aeccce>!</span>prevSelected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
        <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>[</span><span class="token spread operator" data-v-c2aeccce>...</span>prevSelected<span class="token punctuation" data-v-c2aeccce>,</span> item<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>;</span>
      <span class="token punctuation" data-v-c2aeccce>}</span> <span class="token keyword control-flow" data-v-c2aeccce>else</span> <span class="token punctuation" data-v-c2aeccce>{</span>
        <span class="token keyword control-flow" data-v-c2aeccce>return</span> prevSelected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>filter</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>current</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> current <span class="token operator" data-v-c2aeccce>!==</span> item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
      <span class="token punctuation" data-v-c2aeccce>}</span>
    <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span> <span class="token punctuation" data-v-c2aeccce>[</span><span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>As you can see, we wrapped our previous logic inside the <code data-v-c2aeccce>setSelected</code> call, which in turn provides the previous state value we need to compute the new selected items.</p>
<p data-v-c2aeccce>If we go ahead and run the refactored example, it works and it's also snappy! We can also run the usual profiler to get a sense of what's happening:</p>
<p data-v-c2aeccce>Hovering on the item being rendered:
<img alt="Fixed react example" src="/posts/react-list/react_list_memo_good_2.png" data-v-c2aeccce></p>
<p data-v-c2aeccce>Hovering on the other items:
<img alt="Fixed react example 2" src="/posts/react-list/react_list_memo_good_1.png" data-v-c2aeccce></p>
<p data-v-c2aeccce>As you can see, after selecting an item we only render the current one being selected now, while the others are being memoized.</p>
<h2 id="a-note-on-functional-state-updates" data-v-c2aeccce><a href="#a-note-on-functional-state-updates" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>A note on functional state updates</h2>
<p data-v-c2aeccce>In the example we just discussed, converting our <code data-v-c2aeccce>toggleItem</code> method to the functional mode of <code data-v-c2aeccce>useState</code> was relatively trivial.
In real-world scenarios, things might not be as straightforward.</p>
<p data-v-c2aeccce>For example, your function might depend on multiple state pieces:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-js" data-v-c2aeccce><code data-v-c2aeccce>  <span class="token keyword" data-v-c2aeccce>const</span> <span class="token punctuation" data-v-c2aeccce>[</span>selected<span class="token punctuation" data-v-c2aeccce>,</span> setSelected<span class="token punctuation" data-v-c2aeccce>]</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useState</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>[</span><span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
  <span class="token keyword" data-v-c2aeccce>const</span> <span class="token punctuation" data-v-c2aeccce>[</span>isEnabled<span class="token punctuation" data-v-c2aeccce>,</span> setEnabled<span class="token punctuation" data-v-c2aeccce>]</span> <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useState</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token boolean" data-v-c2aeccce>false</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>

  <span class="token keyword" data-v-c2aeccce>const</span> toggleItem <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token comment" data-v-c2aeccce>// Only toggle the items if enabled</span>
    <span class="token keyword control-flow" data-v-c2aeccce>if</span> <span class="token punctuation" data-v-c2aeccce>(</span>isEnabled<span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
      <span class="token function" data-v-c2aeccce>setSelected</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>prevSelected</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
        <span class="token keyword control-flow" data-v-c2aeccce>if</span> <span class="token punctuation" data-v-c2aeccce>(</span><span class="token operator" data-v-c2aeccce>!</span>prevSelected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>includes</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token punctuation" data-v-c2aeccce>{</span>
          <span class="token keyword control-flow" data-v-c2aeccce>return</span> <span class="token punctuation" data-v-c2aeccce>[</span><span class="token spread operator" data-v-c2aeccce>...</span>prevSelected<span class="token punctuation" data-v-c2aeccce>,</span> item<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>;</span>
        <span class="token punctuation" data-v-c2aeccce>}</span> <span class="token keyword control-flow" data-v-c2aeccce>else</span> <span class="token punctuation" data-v-c2aeccce>{</span>
          <span class="token keyword control-flow" data-v-c2aeccce>return</span> prevSelected<span class="token punctuation" data-v-c2aeccce>.</span><span class="token method function property-access" data-v-c2aeccce>filter</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>current</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> current <span class="token operator" data-v-c2aeccce>!==</span> item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
        <span class="token punctuation" data-v-c2aeccce>}</span>
      <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
    <span class="token punctuation" data-v-c2aeccce>}</span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span> <span class="token punctuation" data-v-c2aeccce>[</span>isEnabled<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<p data-v-c2aeccce>Every time the <code data-v-c2aeccce>isEnabled</code> value changes, your <code data-v-c2aeccce>toggleItem</code> identity will change as well.
In these scenarios, you should either merge both sub-states into the same <code data-v-c2aeccce>useState</code> call, or even better, convert it to a <a href="https://reactjs.org/docs/hooks-reference.html#additional-hooks" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce><code data-v-c2aeccce>useReducer</code></a> one.
Given that <code data-v-c2aeccce>useReducer</code>'s <code data-v-c2aeccce>dispatch</code> function has a stable identity, you can scale this approach to complex states.
Moreover, the same applies to <a href="https://redux.js.org/" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>Redux</a>'s <code data-v-c2aeccce>dispatch</code> function, so you can move the item toggle logic at the Redux level and convert our <code data-v-c2aeccce>toggleItem</code> function to something as:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-js" data-v-c2aeccce><code data-v-c2aeccce>  <span class="token keyword" data-v-c2aeccce>const</span> dispatch <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useDispatch</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>

  <span class="token comment" data-v-c2aeccce>// Given that the dispatch identity is stable, the `toggleItem` will be stable as well</span>
  <span class="token keyword" data-v-c2aeccce>const</span> toggleItem <span class="token operator" data-v-c2aeccce>=</span> <span class="token function" data-v-c2aeccce>useCallback</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token parameter" data-v-c2aeccce>item</span><span class="token punctuation" data-v-c2aeccce>)</span> <span class="token arrow operator" data-v-c2aeccce>=></span> <span class="token punctuation" data-v-c2aeccce>{</span>
    <span class="token function" data-v-c2aeccce>dispatch</span><span class="token punctuation" data-v-c2aeccce>(</span><span class="token function" data-v-c2aeccce>toggleItemAction</span><span class="token punctuation" data-v-c2aeccce>(</span>item<span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>)</span>
  <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>,</span> <span class="token punctuation" data-v-c2aeccce>[</span>dispatch<span class="token punctuation" data-v-c2aeccce>]</span><span class="token punctuation" data-v-c2aeccce>)</span><span class="token punctuation" data-v-c2aeccce>;</span>
</code></pre></div>
<h1 id="virtualizing-the-list" data-v-c2aeccce><a href="#virtualizing-the-list" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Virtualizing the list?</h1>
<p data-v-c2aeccce>Before closing the article, I wanted to briefly cover <em data-v-c2aeccce>list virtualization</em>, a common technique used to improve performance for long lists.
In a nutshell, list virtualization is based on the idea of rendering just a sub-set of the items in a given list (generally the currently visible ones) and deferring the others.
For example, if you have a list with a thousand items but only 10 are visible at any given time, then we might only render these 10 first, and the others can be rendered <em data-v-c2aeccce>on-demand</em> when needed (i.e. after scrolling).</p>
<p data-v-c2aeccce>List virtualization offers two main advantages compared to rendering the entire list:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>Faster initial start time, as we only need to render a subset of the list</li>
<li data-v-c2aeccce>Lower memory usage, as only a subset of the items is being rendered at any given time</li>
</ul>
<p data-v-c2aeccce>That said, list virtualization is not a silver bullet you should always use, as it increases complexity and can be glitchy.
Personally, I'd avoid virtualized lists if you are only dealing with hundreds of items, as the memoization techniques we discussed in this article are often effective enough  (older mobile devices might require a lower threshold). As always, the right approach depends on the specific use case, so I'd highly recommend profiling your list before diving into more complex optimization techniques.</p>
<p data-v-c2aeccce>We are going to cover virtualization in a future article. In the meanwhile, you can read more about virtualized lists in React, with libraries like <a href="https://github.com/bvaughn/react-window" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>react-window</a>, and in React Native, with the built-in <a href="https://reactnative.dev/docs/flatlist" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>FlatList</a> component.</p>
<h1 id="conclusion" data-v-c2aeccce><a href="#conclusion" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Conclusion</h1>
<p data-v-c2aeccce>In this article, we covered list optimization in depth. We started from a problematic example and gradually solved most of the performance problems.
We also discussed the main anti-patterns you should be aware of, along with potential ways to solve them.</p>
<p data-v-c2aeccce>In conclusion, lists are often the cause of performance problems in React, as all items are being re-rendered every time something changes by default.
<code data-v-c2aeccce>React.memo</code> is an effective tool to mitigate the issue, but you might need to refactor your application to make your props' identities stable.</p>
<p data-v-c2aeccce>The final code is available in <a href="https://codesandbox.io/s/commonreactlistmistakes-solved-7sn20?file=/src/App.js" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>this CodeSandbox</a> if you're interested.</p>
<p data-v-c2aeccce>PS: there's one small <code data-v-c2aeccce>useMemo</code> optimization left to add in our example, can you spot it yourself? :)</p></div></div> <div class="post-footer-container post-footer" data-v-63505c64 data-v-c2aeccce><img src="/_nuxt/img/profile-picture-small.40e71b2.png" alt="Federico Terzi Picture" class="post-footer-image" data-v-63505c64> <div class="post-footer-content" data-v-63505c64><p data-v-63505c64>Hi 👋, I’m <span class="red" data-v-63505c64>Federico</span>, thanks for reading!</p> <p data-v-63505c64>
      If you liked this article, make sure to follow me on
      <a href="https://twitter.com/terzi_federico" class="blue" data-v-63505c64>Twitter</a> to
      stay updated with the latest ones :)
    </p> <p data-v-63505c64>
      If you are into technical topics, you might also enjoy my
      <a href="https://www.youtube.com/c/FedericoTerzi" class="red" data-v-63505c64>YouTube</a>
      channel.
    </p></div></div></div></article></div> <div class="footer-container" data-v-83760644><p data-v-83760644><span class="bold" data-v-83760644>Designed</span> and
    <span class="bold" data-v-83760644>coded</span> with<span class="red" data-v-83760644> ♥</span> by me.
    Copyright © Federico Terzi 2019-2023 - P.IVA 03864201201
  </p></div> <div class="social-bar-container"><a href="https://twitter.com/terzi_federico"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23 3.00005C22.0424 3.67552 20.9821 4.19216 19.86 4.53005C19.2577 3.83756 18.4573 3.34674 17.567 3.12397C16.6767 2.90121 15.7395 2.95724 14.8821 3.2845C14.0247 3.61176 13.2884 4.19445 12.773 4.95376C12.2575 5.71308 11.9877 6.61238 12 7.53005V8.53005C10.2426 8.57561 8.50127 8.18586 6.93101 7.39549C5.36074 6.60513 4.01032 5.43868 3 4.00005C3 4.00005 -1 13 8 17C5.94053 18.398 3.48716 19.099 1 19C10 24 21 19 21 7.50005C20.9991 7.2215 20.9723 6.94364 20.92 6.67005C21.9406 5.66354 22.6608 4.39276 23 3.00005V3.00005Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a> <div class="social-bar-divider"></div> <a href="https://github.com/federico-terzi/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_31_53)"><path d="M16 21.9999V18.1299C16.0375 17.6531 15.9731 17.1737 15.811 16.7237C15.6489 16.2737 15.3929 15.8634 15.06 15.5199C18.2 15.1699 21.5 13.9799 21.5 8.51994C21.4997 7.12376 20.9627 5.78114 20 4.76994C20.4559 3.54844 20.4236 2.19829 19.91 0.999938C19.91 0.999938 18.73 0.649938 16 2.47994C13.708 1.85876 11.292 1.85876 9 2.47994C6.27 0.649938 5.09 0.999938 5.09 0.999938C4.57638 2.19829 4.54414 3.54844 5 4.76994C4.03013 5.78864 3.49252 7.1434 3.5 8.54994C3.5 13.9699 6.8 15.1599 9.94 15.5499C9.611 15.8899 9.35726 16.2953 9.19531 16.7399C9.03335 17.1844 8.96681 17.658 9 18.1299V21.9999M9 18.9999C4 20.4999 4 16.4999 2 15.9999L9 18.9999Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></g><defs><clipPath id="clip0_31_53"><rect width="24" height="24" fill="white"></rect></clipPath></defs></svg></a> <div class="social-bar-divider"></div> <a href="https://www.linkedin.com/in/federico-terzi/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 8C17.5913 8 19.1174 8.63214 20.2426 9.75736C21.3679 10.8826 22 12.4087 22 14V21H18V14C18 13.4696 17.7893 12.9609 17.4142 12.5858C17.0391 12.2107 16.5304 12 16 12C15.4696 12 14.9609 12.2107 14.5858 12.5858C14.2107 12.9609 14 13.4696 14 14V21H10V14C10 12.4087 10.6321 10.8826 11.7574 9.75736C12.8826 8.63214 14.4087 8 16 8V8Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 9H2V21H6V9Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4 6C5.10457 6 6 5.10457 6 4C6 2.89543 5.10457 2 4 2C2.89543 2 2 2.89543 2 4C2 5.10457 2.89543 6 4 6Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a> <div class="social-bar-divider"></div> <a href="https://www.youtube.com/c/FedericoTerzi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22.54 6.42C22.4212 5.94541 22.1793 5.51057 21.8387 5.15941C21.498 4.80824 21.0708 4.55318 20.6 4.42C18.88 4 12 4 12 4C12 4 5.12001 4 3.40001 4.46C2.92925 4.59318 2.50198 4.84824 2.16135 5.19941C1.82072 5.55057 1.5788 5.98541 1.46001 6.46C1.14522 8.20556 0.991243 9.97631 1.00001 11.75C0.988786 13.537 1.14277 15.3213 1.46001 17.08C1.59097 17.5398 1.83831 17.9581 2.17815 18.2945C2.51799 18.6308 2.93883 18.8738 3.40001 19C5.12001 19.46 12 19.46 12 19.46C12 19.46 18.88 19.46 20.6 19C21.0708 18.8668 21.498 18.6118 21.8387 18.2606C22.1793 17.9094 22.4212 17.4746 22.54 17C22.8524 15.2676 23.0063 13.5103 23 11.75C23.0112 9.96295 22.8572 8.1787 22.54 6.42V6.42Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.75 15.02L15.5 11.75L9.75 8.47998V15.02Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></div></div></div></div><script defer src="/_nuxt/static/1705674514/blog/optimizing-list-in-react-solving-performance-problems-and-anti-patterns/state.js"></script><script src="/_nuxt/0fff19e.js" defer></script><script src="/_nuxt/f5ea8a1.js" defer></script><script src="/_nuxt/17ba505.js" defer></script><script src="/_nuxt/4293a24.js" defer></script><script src="/_nuxt/90cdebc.js" defer></script>
  </body>
</html>

<!doctype html>
<!-- 
  Hi there! Welcome to my website :)
  It seems you are interested in the source code, did you
  know that the website is open-source? See:
  https://github.com/federico-terzi/federico-terzi.github.io
-->
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Automatic Code-signing on Windows using GitHub Actions - Federico Terzi - A Software Engineering Journey</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="title" name="title" content="Federico Terzi - A Software Engineering Journey"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" data-hid="description" name="description" content="After our previous article on automatic code-signing for macOS applications, we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines."><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="Automatic Code-signing on Windows using GitHub Actions"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="After our previous article on automatic code-signing for macOS applications, we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines."><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://federicoterzi.com/social/2022-09-21-automatic-codesigning-on-windows-using-github-actions.png"><meta data-n-head="ssr" name="twitter:card" content="summary"><meta data-n-head="ssr" name="twitter:site" content="@terzi_federico"><meta data-n-head="ssr" name="twitter:title" content="Automatic Code-signing on Windows using GitHub Actions"><meta data-n-head="ssr" name="twitter:description" content="After our previous article on automatic code-signing for macOS applications, we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines."><meta data-n-head="ssr" name="twitter:image" content="https://federicoterzi.com/social/2022-09-21-automatic-codesigning-on-windows-using-github-actions.png"><link data-n-head="ssr" rel="stylesheet" href="/colors.css"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><link data-n-head="ssr" rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><link data-n-head="ssr" rel="manifest" href="/site.webmanifest"><link data-n-head="ssr" rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"><link data-n-head="ssr" rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="preload" href="/_nuxt/0fff19e.js" as="script"><link rel="preload" href="/_nuxt/17ba505.js" as="script"><link rel="preload" href="/_nuxt/4293a24.js" as="script"><link rel="preload" href="/_nuxt/90cdebc.js" as="script"><link rel="preload" href="/_nuxt/f5ea8a1.js" as="script"><style data-vue-ssr-id="c3ae2b30:0 d75bdb94:0 fa7ff0ca:0 56b15182:0 7ab12987:0 68efd426:0 4c3275e1:0 1dd63c10:0 0356ed00:0 fcd77316:0 44de9599:0 71a90360:0">@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(/_nuxt/fonts/inter-v7-latin-regular.33e43c3.eot);src:local(""),url(/_nuxt/fonts/inter-v7-latin-regular.33e43c3.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/inter-v7-latin-regular.5e6a773.woff2) format("woff2"),url(/_nuxt/fonts/inter-v7-latin-regular.cefb4aa.woff) format("woff"),url(/_nuxt/fonts/inter-v7-latin-regular.0e67589.ttf) format("truetype"),url(/_nuxt/b8db5cf5416facf0c5ec4489d0ee9bbe.svg#Inter) format("svg")}@font-face{font-family:Inter;font-style:normal;font-weight:700;font-display:swap;src:url(/_nuxt/fonts/inter-v7-latin-700.129e115.eot);src:local(""),url(/_nuxt/fonts/inter-v7-latin-700.129e115.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/inter-v7-latin-700.c2ceaa0.woff2) format("woff2"),url(/_nuxt/fonts/inter-v7-latin-700.7f5a89b.woff) format("woff"),url(/_nuxt/fonts/inter-v7-latin-700.6bb53f6.ttf) format("truetype"),url(/_nuxt/0a85e1f2fd11f8afbfa155c7c5ec0a12.svg#Inter) format("svg")}@font-face{font-family:"PT Serif";font-style:normal;font-weight:400;font-display:swap;src:url(/_nuxt/fonts/pt-serif-v16-latin-regular.ef9b698.eot);src:local(""),url(/_nuxt/fonts/pt-serif-v16-latin-regular.ef9b698.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.511cda7.woff2) format("woff2"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.b4f2a8d.woff) format("woff"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.1602721.ttf) format("truetype"),url(/_nuxt/2b24347634a541da72419674a1818855.svg#PTSerif) format("svg")}html{--content-primary:#1a1a1a;--content-primary-inverted:#fff;--accent-primary:#c84c32;--accent-secondary:#2e4364;--accent-tertiary:#ecdbba;--accent-menu:#2e4364;--background-primary:#fff;--background-elevated:#f1f1f1;--background-semitransparent:hsla(0,0%,100%,0.7);--details:rgba(26,26,26,0.1)}html[data-theme=dark]{--content-primary:#fff;--content-primary-inverted:#1a1a1a;--accent-primary:#ef6b50;--accent-secondary:#8bb8ff;--accent-tertiary:#ecdbba;--accent-menu:#fff;--background-primary:#000;--background-elevated:#343434;--background-semitransparent:rgba(0,0,0,0.7);--details:hsla(0,0%,100%,0.1)}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}body,html{font-family:Inter,sans-serif;color:var(--content-primary);background-color:transparent;margin:0;padding:0}*{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.main-layout-container{max-width:1512px;margin:auto}.main-layout-content{padding-top:95px;min-height:100vh}@media (max-width:992px){.main-layout-content{padding-top:50px;max-width:100vw;overflow-x:hidden}}.container[data-v-71b3c000]{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;overflow:hidden;z-index:-10;background-color:var(--background-primary);transition:all .5s ease}.blurred[data-v-71b3c000]{filter:blur(50px);height:450px;width:450px}.animate[data-v-71b3c000]{-webkit-animation:rotate-center-data-v-71b3c000 120s linear infinite both;animation:rotate-center-data-v-71b3c000 120s linear infinite both}.red[data-v-71b3c000]{top:25vh;left:-10vw;background-color:var(--accent-primary)}.blue[data-v-71b3c000],.red[data-v-71b3c000]{position:absolute;opacity:.15}.blue[data-v-71b3c000]{top:0;right:-10vw;background-color:var(--accent-secondary)}.yellow[data-v-71b3c000]{position:absolute;top:75vh;left:40vw;background-color:var(--accent-tertiary);opacity:.4}html[data-theme=dark] .yellow[data-v-71b3c000]{opacity:.2}@media (max-width:992px){.blurred[data-v-71b3c000]{height:300px;width:300px}}@-webkit-keyframes rotate-center-data-v-71b3c000{0%{transform:rotate(0) translateX(0) translateY(0)}50%{transform:rotate(180deg) translateX(300px) translateY(300px)}to{transform:rotate(1turn) translateX(0) translateY(0)}}@keyframes rotate-center-data-v-71b3c000{0%{transform:rotate(0) translateX(0) translateY(0)}50%{transform:rotate(180deg) translateX(300px) translateY(300px)}to{transform:rotate(1turn) translateX(0) translateY(0)}}.header[data-v-47a7b6cf]{position:fixed;top:0;right:0;left:0;z-index:20;background-color:transparent;box-shadow:none;transition:all .2s ease-in-out}html:not([data-scroll="0"]) .header[data-v-47a7b6cf]{background-color:var(--background-primary);box-shadow:0 4px 43px rgba(0,0,0,.1)}.content[data-v-47a7b6cf]{display:flex;align-items:center;justify-content:space-between;padding:25px;max-width:1512px;margin:auto}.logo-link[data-v-47a7b6cf]{text-decoration:none}.details[data-v-47a7b6cf]{display:flex}.logo[data-v-47a7b6cf]{margin-right:16px}.details-text[data-v-47a7b6cf]{display:flex;flex-direction:column;justify-content:center}.name[data-v-47a7b6cf]{font-size:24px;line-height:28px;color:var(--accent-primary)}.name[data-v-47a7b6cf],.tagline[data-v-47a7b6cf]{font-weight:700;text-shadow:0 4px 4px rgba(0,0,0,.05)}.tagline[data-v-47a7b6cf]{font-size:14px;line-height:17px;opacity:.8;color:var(--content-primary)}html[data-theme=dark] .tagline[data-v-47a7b6cf]{opacity:.9}.menu-link[data-v-47a7b6cf]{position:relative;font-style:normal;font-weight:700;font-size:18px;line-height:22px;color:var(--accent-menu);margin-left:48px;text-decoration:none;transition:all .3s ease}.menu-link[data-v-47a7b6cf]:hover{color:var(--accent-primary)}.menu-link[data-v-47a7b6cf]:after{content:"";position:absolute;display:block;width:100%;height:2px;bottom:-3px;left:0;background-color:var(--accent-secondary);transform:scaleX(0);opacity:0;transition:all .3s ease}.menu-link[data-v-47a7b6cf]:hover:after{transform:scaleX(1);opacity:1;background-color:var(--accent-primary)}.open-mobile-menu[data-v-47a7b6cf]{display:none}.mobile-menu[data-v-47a7b6cf]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:var(--background-semitransparent);z-index:1000;box-shadow:0 3px 18px rgba(0,0,0,.1);display:flex;flex-direction:column;justify-content:center;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);perspective:1000px}.menu-divider[data-v-47a7b6cf]{opacity:.05;border-bottom:2px solid #2e4364;margin-right:32px;margin-left:32px}.fade-enter-active[data-v-47a7b6cf],.fade-leave-active[data-v-47a7b6cf]{transition:opacity .5s}.fade-enter[data-v-47a7b6cf],.fade-leave-to[data-v-47a7b6cf]{opacity:0;-webkit-backdrop-filter:blur(0);backdrop-filter:blur(0)}@media (max-width:992px){.name[data-v-47a7b6cf]{font-size:14px;line-height:17px}.tagline[data-v-47a7b6cf]{display:none}.details-text[data-v-47a7b6cf]{opacity:0;transition:opacity .2s ease-in-out}html:not([data-scroll="0"]) .details-text[data-v-47a7b6cf]{opacity:1}.content[data-v-47a7b6cf]{padding:14px}.extended-menu[data-v-47a7b6cf]{display:none}.open-mobile-menu[data-v-47a7b6cf]{display:block;margin-right:4px;filter:drop-shadow(0 4px 16px rgba(0,0,0,.25))}.menu-link[data-v-47a7b6cf]{text-align:center;margin-left:0;margin-top:18px;margin-bottom:18px;-webkit-animation:slide-in-bck-center-data-v-47a7b6cf .7s cubic-bezier(.25,.46,.45,.94) both;animation:slide-in-bck-center-data-v-47a7b6cf .7s cubic-bezier(.25,.46,.45,.94) both}.mobile-menu-links[data-v-47a7b6cf]{display:flex;flex-direction:column;justify-content:center;flex:1}.mobile-menu-label[data-v-47a7b6cf]{text-align:center;font-size:12px;margin-bottom:100px}}@-webkit-keyframes slide-in-bck-center-data-v-47a7b6cf{0%{transform:translateZ(600px);opacity:0}to{transform:translateZ(0);opacity:1}}@keyframes slide-in-bck-center-data-v-47a7b6cf{0%{transform:translateZ(600px);opacity:0}to{transform:translateZ(0);opacity:1}}.container[data-v-66baf38d]{position:relative;width:46px;height:46px}.f[data-v-66baf38d],.t[data-v-66baf38d]{position:absolute}.t[data-v-66baf38d]{left:-3px;top:-1px}@media (max-width:992px){.container[data-v-66baf38d],.f[data-v-66baf38d],.t[data-v-66baf38d]{height:32px;width:32px}.t[data-v-66baf38d]{left:-1px;top:0}}.post-title[data-v-c2aeccce]{font-style:normal;font-weight:700;font-size:36px;line-height:44px;color:var(--content-primary);margin-top:0;margin-bottom:6px}.post-details[data-v-c2aeccce]{font-size:14px;line-height:17px;color:var(--content-secondary);margin-bottom:34px}.post-footer[data-v-c2aeccce]{margin-top:28px}.short-page-container{max-width:700px;margin-right:auto;margin-left:auto;margin-top:30px;padding:28px}.short-page-title{margin-bottom:50px;margin-left:-8px}@media (max-width:992px){.short-page-container{margin-top:10px}}.post-footer-container[data-v-63505c64]{font-size:18px;line-height:22px;border-top:1px solid var(--details);padding-top:28px;display:flex}.post-footer-image[data-v-63505c64]{height:138px;width:138px}.post-footer-content[data-v-63505c64]{margin-left:28px}.post-footer-content p[data-v-63505c64]:first-child{margin-top:0}.red[data-v-63505c64]{color:var(--accent-primary)}.blue[data-v-63505c64],.red[data-v-63505c64]{font-weight:700}.blue[data-v-63505c64]{color:var(--accent-secondary)}a[data-v-63505c64]{text-underline-offset:2px;text-decoration-thickness:2px}@media (max-width:992px){.post-footer-container[data-v-63505c64]{align-items:center;flex-direction:column}.post-footer-content[data-v-63505c64]{margin-left:0;margin-top:28px}}.footer-container[data-v-83760644]{font-size:14px;line-height:17px;text-align:center;color:var(--accent-menu);margin-top:40px;padding-right:16px;padding-left:16px}.bold[data-v-83760644]{font-weight:700}.red[data-v-83760644]{color:var(--accent-primary)}.social-bar-container{position:fixed;left:24px;bottom:24px;background:var(--background-elevated);border:1px solid var(--details);box-sizing:border-box;box-shadow:0 3px 8px 2px rgba(0,0,0,.1);border-radius:4px;display:flex;justify-content:space-evenly;width:360px;padding-top:10px;padding-bottom:10px;transition:all .3s ease}html[data-scrolled-to-bottom=true] .social-bar-container{opacity:0;transform:translateY(100px)}.social-bar-container a{display:flex;align-items:center;filter:drop-shadow(0 4px 6px rgba(0,0,0,.25));transition:all .3s ease}.social-bar-container a:hover{transform:scale(1.2) translateY(-3px)}.social-bar-container a path{stroke:var(--accent-primary)}.social-bar-divider{border-left:1px solid var(--details)}@media (max-width:992px){.social-bar-container{left:0;right:0;bottom:0;width:100%;border-radius:0}}</style><link rel="preload" href="/_nuxt/static/1705674514/blog/automatic-codesigning-on-windows-using-github-actions/state.js" as="script"><link rel="preload" href="/_nuxt/static/1705674514/blog/automatic-codesigning-on-windows-using-github-actions/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1705674514/manifest.js" as="script">
    <script>const debounce=t=>{let c;return(...e)=>{c&&cancelAnimationFrame(c),c=requestAnimationFrame(()=>{t(...e)})}},handleScroll=()=>{document.documentElement.dataset.scroll=window.scrollY,document.documentElement.dataset.scrolledToBottom=window.innerHeight+window.scrollY>=document.body?.offsetHeight?"true":"false"};function switchTheme(e){"dark"===e?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light")}document.addEventListener("scroll",debounce(handleScroll),{passive:!0}),handleScroll();const prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)");prefersDarkScheme.matches&&switchTheme("dark"),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches?switchTheme("dark"):switchTheme("light"))</script>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="main-layout-container"><div class="container" data-v-71b3c000><div class="blurred red animate" data-v-71b3c000></div> <div class="blurred yellow animate" data-v-71b3c000></div> <div class="blurred blue animate" data-v-71b3c000></div></div> <div id="header" class="header" data-v-47a7b6cf><div class="content" data-v-47a7b6cf><a href="/" class="logo-link nuxt-link-active" data-v-47a7b6cf><div class="details" data-v-47a7b6cf><div class="container logo" data-v-66baf38d data-v-47a7b6cf><svg width="51" height="47" viewBox="0 0 51 47" fill="none" xmlns="http://www.w3.org/2000/svg" class="f" data-v-66baf38d data-v-66baf38d><g filter="url(#filter0_d_15_34)" data-v-66baf38d data-v-66baf38d><path d="M2.09039 44.1666V2H48L2.09039 44.1666Z" fill="#C84C32" data-v-66baf38d data-v-66baf38d></path></g><defs data-v-66baf38d data-v-66baf38d><filter id="filter0_d_15_34" x="0.0543151" y="0.506876" width="49.9818" height="46.2388" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" data-v-66baf38d data-v-66baf38d><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-66baf38d data-v-66baf38d></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" data-v-66baf38d data-v-66baf38d></feColorMatrix><feOffset dy="0.542954" data-v-66baf38d data-v-66baf38d></feOffset><feGaussianBlur stdDeviation="1.01804" data-v-66baf38d data-v-66baf38d></feGaussianBlur><feComposite in2="hardAlpha" operator="out" data-v-66baf38d data-v-66baf38d></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" data-v-66baf38d data-v-66baf38d></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_15_34" data-v-66baf38d data-v-66baf38d></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_15_34" result="shape" data-v-66baf38d data-v-66baf38d></feBlend></filter></defs></svg> <svg width="53" height="49" viewBox="0 0 53 49" fill="none" xmlns="http://www.w3.org/2000/svg" class="t" data-v-66baf38d data-v-66baf38d><g filter="url(#filter0_d_15_35)" data-v-66baf38d data-v-66baf38d><path d="M28.0452 45.0836L5 3H51L28.0452 45.0836Z" fill="url(#paint0_linear_15_35)" data-v-66baf38d data-v-66baf38d></path></g><defs data-v-66baf38d data-v-66baf38d><filter id="filter0_d_15_35" x="0.656367" y="0.556706" width="51.9725" height="48.0561" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" data-v-66baf38d data-v-66baf38d><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-66baf38d data-v-66baf38d></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" data-v-66baf38d data-v-66baf38d></feColorMatrix><feOffset dx="-1.35739" dy="0.542954" data-v-66baf38d data-v-66baf38d></feOffset><feGaussianBlur stdDeviation="1.49312" data-v-66baf38d data-v-66baf38d></feGaussianBlur><feComposite in2="hardAlpha" operator="out" data-v-66baf38d data-v-66baf38d></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0" data-v-66baf38d data-v-66baf38d></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_15_35" data-v-66baf38d data-v-66baf38d></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_15_35" result="shape" data-v-66baf38d data-v-66baf38d></feBlend></filter><linearGradient id="paint0_linear_15_35" x1="28" y1="3" x2="28" y2="45.0836" gradientUnits="userSpaceOnUse" data-v-66baf38d data-v-66baf38d><stop stop-color="#ECDBBA" stop-opacity="0.49" data-v-66baf38d data-v-66baf38d></stop><stop offset="1" stop-color="#ECDBBA" data-v-66baf38d data-v-66baf38d></stop></linearGradient></defs></svg></div> <div class="details-text" data-v-47a7b6cf><span class="name" data-v-47a7b6cf>Federico Terzi</span> <span class="tagline" data-v-47a7b6cf>A Software Engineering Journey</span></div></div></a> <div class="extended-menu" data-v-47a7b6cf><a href="/#about" class="menu-link" data-v-47a7b6cf>About</a><a href="/projects" class="menu-link" data-v-47a7b6cf>Projects</a><a href="/blog" class="menu-link nuxt-link-active" data-v-47a7b6cf>Blog</a><a href="/talks" class="menu-link" data-v-47a7b6cf>Talks</a><a href="/contact-me" class="menu-link" data-v-47a7b6cf>Contact me</a></div> <div class="open-mobile-menu" data-v-47a7b6cf><svg width="26" height="18" viewBox="0 0 26 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="menu-icon" data-v-47a7b6cf data-v-47a7b6cf><path d="M2 9.25H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-47a7b6cf data-v-47a7b6cf></path><path d="M2 2H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-47a7b6cf data-v-47a7b6cf></path><path d="M2 16.5H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-47a7b6cf data-v-47a7b6cf></path></svg></div> <!----></div></div> <div class="main-layout-content"><article data-v-c2aeccce><div class="short-page-container" data-v-c2aeccce><!----> <h1 class="post-title" data-v-c2aeccce>Automatic Code-signing on Windows using GitHub Actions</h1> <p class="post-details" data-v-c2aeccce>
      September 21st, 2022 - by Federico Terzi
    </p> <div class="post-content" data-v-c2aeccce><!----> <div class="nuxt-content" data-v-c2aeccce><p data-v-c2aeccce>After our previous article on <a href="https://federicoterzi.com/blog/automatic-code-signing-and-notarization-for-macos-apps-using-github-actions" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>automatic code-signing for macOS applications</a>, we are now going to cover the process for Windows binaries. The article is going to discuss all the necessary steps to get a Windows application code-signed, starting from the process to obtain a certificate, all the way down to automating the signing process in your CI pipelines.</p>

<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>The article summarizes the steps we went through to code-sign Espanso, a cross-platform text expander. If you get stuck in the process, I also recommend checking out <a href="https://github.com/espanso/espanso" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>Espanso’s source code</a>.</p>
</blockquote>
<h1 id="getting-a-code-signing-certificate" data-v-c2aeccce><a href="#getting-a-code-signing-certificate" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Getting a Code-signing Certificate</h1>
<h2 id="choosing-a-certificate-authority" data-v-c2aeccce><a href="#choosing-a-certificate-authority" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Choosing a Certificate Authority</h2>
<p data-v-c2aeccce>Before coding our way into the automatic CI pipeline, we first need to obtain a Code-signing certificate. There are multiple companies you can get one from, so the first challenge is to figure out which one to choose. We could talk to great lengths about the pros/cons of the various providers, but for the sake of this article, let’s summarize it by asking two questions:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>Are you trying to sign the executable as a company or as an individual?</li>
<li data-v-c2aeccce>What is your budget?</li>
</ul>
<p data-v-c2aeccce>These are my recommendations depending on the above answers:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce><strong data-v-c2aeccce>Company with a large budget</strong>: buy an EV certificate from DigiCert, those are the most expensive (currently at ~700$/year) but they offer the best reputation and customer support.</li>
<li data-v-c2aeccce><strong data-v-c2aeccce>Individual with a large budget</strong>: buy an OV certificate from DigiCert. These are still expensive (~500$/year), but don’t offer as much reputation as an EV certificate (your users will still see Windows’ SafeScreen at first). Unfortunately, individuals can’t buy EV certificates, so this is likely the best you could find</li>
<li data-v-c2aeccce><strong data-v-c2aeccce>Individual with a small budget</strong>: buy an OV certificate from a Sectigo reseller, like CodeSigningStore.com. I went down this route as Espanso is an open-source project and I had to be careful about the budget. Overall, the experience was <em data-v-c2aeccce>ok</em>, and after about 3 weeks of back and forth with their customer support, I managed to get a valid certificate at the price of ~70$/year, thus significantly cheaper than the other options</li>
</ul>
<p data-v-c2aeccce>In short, if you are a company I recommend buying an EV certificate from DigiCert, as they offer the best reputation for your executable. On the other hand, if you are looking to code-sign your program (maybe an open-source project) on a budget, then an OV certificate from a reseller like <a href="http://CodeSigningStore.com" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>CodeSigningStore.com</a> could be an option.</p>
<p data-v-c2aeccce>The next section will describe the process we went through to get an OV certificate from Sectigo. Feel free to jump to the next one if you already have a certificate or you decide to use a different provider.</p>
<h3 id="notes" data-v-c2aeccce><a href="#notes" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Notes</h3>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>I highly recommend buying 3 years certificates. Despite being more expensive, they will save you from the “overhead” of re-applying for a certificate each year. Moreover, some certificates (like the OV version) require time to build a reputation, and buying a 3 years certificate means you won’t have to rebuild that reputation once a year.</li>
<li data-v-c2aeccce>If you choose an EV certificate, keep in mind that you will need to have an hardware token (a USB key shipped to you by the certificate authority) connected to the machine while performing the digital signature. This has an important consequence: <strong data-v-c2aeccce>you won’t be able to use GitHub-hosted CI agents to perform the digital signature</strong>, as you can’t connect the physical USB token to them. There are several possible workarounds, but a common one used in professional environments consists in running <em data-v-c2aeccce>self-hosted</em> runners for your Windows CI integration. In short, you would keep a physical server inside your company’s office with the hardware token always connected. When a CI build is scheduled, GitHub (or your CI provider of choice) will run the build on your server (having the hardware key connected) instead of a cloud VM.</li>
</ul>
<h2 id="buying-an-ov-certificate-from-sectigo" data-v-c2aeccce><a href="#buying-an-ov-certificate-from-sectigo" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Buying an OV certificate from Sectigo</h2>
<p data-v-c2aeccce>After a thorough evaluation of the possible options, I decided to get an OV certificate from Sectigo (or to be more precise, a reseller), as it was the cheapest option I could find with <em data-v-c2aeccce>acceptable</em> reviews online (just search for “Comodo reviews” online to get an idea).</p>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>For context: Comodo was rebranded to Sectigo in 2018, but there is the same company behind them.</p>
</blockquote>
<p data-v-c2aeccce>While you could buy a code-signing certificate directly from Sectigo’s website, I decided to buy it from a reseller, as the end result would be similar at a fraction of the price. I personally choose <a href="http://CodeSigningStore.com" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>CodeSigningStore.com</a> as it seemed the reseller <em data-v-c2aeccce>with the least bad reviews online</em> (not exactly reassuring, I know).</p>
<p data-v-c2aeccce>So I went ahead and paid 207$ for a 3 years Sectigo certificate.</p>
<p data-v-c2aeccce>Shortly after, I received an email with a link to submit a <em data-v-c2aeccce>Certificate Signing Request</em> (CSR), a file containing your public key and other information. This will be used by the certificate authority to generate the certificate.</p>
<h3 id="generating-a-certificate-signing-request-csr" data-v-c2aeccce><a href="#generating-a-certificate-signing-request-csr" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Generating a Certificate Signing Request (CSR)</h3>
<p data-v-c2aeccce>As discussed above, we need to submit a CSR to the Certificate Authority to generate a certificate. While there are multiple ways to create a CSR, these are the steps to generate one using <code data-v-c2aeccce>openssl</code>:</p>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>Note: If you are on Windows, the easiest way to get <code data-v-c2aeccce>openssl</code> is by using the executable distributed as part of a <code data-v-c2aeccce>git</code> installation. In my case, after installing Git, I had access to the <code data-v-c2aeccce>openssl.exe</code> executable in this path: <code data-v-c2aeccce>'C:\Program Files\Git\usr\bin\openssl.exe</code></p>
</blockquote>
<ol data-v-c2aeccce>
<li data-v-c2aeccce>Open a Powershell terminal</li>
<li data-v-c2aeccce>Run this command to launch the generation wizard:</li>
</ol>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-javascript" data-v-c2aeccce><code data-v-c2aeccce><span class="token operator" data-v-c2aeccce>&</span> <span class="token string" data-v-c2aeccce>'C:\Program Files\Git\usr\bin\openssl.exe'</span> req <span class="token operator" data-v-c2aeccce>-</span>newkey rsa<span class="token operator" data-v-c2aeccce>:</span><span class="token number" data-v-c2aeccce>4096</span> <span class="token operator" data-v-c2aeccce>-</span>keyout <span class="token constant" data-v-c2aeccce>PRIVATEKEY</span><span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>key</span> <span class="token operator" data-v-c2aeccce>-</span>out <span class="token constant" data-v-c2aeccce>MYCSR</span><span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>csr</span>
</code></pre></div>
<ol data-v-c2aeccce>
<li data-v-c2aeccce>You will be presented with a series of prompts:
<ol data-v-c2aeccce>
<li data-v-c2aeccce>Create and verify a password. This is the password used to protect your private key, <strong data-v-c2aeccce>make sure to save it somewhere, as we will need it later</strong></li>
<li data-v-c2aeccce>Insert the <strong data-v-c2aeccce>Country name</strong>, a two-letter code for your country (see a<a href="https://www.ssl.com/country-codes/" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce> list of possible values</a>)</li>
<li data-v-c2aeccce>Insert the <strong data-v-c2aeccce>Locality name</strong>, the name of your city or town</li>
<li data-v-c2aeccce>Insert the <strong data-v-c2aeccce>Organization name</strong>, the name of your company/organization/personal name</li>
<li data-v-c2aeccce>Insert the <strong data-v-c2aeccce>Common name</strong>, the name of your website (such as <code data-v-c2aeccce>espanso.org</code>)</li>
<li data-v-c2aeccce>Insert the <strong data-v-c2aeccce>Email address</strong></li>
<li data-v-c2aeccce>Skip the challenge password</li>
</ol>
</li>
<li data-v-c2aeccce>At the end of this process, you should find a <code data-v-c2aeccce>PRIVATEKEY.key</code> file containing your private key and a <code data-v-c2aeccce>MYCSR.csr</code> file containing your certificate signing request. Keep both of them in a safe place as we will need them soon</li>
<li data-v-c2aeccce>Submit the <code data-v-c2aeccce>MYCSR.csr</code> file to the Certificate Authority</li>
</ol>
<h3 id="completing-the-verification-process" data-v-c2aeccce><a href="#completing-the-verification-process" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Completing the verification process</h3>
<p data-v-c2aeccce>After your request has been sent, the Certificate Authority will request additional information to verify your identity. This will usually take a few days or weeks, but in the end, you should receive a certificate.</p>
<h1 id="preparing-the-certificate" data-v-c2aeccce><a href="#preparing-the-certificate" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Preparing the Certificate</h1>
<p data-v-c2aeccce>After the certificate has been issued, we need to turn it into a format compatible with our target CI pipeline. The following steps are necessary for Sectigo-issued certificates, but keep in mind the process might be slightly different with other Certificate Authorities. Our goal is to obtain the code-signing certificate in <code data-v-c2aeccce>PFX</code> format, encoded as base64.</p>
<h2 id="verify-that-the-certificate-and-private-key-match" data-v-c2aeccce><a href="#verify-that-the-certificate-and-private-key-match" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Verify that the Certificate and Private key match</h2>
<p data-v-c2aeccce>Before diving into the actual conversion process, it’s a good idea to verify that the certificate being issued matches our private key (the one generated with the CSR).</p>
<p data-v-c2aeccce>To verify that, we need to run two commands:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-javascript" data-v-c2aeccce><code data-v-c2aeccce>openssl rsa <span class="token operator" data-v-c2aeccce>-</span>modulus <span class="token operator" data-v-c2aeccce>-</span>noout <span class="token operator" data-v-c2aeccce>-</span><span class="token keyword" data-v-c2aeccce>in</span> <span class="token constant" data-v-c2aeccce>PRIVATEKEY</span><span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>key</span> <span class="token operator" data-v-c2aeccce>|</span> openssl md5
</code></pre></div>
<p data-v-c2aeccce>and also (with <code data-v-c2aeccce>user.crt</code> being the certificate issued by the CA):</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-javascript" data-v-c2aeccce><code data-v-c2aeccce>openssl x509 <span class="token operator" data-v-c2aeccce>-</span>modulus <span class="token operator" data-v-c2aeccce>-</span>noout <span class="token operator" data-v-c2aeccce>-</span><span class="token keyword" data-v-c2aeccce>in</span> user<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>crt</span> <span class="token operator" data-v-c2aeccce>|</span> openssl md5
</code></pre></div>
<p data-v-c2aeccce>If the output of the two previous commands match, then the certificate is correct!</p>
<h3 id="troubleshooting-expecting-trusted-certificate-error" data-v-c2aeccce><a href="#troubleshooting-expecting-trusted-certificate-error" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Troubleshooting “<strong data-v-c2aeccce>Expecting: TRUSTED CERTIFICATE” error</strong></h3>
<p data-v-c2aeccce>In my case, the previous commands returned the following error:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-javascript" data-v-c2aeccce><code data-v-c2aeccce>unable to load certificate
<span class="token number" data-v-c2aeccce>34359836736</span><span class="token operator" data-v-c2aeccce>:</span>error<span class="token operator" data-v-c2aeccce>:</span>0909006C<span class="token operator" data-v-c2aeccce>:</span><span class="token constant" data-v-c2aeccce>PEM</span> <span class="token literal-property property" data-v-c2aeccce>routines</span><span class="token operator" data-v-c2aeccce>:</span>get_name<span class="token operator" data-v-c2aeccce>:</span>no start line<span class="token operator" data-v-c2aeccce>:</span>crypto<span class="token operator" data-v-c2aeccce>/</span>pem<span class="token operator" data-v-c2aeccce>/</span>pem_lib<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>c</span><span class="token operator" data-v-c2aeccce>:</span><span class="token number" data-v-c2aeccce>745</span><span class="token operator" data-v-c2aeccce>:</span><span class="token maybe-class-name" data-v-c2aeccce>Expecting</span><span class="token operator" data-v-c2aeccce>:</span> <span class="token constant" data-v-c2aeccce>TRUSTED</span> <span class="token constant" data-v-c2aeccce>CERTIFICATE</span>
</code></pre></div>
<p data-v-c2aeccce>This error is due to the <code data-v-c2aeccce>user.crt</code> file being encoded in the wrong format. Luckily, we can solve this problem by following <a href="https://federicoterzi.com/blog/fixing-the-expecting-trusted-certificate-error-with-sectigo-certificates" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>these steps</a>.</p>
<h2 id="convert-the-certificate-to-pfx-format" data-v-c2aeccce><a href="#convert-the-certificate-to-pfx-format" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Convert the certificate to PFX format</h2>
<p data-v-c2aeccce>After verifying that the certificate matches our private key, we are ready to “bundle” all of them together into a PFX certificate. We will use <code data-v-c2aeccce>openssl</code> for this step as well:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-javascript" data-v-c2aeccce><code data-v-c2aeccce><span class="token operator" data-v-c2aeccce>&</span> <span class="token string" data-v-c2aeccce>'C:\Program Files\Git\usr\bin\openssl.exe'</span> pkcs12 <span class="token operator" data-v-c2aeccce>-</span><span class="token keyword module" data-v-c2aeccce>export</span> <span class="token operator" data-v-c2aeccce>-</span>out codesign<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>pfx</span> <span class="token operator" data-v-c2aeccce>-</span>inkey <span class="token punctuation" data-v-c2aeccce>.</span>\<span class="token constant" data-v-c2aeccce>PRIVATEKEY</span><span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>key</span> <span class="token operator" data-v-c2aeccce>-</span><span class="token keyword" data-v-c2aeccce>in</span> <span class="token punctuation" data-v-c2aeccce>.</span>\certificate<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>crt</span>
</code></pre></div>
<p data-v-c2aeccce>Where:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce><code data-v-c2aeccce>PRIVATEKEY.key</code> is the private key we generated during the CSR step.</li>
<li data-v-c2aeccce><code data-v-c2aeccce>certificate.crt</code> is the public certificate issued by the Certificate Authority. In the case of Sectigo certificates, <strong data-v-c2aeccce>this file is not the</strong> <strong data-v-c2aeccce><code data-v-c2aeccce>user.crt</code></strong> certificate directly issued by the CA, but refers to the converted certificate after <a href="https://federicoterzi.com/blog/fixing-the-expecting-trusted-certificate-error-with-sectigo-certificates/" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>following these steps</a>.</li>
<li data-v-c2aeccce><code data-v-c2aeccce>codesign.pfx</code> is the output PFX certificate file.</li>
</ul>
<h2 id="test-the-code-signing-process-manually" data-v-c2aeccce><a href="#test-the-code-signing-process-manually" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Test the code-signing process manually</h2>
<p data-v-c2aeccce>Before diving into the process to build an automatic signing pipeline, let’s verify that the code-signing certificate works as expected by attempting a manual signature.</p>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>We will need Microsoft’s <code data-v-c2aeccce>signtool.exe</code> to perform the following steps. You can get it by installing the Windows 10 SDK using Visual Studio. More info on this <a href="https://stackoverflow.com/questions/31869552/how-to-install-signtool-exe-for-windows-10" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>StackOverflow thread</a>.</p>
</blockquote>
<p data-v-c2aeccce>We can sign an executable by opening a terminal and running the following command:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-javascript" data-v-c2aeccce><code data-v-c2aeccce><span class="token string" data-v-c2aeccce>"C:\Program Files (x86)\Windows Kits\10\bin\10.0.19041.0\x86\signtool"</span> sign <span class="token operator" data-v-c2aeccce>/</span>fd <span class="token constant" data-v-c2aeccce>SHA256</span> <span class="token operator" data-v-c2aeccce>/</span>p <span class="token string" data-v-c2aeccce>"&lt;PASSWORD_HERE>"</span> <span class="token operator" data-v-c2aeccce>/</span>ac <span class="token maybe-class-name" data-v-c2aeccce>SectigoPublicCodeSigningRootR46_AAA</span><span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>crt</span> <span class="token operator" data-v-c2aeccce>/</span>f codesign<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>pfx</span> <span class="token operator" data-v-c2aeccce>/</span>tr http<span class="token operator" data-v-c2aeccce>:</span><span class="token operator" data-v-c2aeccce>/</span><span class="token operator" data-v-c2aeccce>/</span>timestamp<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>sectigo</span><span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>com</span><span class="token operator" data-v-c2aeccce>/</span>rfc3161 <span class="token operator" data-v-c2aeccce>/</span>td sha256 yourProgram<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>exe</span>
</code></pre></div>
<p data-v-c2aeccce>where:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce><code data-v-c2aeccce>"C:\Program Files (x86)\Windows Kits\10\bin\10.0.19041.0\x86\signtool"</code> is the path to <code data-v-c2aeccce>signtool</code>. This path will vary depending on the Windows 10 SDK version being installed, so make sure to update the path accordingly.</li>
<li data-v-c2aeccce><code data-v-c2aeccce>"&lt;PASSWORD_HERE>"</code> should be replaced by your private key’s password (the one we choose during the CSR generation)</li>
<li data-v-c2aeccce><code data-v-c2aeccce>SectigoPublicCodeSigningRootR46_AAA.crt</code> is the path to an appropriate <em data-v-c2aeccce>intermediate certificate</em>. You can download the appropriate ones for <a href="https://support.sectigo.com/articles/Knowledge/Sectigo-Intermediate-Certificates" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>Sectigo here</a> and for <a href="https://knowledge.digicert.com/alerts/code-signing-new-minimum-rsa-keysize.html" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>DigiCert here</a>.</li>
<li data-v-c2aeccce><code data-v-c2aeccce>codesign.pfx</code> is the path to the certificate we generated in the previous step.</li>
<li data-v-c2aeccce><code data-v-c2aeccce>yourProgram.exe</code> is the path to the executable we want to sign</li>
</ul>
<p data-v-c2aeccce>After running this command, right-click on the executable and choose “Properties” > Digital Signatures tab. If everything was correct, you should now see an entry for your signature, as shown in the image below.</p>
<p data-v-c2aeccce><img alt="" src="/posts/2022-09-21-automatic-codesigning-on-windows-using-github-actions/image0.png" data-v-c2aeccce></p>
<blockquote data-v-c2aeccce>
<p data-v-c2aeccce>If you don’t see a “Digital Signatures” tab, then it means the signature process didn’t complete successfully. Make sure to double check all the paths used in the above command.</p>
</blockquote>
<h1 id="automating-the-signing-process-on-a-ci-pipeline" data-v-c2aeccce><a href="#automating-the-signing-process-on-a-ci-pipeline" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Automating the signing process on a CI pipeline</h1>
<p data-v-c2aeccce>Now that we successfully signed an executable with our new certificate, we are ready to automate the process as part of a CI pipeline. For this example, we are going to use GitHub Actions as platform, but these steps could be adapted to most providers with minimal changes.</p>
<h2 id="a-note-on-ev-certificates" data-v-c2aeccce><a href="#a-note-on-ev-certificates" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>A note on EV certificates</h2>
<p data-v-c2aeccce>If you are using a company’s EV certificate, you will likely need a hardware token (a USB key sent by the certificate authority) to sign your executables. As a result, <strong data-v-c2aeccce>you won’t be able to use cloud-hosted CI agents</strong>, as there is no way for you to connect the hardware token there.</p>
<p data-v-c2aeccce>In these scenarios, a common solution is to maintain a physical server in your company’s office with the hardware token always connected. At this point, you can use GitHub’s self-hosted runners to execute the CI pipelines from your local server, which will be connected to the required hardware token.</p>
<h2 id="converting-the-certificate-to-base64" data-v-c2aeccce><a href="#converting-the-certificate-to-base64" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Converting the certificate to base64</h2>
<p data-v-c2aeccce>In order to store the certificate as a GitHub Action <em data-v-c2aeccce>Secret</em>, we need to encode it as base64 string. An easy way to do that on Windows is to run the following command:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-javascript" data-v-c2aeccce><code data-v-c2aeccce>certutil <span class="token operator" data-v-c2aeccce>-</span>encode codesign<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>pfx</span> base64cert<span class="token punctuation" data-v-c2aeccce>.</span><span class="token property-access" data-v-c2aeccce>txt</span>
</code></pre></div>
<p data-v-c2aeccce>If you also want to use an intermediate certificate (the <code data-v-c2aeccce>SectigoPublicCodeSigningRootR46_AAA</code> one we used above), you should generate the base64 of that one as well.</p>
<h2 id="preparing-github-secrets" data-v-c2aeccce><a href="#preparing-github-secrets" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Preparing GitHub Secrets</h2>
<p data-v-c2aeccce>At this point, we are ready to add the information we gathered so far as Secrets. Open your project’s repository and navigate to Settings > Security > Secrets > Actions and add the following variables:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce><code data-v-c2aeccce>CODESIGN_BASE64</code> should contain the certificate encoded as base64, the one we prepared in the previous section</li>
<li data-v-c2aeccce><code data-v-c2aeccce>CODESIGN_PWD</code> should contain the private key’s password</li>
<li data-v-c2aeccce>(Optional) <code data-v-c2aeccce>CODESIGN_INTERMEDIATE_BASE64</code> the base64 of the intermediate certificate, if you’re using one</li>
</ul>
<h2 id="automating-the-code-sign-process" data-v-c2aeccce><a href="#automating-the-code-sign-process" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Automating the code-sign process</h2>
<p data-v-c2aeccce>At this point, we are finally ready to automate the code-signing process. For the sake of this example, we will sign an executable located in path: <code data-v-c2aeccce>target/release/espanso.exe</code> , make sure to update it with the actual path of your program.</p>
<p data-v-c2aeccce>The final Action step configuration will look like the following:</p>
<div class="nuxt-content-highlight" data-v-c2aeccce><pre class="line-numbers language-yaml" data-v-c2aeccce><code data-v-c2aeccce><span class="token punctuation" data-v-c2aeccce>-</span> <span class="token key atrule" data-v-c2aeccce>name</span><span class="token punctuation" data-v-c2aeccce>:</span> Sign executable
  <span class="token key atrule" data-v-c2aeccce>env</span><span class="token punctuation" data-v-c2aeccce>:</span>
    <span class="token key atrule" data-v-c2aeccce>CODESIGN_PWD</span><span class="token punctuation" data-v-c2aeccce>:</span> $<span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>{</span> secrets.CODESIGN_PWD<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>}</span>
    <span class="token key atrule" data-v-c2aeccce>CODESIGN_INTERMEDIATE_BASE64</span><span class="token punctuation" data-v-c2aeccce>:</span> $<span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>{</span> secrets.CODESIGN_INTERMEDIATE_BASE64 <span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>}</span>
    <span class="token key atrule" data-v-c2aeccce>CODESIGN_BASE64</span><span class="token punctuation" data-v-c2aeccce>:</span> $<span class="token punctuation" data-v-c2aeccce>{</span><span class="token punctuation" data-v-c2aeccce>{</span> secrets.CODESIGN_BASE64<span class="token punctuation" data-v-c2aeccce>}</span><span class="token punctuation" data-v-c2aeccce>}</span>
  <span class="token key atrule" data-v-c2aeccce>run</span><span class="token punctuation" data-v-c2aeccce>:</span> <span class="token punctuation" data-v-c2aeccce>|</span><span class="token scalar string" data-v-c2aeccce>
    New-Item -ItemType directory -Path certificate
    Set-Content -Path certificate\certificate.txt -Value $env:CODESIGN_BASE64
    certutil -decode certificate\certificate.txt certificate\certificate.pfx
    Set-Content -Path certificate\intermediate.txt -Value $env:CODESIGN_INTERMEDIATE_BASE64
    certutil -decode certificate\intermediate.txt certificate\intermediate.crt</span>

    & 'C<span class="token punctuation" data-v-c2aeccce>:</span>/Program Files (x86)/Windows Kits/10/bin/10.0.22621.0/x86/signtool.exe' sign /fd SHA256 /p $env<span class="token punctuation" data-v-c2aeccce>:</span>CODESIGN_PWD /ac certificate\intermediate.crt /f certificate\certificate.pfx /tr "http<span class="token punctuation" data-v-c2aeccce>:</span>//timestamp.sectigo.com/rfc3161" /td sha256 target/release/espanso.exe
    
    Remove<span class="token punctuation" data-v-c2aeccce>-</span>Item <span class="token punctuation" data-v-c2aeccce>-</span>Recurse <span class="token punctuation" data-v-c2aeccce>-</span>Force certificate
</code></pre></div>
<p data-v-c2aeccce>In a nutshell, these are the steps performed above:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>Load the secrets as environmental variables</li>
<li data-v-c2aeccce>Load the base64 certificates and convert them back to their original format</li>
<li data-v-c2aeccce>Invoke <code data-v-c2aeccce>signtool.exe</code> with the relevant parameters</li>
<li data-v-c2aeccce>Remove the temporary certificate files</li>
</ul>
<h3 id="notes-1" data-v-c2aeccce><a href="#notes-1" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Notes</h3>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>If you are not using an intermediate certificate, you can remove the <code data-v-c2aeccce>/ac certificate\intermediate.crt</code> flag and all the lines that contain “intermediate”</li>
</ul>
<h3 id="alternative-approaches" data-v-c2aeccce><a href="#alternative-approaches" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Alternative approaches</h3>
<p data-v-c2aeccce>There are also other approaches you might prefer:</p>
<ul data-v-c2aeccce>
<li data-v-c2aeccce>If your project is written in Rust, you could take inspiration from our PR: <a href="https://github.com/espanso/espanso/pull/1352/files" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>https://github.com/espanso/espanso/pull/1352/files</a></li>
<li data-v-c2aeccce>Use a pre-built GitHub Action such as: <a href="https://github.com/Dana-Prajea/code-sign-action" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>https://github.com/Dana-Prajea/code-sign-action</a></li>
</ul>
<h1 id="conclusion" data-v-c2aeccce><a href="#conclusion" aria-hidden="true" tabindex="-1" data-v-c2aeccce><span class="icon icon-link" data-v-c2aeccce></span></a>Conclusion</h1>
<p data-v-c2aeccce>In this article, we discussed the process to get your Windows program code-signed, starting from the choice of certificate authority, all the way down to a fully automated CI pipeline. The article was mostly focused on Sectigo certificates and GitHub actions, but most steps can be applied to other certificate authorities and CI platforms.</p>
<p data-v-c2aeccce>If you are also distributing your app on macOS, you might also enjoy my article on <a href="https://federicoterzi.com/blog/automatic-code-signing-and-notarization-for-macos-apps-using-github-actions" rel="nofollow noopener noreferrer" target="_blank" data-v-c2aeccce>automatic code-signing and notarization for macOS apps</a>.</p></div></div> <div class="post-footer-container post-footer" data-v-63505c64 data-v-c2aeccce><img src="/_nuxt/img/profile-picture-small.40e71b2.png" alt="Federico Terzi Picture" class="post-footer-image" data-v-63505c64> <div class="post-footer-content" data-v-63505c64><p data-v-63505c64>Hi 👋, I’m <span class="red" data-v-63505c64>Federico</span>, thanks for reading!</p> <p data-v-63505c64>
      If you liked this article, make sure to follow me on
      <a href="https://twitter.com/terzi_federico" class="blue" data-v-63505c64>Twitter</a> to
      stay updated with the latest ones :)
    </p> <p data-v-63505c64>
      If you are into technical topics, you might also enjoy my
      <a href="https://www.youtube.com/c/FedericoTerzi" class="red" data-v-63505c64>YouTube</a>
      channel.
    </p></div></div></div></article></div> <div class="footer-container" data-v-83760644><p data-v-83760644><span class="bold" data-v-83760644>Designed</span> and
    <span class="bold" data-v-83760644>coded</span> with<span class="red" data-v-83760644> ♥</span> by me.
    Copyright © Federico Terzi 2019-2023 - P.IVA 03864201201
  </p></div> <div class="social-bar-container"><a href="https://twitter.com/terzi_federico"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23 3.00005C22.0424 3.67552 20.9821 4.19216 19.86 4.53005C19.2577 3.83756 18.4573 3.34674 17.567 3.12397C16.6767 2.90121 15.7395 2.95724 14.8821 3.2845C14.0247 3.61176 13.2884 4.19445 12.773 4.95376C12.2575 5.71308 11.9877 6.61238 12 7.53005V8.53005C10.2426 8.57561 8.50127 8.18586 6.93101 7.39549C5.36074 6.60513 4.01032 5.43868 3 4.00005C3 4.00005 -1 13 8 17C5.94053 18.398 3.48716 19.099 1 19C10 24 21 19 21 7.50005C20.9991 7.2215 20.9723 6.94364 20.92 6.67005C21.9406 5.66354 22.6608 4.39276 23 3.00005V3.00005Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a> <div class="social-bar-divider"></div> <a href="https://github.com/federico-terzi/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_31_53)"><path d="M16 21.9999V18.1299C16.0375 17.6531 15.9731 17.1737 15.811 16.7237C15.6489 16.2737 15.3929 15.8634 15.06 15.5199C18.2 15.1699 21.5 13.9799 21.5 8.51994C21.4997 7.12376 20.9627 5.78114 20 4.76994C20.4559 3.54844 20.4236 2.19829 19.91 0.999938C19.91 0.999938 18.73 0.649938 16 2.47994C13.708 1.85876 11.292 1.85876 9 2.47994C6.27 0.649938 5.09 0.999938 5.09 0.999938C4.57638 2.19829 4.54414 3.54844 5 4.76994C4.03013 5.78864 3.49252 7.1434 3.5 8.54994C3.5 13.9699 6.8 15.1599 9.94 15.5499C9.611 15.8899 9.35726 16.2953 9.19531 16.7399C9.03335 17.1844 8.96681 17.658 9 18.1299V21.9999M9 18.9999C4 20.4999 4 16.4999 2 15.9999L9 18.9999Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></g><defs><clipPath id="clip0_31_53"><rect width="24" height="24" fill="white"></rect></clipPath></defs></svg></a> <div class="social-bar-divider"></div> <a href="https://www.linkedin.com/in/federico-terzi/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 8C17.5913 8 19.1174 8.63214 20.2426 9.75736C21.3679 10.8826 22 12.4087 22 14V21H18V14C18 13.4696 17.7893 12.9609 17.4142 12.5858C17.0391 12.2107 16.5304 12 16 12C15.4696 12 14.9609 12.2107 14.5858 12.5858C14.2107 12.9609 14 13.4696 14 14V21H10V14C10 12.4087 10.6321 10.8826 11.7574 9.75736C12.8826 8.63214 14.4087 8 16 8V8Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 9H2V21H6V9Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4 6C5.10457 6 6 5.10457 6 4C6 2.89543 5.10457 2 4 2C2.89543 2 2 2.89543 2 4C2 5.10457 2.89543 6 4 6Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a> <div class="social-bar-divider"></div> <a href="https://www.youtube.com/c/FedericoTerzi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22.54 6.42C22.4212 5.94541 22.1793 5.51057 21.8387 5.15941C21.498 4.80824 21.0708 4.55318 20.6 4.42C18.88 4 12 4 12 4C12 4 5.12001 4 3.40001 4.46C2.92925 4.59318 2.50198 4.84824 2.16135 5.19941C1.82072 5.55057 1.5788 5.98541 1.46001 6.46C1.14522 8.20556 0.991243 9.97631 1.00001 11.75C0.988786 13.537 1.14277 15.3213 1.46001 17.08C1.59097 17.5398 1.83831 17.9581 2.17815 18.2945C2.51799 18.6308 2.93883 18.8738 3.40001 19C5.12001 19.46 12 19.46 12 19.46C12 19.46 18.88 19.46 20.6 19C21.0708 18.8668 21.498 18.6118 21.8387 18.2606C22.1793 17.9094 22.4212 17.4746 22.54 17C22.8524 15.2676 23.0063 13.5103 23 11.75C23.0112 9.96295 22.8572 8.1787 22.54 6.42V6.42Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.75 15.02L15.5 11.75L9.75 8.47998V15.02Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></div></div></div></div><script defer src="/_nuxt/static/1705674514/blog/automatic-codesigning-on-windows-using-github-actions/state.js"></script><script src="/_nuxt/0fff19e.js" defer></script><script src="/_nuxt/f5ea8a1.js" defer></script><script src="/_nuxt/17ba505.js" defer></script><script src="/_nuxt/4293a24.js" defer></script><script src="/_nuxt/90cdebc.js" defer></script>
  </body>
</html>

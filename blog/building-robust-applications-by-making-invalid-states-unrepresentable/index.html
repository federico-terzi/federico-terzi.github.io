<!doctype html>
<!-- 
  Hi there! Welcome to my website :)
  It seems you are interested in the source code, did you
  know that the website is open-source? See:
  https://github.com/federico-terzi/federico-terzi.github.io
-->
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>The single, most important trick to build robust applications - Federico Terzi - A Software Engineering Journey</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="title" name="title" content="Federico Terzi - A Software Engineering Journey"><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" data-hid="description" name="description" content="In the last decade, many functional programming concepts have been making their way into modern, non-functional languages. Instead of going all-in, developers can choose to gradually adopt some of the paradigms in their applications, enjoying the best of both worlds."><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="The single, most important trick to build robust applications"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="In the last decade, many functional programming concepts have been making their way into modern, non-functional languages. Instead of going all-in, developers can choose to gradually adopt some of the paradigms in their applications, enjoying the best of both worlds."><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://federicoterzi.com/social/2022-05-02-building-robust-applications-by-making-invalid-states-unrepresentable.png"><meta data-n-head="ssr" name="twitter:card" content="summary"><meta data-n-head="ssr" name="twitter:site" content="@terzi_federico"><meta data-n-head="ssr" name="twitter:title" content="The single, most important trick to build robust applications"><meta data-n-head="ssr" name="twitter:description" content="In the last decade, many functional programming concepts have been making their way into modern, non-functional languages. Instead of going all-in, developers can choose to gradually adopt some of the paradigms in their applications, enjoying the best of both worlds."><meta data-n-head="ssr" name="twitter:image" content="https://federicoterzi.com/social/2022-05-02-building-robust-applications-by-making-invalid-states-unrepresentable.png"><link data-n-head="ssr" rel="stylesheet" href="/colors.css"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><link data-n-head="ssr" rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><link data-n-head="ssr" rel="manifest" href="/site.webmanifest"><link data-n-head="ssr" rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180"><link data-n-head="ssr" rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="preload" href="/_nuxt/5a3dd91.js" as="script"><link rel="preload" href="/_nuxt/9f592cb.js" as="script"><link rel="preload" href="/_nuxt/55fe2d7.js" as="script"><link rel="preload" href="/_nuxt/97a8332.js" as="script"><link rel="preload" href="/_nuxt/9c764e2.js" as="script"><style data-vue-ssr-id="c3ae2b30:0 d75bdb94:0 fa7ff0ca:0 56b15182:0 7ab12987:0 11a04204:0 4c3275e1:0 476c9a84:0 0356ed00:0 fcd77316:0 63f29e82:0 71a90360:0">@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(/_nuxt/fonts/inter-v7-latin-regular.33e43c3.eot);src:local(""),url(/_nuxt/fonts/inter-v7-latin-regular.33e43c3.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/inter-v7-latin-regular.5e6a773.woff2) format("woff2"),url(/_nuxt/fonts/inter-v7-latin-regular.cefb4aa.woff) format("woff"),url(/_nuxt/fonts/inter-v7-latin-regular.0e67589.ttf) format("truetype"),url(/_nuxt/b8db5cf5416facf0c5ec4489d0ee9bbe.svg#Inter) format("svg")}@font-face{font-family:Inter;font-style:normal;font-weight:700;font-display:swap;src:url(/_nuxt/fonts/inter-v7-latin-700.129e115.eot);src:local(""),url(/_nuxt/fonts/inter-v7-latin-700.129e115.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/inter-v7-latin-700.c2ceaa0.woff2) format("woff2"),url(/_nuxt/fonts/inter-v7-latin-700.7f5a89b.woff) format("woff"),url(/_nuxt/fonts/inter-v7-latin-700.6bb53f6.ttf) format("truetype"),url(/_nuxt/0a85e1f2fd11f8afbfa155c7c5ec0a12.svg#Inter) format("svg")}@font-face{font-family:"PT Serif";font-style:normal;font-weight:400;font-display:swap;src:url(/_nuxt/fonts/pt-serif-v16-latin-regular.ef9b698.eot);src:local(""),url(/_nuxt/fonts/pt-serif-v16-latin-regular.ef9b698.eot?#iefix) format("embedded-opentype"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.511cda7.woff2) format("woff2"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.b4f2a8d.woff) format("woff"),url(/_nuxt/fonts/pt-serif-v16-latin-regular.1602721.ttf) format("truetype"),url(/_nuxt/2b24347634a541da72419674a1818855.svg#PTSerif) format("svg")}html{--content-primary:#1a1a1a;--content-primary-inverted:#fff;--accent-primary:#c84c32;--accent-secondary:#2e4364;--accent-tertiary:#ecdbba;--accent-menu:#2e4364;--background-primary:#fff;--background-elevated:#f1f1f1;--background-semitransparent:hsla(0,0%,100%,0.7);--details:rgba(26,26,26,0.1)}html[data-theme=dark]{--content-primary:#fff;--content-primary-inverted:#1a1a1a;--accent-primary:#ef6b50;--accent-secondary:#8bb8ff;--accent-tertiary:#ecdbba;--accent-menu:#fff;--background-primary:#000;--background-elevated:#343434;--background-semitransparent:rgba(0,0,0,0.7);--details:hsla(0,0%,100%,0.1)}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}body,html{font-family:Inter,sans-serif;color:var(--content-primary);background-color:transparent;margin:0;padding:0}*{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.main-layout-container{max-width:1512px;margin:auto}.main-layout-content{padding-top:95px;min-height:100vh}@media (max-width:992px){.main-layout-content{padding-top:50px;max-width:100vw;overflow-x:hidden}}.container[data-v-71b3c000]{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;overflow:hidden;z-index:-10;background-color:var(--background-primary);transition:all .5s ease}.blurred[data-v-71b3c000]{filter:blur(50px);height:450px;width:450px}.animate[data-v-71b3c000]{-webkit-animation:rotate-center-data-v-71b3c000 120s linear infinite both;animation:rotate-center-data-v-71b3c000 120s linear infinite both}.red[data-v-71b3c000]{top:25vh;left:-10vw;background-color:var(--accent-primary)}.blue[data-v-71b3c000],.red[data-v-71b3c000]{position:absolute;opacity:.15}.blue[data-v-71b3c000]{top:0;right:-10vw;background-color:var(--accent-secondary)}.yellow[data-v-71b3c000]{position:absolute;top:75vh;left:40vw;background-color:var(--accent-tertiary);opacity:.4}html[data-theme=dark] .yellow[data-v-71b3c000]{opacity:.2}@media (max-width:992px){.blurred[data-v-71b3c000]{height:300px;width:300px}}@-webkit-keyframes rotate-center-data-v-71b3c000{0%{transform:rotate(0) translateX(0) translateY(0)}50%{transform:rotate(180deg) translateX(300px) translateY(300px)}to{transform:rotate(1turn) translateX(0) translateY(0)}}@keyframes rotate-center-data-v-71b3c000{0%{transform:rotate(0) translateX(0) translateY(0)}50%{transform:rotate(180deg) translateX(300px) translateY(300px)}to{transform:rotate(1turn) translateX(0) translateY(0)}}.header[data-v-4dabaaf4]{position:fixed;top:0;right:0;left:0;z-index:20;background-color:transparent;box-shadow:none;transition:all .2s ease-in-out}html:not([data-scroll="0"]) .header[data-v-4dabaaf4]{background-color:var(--background-primary);box-shadow:0 4px 43px rgba(0,0,0,.1)}.content[data-v-4dabaaf4]{display:flex;align-items:center;justify-content:space-between;padding:25px;max-width:1512px;margin:auto}.logo-link[data-v-4dabaaf4]{text-decoration:none}.details[data-v-4dabaaf4]{display:flex}.logo[data-v-4dabaaf4]{margin-right:16px}.details-text[data-v-4dabaaf4]{display:flex;flex-direction:column;justify-content:center}.name[data-v-4dabaaf4]{font-size:24px;line-height:28px;color:var(--accent-primary)}.name[data-v-4dabaaf4],.tagline[data-v-4dabaaf4]{font-weight:700;text-shadow:0 4px 4px rgba(0,0,0,.05)}.tagline[data-v-4dabaaf4]{font-size:14px;line-height:17px;opacity:.8;color:var(--content-primary)}html[data-theme=dark] .tagline[data-v-4dabaaf4]{opacity:.9}.menu-link[data-v-4dabaaf4]{position:relative;font-style:normal;font-weight:700;font-size:18px;line-height:22px;color:var(--accent-menu);margin-left:48px;text-decoration:none;transition:all .3s ease}.menu-link[data-v-4dabaaf4]:hover{color:var(--accent-primary)}.menu-link[data-v-4dabaaf4]:after{content:"";position:absolute;display:block;width:100%;height:2px;bottom:-3px;left:0;background-color:var(--accent-secondary);transform:scaleX(0);opacity:0;transition:all .3s ease}.menu-link[data-v-4dabaaf4]:hover:after{transform:scaleX(1);opacity:1;background-color:var(--accent-primary)}.open-mobile-menu[data-v-4dabaaf4]{display:none}.mobile-menu[data-v-4dabaaf4]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:var(--background-semitransparent);z-index:1000;box-shadow:0 3px 18px rgba(0,0,0,.1);display:flex;flex-direction:column;justify-content:center;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);perspective:1000px}.menu-divider[data-v-4dabaaf4]{opacity:.05;border-bottom:2px solid #2e4364;margin-right:32px;margin-left:32px}.fade-enter-active[data-v-4dabaaf4],.fade-leave-active[data-v-4dabaaf4]{transition:opacity .5s}.fade-enter[data-v-4dabaaf4],.fade-leave-to[data-v-4dabaaf4]{opacity:0;-webkit-backdrop-filter:blur(0);backdrop-filter:blur(0)}@media (max-width:992px){.name[data-v-4dabaaf4]{font-size:14px;line-height:17px}.tagline[data-v-4dabaaf4]{display:none}.details-text[data-v-4dabaaf4]{opacity:0;transition:opacity .2s ease-in-out}html:not([data-scroll="0"]) .details-text[data-v-4dabaaf4]{opacity:1}.content[data-v-4dabaaf4]{padding:14px}.extended-menu[data-v-4dabaaf4]{display:none}.open-mobile-menu[data-v-4dabaaf4]{display:block;margin-right:4px;filter:drop-shadow(0 4px 16px rgba(0,0,0,.25))}.menu-link[data-v-4dabaaf4]{text-align:center;margin-left:0;margin-top:18px;margin-bottom:18px;-webkit-animation:slide-in-bck-center-data-v-4dabaaf4 .7s cubic-bezier(.25,.46,.45,.94) both;animation:slide-in-bck-center-data-v-4dabaaf4 .7s cubic-bezier(.25,.46,.45,.94) both}.mobile-menu-links[data-v-4dabaaf4]{display:flex;flex-direction:column;justify-content:center;flex:1}.mobile-menu-label[data-v-4dabaaf4]{text-align:center;font-size:12px;margin-bottom:100px}}@-webkit-keyframes slide-in-bck-center-data-v-4dabaaf4{0%{transform:translateZ(600px);opacity:0}to{transform:translateZ(0);opacity:1}}@keyframes slide-in-bck-center-data-v-4dabaaf4{0%{transform:translateZ(600px);opacity:0}to{transform:translateZ(0);opacity:1}}.container[data-v-66baf38d]{position:relative;width:46px;height:46px}.f[data-v-66baf38d],.t[data-v-66baf38d]{position:absolute}.t[data-v-66baf38d]{left:-3px;top:-1px}@media (max-width:992px){.container[data-v-66baf38d],.f[data-v-66baf38d],.t[data-v-66baf38d]{height:32px;width:32px}.t[data-v-66baf38d]{left:-1px;top:0}}.post-title[data-v-4240d724]{font-style:normal;font-weight:700;font-size:36px;line-height:44px;color:var(--content-primary);margin-top:0;margin-bottom:6px}.post-details[data-v-4240d724]{font-size:14px;line-height:17px;color:var(--content-secondary);margin-bottom:34px}.post-footer[data-v-4240d724]{margin-top:28px}.short-page-container{max-width:700px;margin-right:auto;margin-left:auto;margin-top:30px;padding:28px}.short-page-title{margin-bottom:50px;margin-left:-8px}@media (max-width:992px){.short-page-container{margin-top:10px}}.post-footer-container[data-v-63505c64]{font-size:18px;line-height:22px;border-top:1px solid var(--details);padding-top:28px;display:flex}.post-footer-image[data-v-63505c64]{height:138px;width:138px}.post-footer-content[data-v-63505c64]{margin-left:28px}.post-footer-content p[data-v-63505c64]:first-child{margin-top:0}.red[data-v-63505c64]{color:var(--accent-primary)}.blue[data-v-63505c64],.red[data-v-63505c64]{font-weight:700}.blue[data-v-63505c64]{color:var(--accent-secondary)}a[data-v-63505c64]{text-underline-offset:2px;text-decoration-thickness:2px}@media (max-width:992px){.post-footer-container[data-v-63505c64]{align-items:center;flex-direction:column}.post-footer-content[data-v-63505c64]{margin-left:0;margin-top:28px}}.footer-container[data-v-31194f02]{font-size:14px;line-height:17px;text-align:center;color:var(--accent-menu);margin-top:40px;padding-right:16px;padding-left:16px}.bold[data-v-31194f02]{font-weight:700}.red[data-v-31194f02]{color:var(--accent-primary)}.social-bar-container{position:fixed;left:24px;bottom:24px;background:var(--background-elevated);border:1px solid var(--details);box-sizing:border-box;box-shadow:0 3px 8px 2px rgba(0,0,0,.1);border-radius:4px;display:flex;justify-content:space-evenly;width:360px;padding-top:10px;padding-bottom:10px;transition:all .3s ease}html[data-scrolled-to-bottom=true] .social-bar-container{opacity:0;transform:translateY(100px)}.social-bar-container a{display:flex;align-items:center;filter:drop-shadow(0 4px 6px rgba(0,0,0,.25));transition:all .3s ease}.social-bar-container a:hover{transform:scale(1.2) translateY(-3px)}.social-bar-container a path{stroke:var(--accent-primary)}.social-bar-divider{border-left:1px solid var(--details)}@media (max-width:992px){.social-bar-container{left:0;right:0;bottom:0;width:100%;border-radius:0}}</style><link rel="preload" href="/_nuxt/static/1660563508/blog/building-robust-applications-by-making-invalid-states-unrepresentable/state.js" as="script"><link rel="preload" href="/_nuxt/static/1660563508/blog/building-robust-applications-by-making-invalid-states-unrepresentable/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1660563508/manifest.js" as="script">
    <script>const debounce=t=>{let c;return(...e)=>{c&&cancelAnimationFrame(c),c=requestAnimationFrame(()=>{t(...e)})}},handleScroll=()=>{document.documentElement.dataset.scroll=window.scrollY,document.documentElement.dataset.scrolledToBottom=window.innerHeight+window.scrollY>=document.body?.offsetHeight?"true":"false"};function switchTheme(e){"dark"===e?document.documentElement.setAttribute("data-theme","dark"):document.documentElement.setAttribute("data-theme","light")}document.addEventListener("scroll",debounce(handleScroll),{passive:!0}),handleScroll();const prefersDarkScheme=window.matchMedia("(prefers-color-scheme: dark)");prefersDarkScheme.matches&&switchTheme("dark"),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches?switchTheme("dark"):switchTheme("light"))</script>
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="main-layout-container"><div class="container" data-v-71b3c000><div class="blurred red animate" data-v-71b3c000></div> <div class="blurred yellow animate" data-v-71b3c000></div> <div class="blurred blue animate" data-v-71b3c000></div></div> <div id="header" class="header" data-v-4dabaaf4><div class="content" data-v-4dabaaf4><a href="/" class="logo-link nuxt-link-active" data-v-4dabaaf4><div class="details" data-v-4dabaaf4><div class="container logo" data-v-66baf38d data-v-4dabaaf4><svg width="51" height="47" viewBox="0 0 51 47" fill="none" xmlns="http://www.w3.org/2000/svg" class="f" data-v-66baf38d data-v-66baf38d><g filter="url(#filter0_d_15_34)" data-v-66baf38d data-v-66baf38d><path d="M2.09039 44.1666V2H48L2.09039 44.1666Z" fill="#C84C32" data-v-66baf38d data-v-66baf38d></path></g><defs data-v-66baf38d data-v-66baf38d><filter id="filter0_d_15_34" x="0.0543151" y="0.506876" width="49.9818" height="46.2388" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" data-v-66baf38d data-v-66baf38d><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-66baf38d data-v-66baf38d></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" data-v-66baf38d data-v-66baf38d></feColorMatrix><feOffset dy="0.542954" data-v-66baf38d data-v-66baf38d></feOffset><feGaussianBlur stdDeviation="1.01804" data-v-66baf38d data-v-66baf38d></feGaussianBlur><feComposite in2="hardAlpha" operator="out" data-v-66baf38d data-v-66baf38d></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" data-v-66baf38d data-v-66baf38d></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_15_34" data-v-66baf38d data-v-66baf38d></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_15_34" result="shape" data-v-66baf38d data-v-66baf38d></feBlend></filter></defs></svg> <svg width="53" height="49" viewBox="0 0 53 49" fill="none" xmlns="http://www.w3.org/2000/svg" class="t" data-v-66baf38d data-v-66baf38d><g filter="url(#filter0_d_15_35)" data-v-66baf38d data-v-66baf38d><path d="M28.0452 45.0836L5 3H51L28.0452 45.0836Z" fill="url(#paint0_linear_15_35)" data-v-66baf38d data-v-66baf38d></path></g><defs data-v-66baf38d data-v-66baf38d><filter id="filter0_d_15_35" x="0.656367" y="0.556706" width="51.9725" height="48.0561" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" data-v-66baf38d data-v-66baf38d><feFlood flood-opacity="0" result="BackgroundImageFix" data-v-66baf38d data-v-66baf38d></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" data-v-66baf38d data-v-66baf38d></feColorMatrix><feOffset dx="-1.35739" dy="0.542954" data-v-66baf38d data-v-66baf38d></feOffset><feGaussianBlur stdDeviation="1.49312" data-v-66baf38d data-v-66baf38d></feGaussianBlur><feComposite in2="hardAlpha" operator="out" data-v-66baf38d data-v-66baf38d></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0" data-v-66baf38d data-v-66baf38d></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_15_35" data-v-66baf38d data-v-66baf38d></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_15_35" result="shape" data-v-66baf38d data-v-66baf38d></feBlend></filter><linearGradient id="paint0_linear_15_35" x1="28" y1="3" x2="28" y2="45.0836" gradientUnits="userSpaceOnUse" data-v-66baf38d data-v-66baf38d><stop stop-color="#ECDBBA" stop-opacity="0.49" data-v-66baf38d data-v-66baf38d></stop><stop offset="1" stop-color="#ECDBBA" data-v-66baf38d data-v-66baf38d></stop></linearGradient></defs></svg></div> <div class="details-text" data-v-4dabaaf4><span class="name" data-v-4dabaaf4>Federico Terzi</span> <span class="tagline" data-v-4dabaaf4>A Software Engineering Journey</span></div></div></a> <div class="extended-menu" data-v-4dabaaf4><a href="/#about" class="menu-link" data-v-4dabaaf4>About</a><a href="/projects" class="menu-link" data-v-4dabaaf4>Projects</a><a href="/blog" class="menu-link nuxt-link-active" data-v-4dabaaf4>Blog</a><a href="/contact-me" class="menu-link" data-v-4dabaaf4>Contact me</a></div> <div class="open-mobile-menu" data-v-4dabaaf4><svg width="26" height="18" viewBox="0 0 26 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="menu-icon" data-v-4dabaaf4 data-v-4dabaaf4><path d="M2 9.25H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-4dabaaf4 data-v-4dabaaf4></path><path d="M2 2H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-4dabaaf4 data-v-4dabaaf4></path><path d="M2 16.5H23.75" stroke="#C84C32" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-4dabaaf4 data-v-4dabaaf4></path></svg></div> <!----></div></div> <div class="main-layout-content"><article data-v-4240d724><div class="short-page-container" data-v-4240d724><!----> <h1 class="post-title" data-v-4240d724>The single, most important trick to build robust applications</h1> <p class="post-details" data-v-4240d724>
      May 2, 2022 - by Federico Terzi
    </p> <div class="post-content" data-v-4240d724><div class="nuxt-content" data-v-4240d724><p data-v-4240d724>In the last decade, many functional programming concepts have been making their way into modern, non-functional languages. Instead of going all-in, developers can choose to gradually adopt some of the paradigms in their applications, enjoying the best of both worlds.</p>

<p data-v-4240d724>In this article, we are going to discuss a functional programming technique that can greatly improve the reliability of your front-end applications: making invalid states unrepresentable. Although these concepts can be applied to most frameworks and languages, we are going to focus on React applications written in TypeScript.</p>
<h2 id="our-example" data-v-4240d724><a href="#our-example" aria-hidden="true" tabindex="-1" data-v-4240d724><span class="icon icon-link" data-v-4240d724></span></a>Our example</h2>
<p data-v-4240d724>To start our discussion, we are going to focus on a simple login form as an example (you can find the complete code in <a href="https://codesandbox.io/s/reactinvalidstatesunrepresentable-bad-tbwvi?file=/src/App.tsx" rel="nofollow noopener noreferrer" target="_blank" data-v-4240d724>this Codesanbox</a>).
In a nutshell, the example is composed of:</p>
<ul data-v-4240d724>
<li data-v-4240d724>A <code data-v-4240d724>LoginBox</code> component, which contains the input fields and invokes a callback when the user clicks on <code data-v-4240d724>Login</code></li>
<li data-v-4240d724>A <code data-v-4240d724>login</code> function, which simulates a network call to a login endpoint. If successful, this function returns a <em data-v-4240d724>token</em>.</li>
<li data-v-4240d724>The <code data-v-4240d724>App</code> component, which keeps the application state and displays the appropriate messages/components.</li>
</ul>
<p data-v-4240d724><img alt="Login example" src="/posts/states-unrepresentable/login_example_1.gif" data-v-4240d724></p>
<p data-v-4240d724>Here's the complete code:</p>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724><span class="token keyword" data-v-4240d724>import</span> <span class="token punctuation" data-v-4240d724>{</span> useState <span class="token punctuation" data-v-4240d724>}</span> <span class="token keyword" data-v-4240d724>from</span> <span class="token string" data-v-4240d724>"react"</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>LoginBox</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span>
  onLogin
<span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token function-variable function" data-v-4240d724>onLogin</span><span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>(</span>user<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>,</span> pass<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token keyword" data-v-4240d724>void</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token keyword" data-v-4240d724>const</span> <span class="token punctuation" data-v-4240d724>[</span>user<span class="token punctuation" data-v-4240d724>,</span> setUser<span class="token punctuation" data-v-4240d724>]</span> <span class="token operator" data-v-4240d724>=</span> <span class="token function" data-v-4240d724>useState</span><span class="token punctuation" data-v-4240d724>(</span><span class="token string" data-v-4240d724>""</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token keyword" data-v-4240d724>const</span> <span class="token punctuation" data-v-4240d724>[</span>pass<span class="token punctuation" data-v-4240d724>,</span> setPass<span class="token punctuation" data-v-4240d724>]</span> <span class="token operator" data-v-4240d724>=</span> <span class="token function" data-v-4240d724>useState</span><span class="token punctuation" data-v-4240d724>(</span><span class="token string" data-v-4240d724>""</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>(</span>
    <span class="token operator" data-v-4240d724>&lt;</span>div<span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>Insert login <span class="token function" data-v-4240d724>details</span> <span class="token punctuation" data-v-4240d724>(</span>use <span class="token string" data-v-4240d724>'test'</span> <span class="token keyword" data-v-4240d724>as</span> password <span class="token keyword" data-v-4240d724>for</span> correct logins<span class="token punctuation" data-v-4240d724>)</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>label htmlFor<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"user"</span><span class="token operator" data-v-4240d724>></span>User<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>label<span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>input
        type<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"text"</span>
        value<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>user<span class="token punctuation" data-v-4240d724>}</span>
        onChange<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span><span class="token punctuation" data-v-4240d724>(</span>e<span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token function" data-v-4240d724>setUser</span><span class="token punctuation" data-v-4240d724>(</span>e<span class="token punctuation" data-v-4240d724>.</span>target<span class="token punctuation" data-v-4240d724>.</span>value<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>label htmlFor<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"pass"</span><span class="token operator" data-v-4240d724>></span>Password<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>label<span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>input
        name<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"pass"</span>
        type<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"password"</span>
        value<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>pass<span class="token punctuation" data-v-4240d724>}</span>
        onChange<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span><span class="token punctuation" data-v-4240d724>(</span>e<span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token function" data-v-4240d724>setPass</span><span class="token punctuation" data-v-4240d724>(</span>e<span class="token punctuation" data-v-4240d724>.</span>target<span class="token punctuation" data-v-4240d724>.</span>value<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>button onClick<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token function" data-v-4240d724>onLogin</span><span class="token punctuation" data-v-4240d724>(</span>user<span class="token punctuation" data-v-4240d724>,</span> pass<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>></span>Login<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>button<span class="token operator" data-v-4240d724>></span>
    <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>div<span class="token operator" data-v-4240d724>></span>
  <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token comment" data-v-4240d724>// Simulate a login request</span>
<span class="token keyword" data-v-4240d724>function</span> <span class="token function" data-v-4240d724>login</span><span class="token punctuation" data-v-4240d724>(</span>user<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>,</span> pass<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>)</span><span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>Promise</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token builtin" data-v-4240d724>string</span><span class="token operator" data-v-4240d724>></span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token keyword" data-v-4240d724>return</span> <span class="token keyword" data-v-4240d724>new</span> <span class="token class-name" data-v-4240d724><span class="token builtin" data-v-4240d724>Promise</span></span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>(</span>resolve<span class="token punctuation" data-v-4240d724>,</span> reject<span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>setTimeout</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token keyword" data-v-4240d724>if</span> <span class="token punctuation" data-v-4240d724>(</span>pass <span class="token operator" data-v-4240d724>===</span> <span class="token string" data-v-4240d724>"test"</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
        <span class="token comment" data-v-4240d724>// Return a fake user token</span>
        <span class="token function" data-v-4240d724>resolve</span><span class="token punctuation" data-v-4240d724>(</span><span class="token string" data-v-4240d724>"c6041ffc-5e13-4f6d-bb33-bf9d3ae20262"</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
      <span class="token punctuation" data-v-4240d724>}</span> <span class="token keyword" data-v-4240d724>else</span> <span class="token punctuation" data-v-4240d724>{</span>
        <span class="token function" data-v-4240d724>reject</span><span class="token punctuation" data-v-4240d724>(</span><span class="token keyword" data-v-4240d724>new</span> <span class="token class-name" data-v-4240d724>Error</span><span class="token punctuation" data-v-4240d724>(</span><span class="token string" data-v-4240d724>"invalid password"</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
      <span class="token punctuation" data-v-4240d724>}</span>
    <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>,</span> <span class="token number" data-v-4240d724>1000</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span>

<span class="token keyword" data-v-4240d724>export</span> <span class="token keyword" data-v-4240d724>default</span> <span class="token keyword" data-v-4240d724>function</span> <span class="token function" data-v-4240d724>App</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token keyword" data-v-4240d724>const</span> <span class="token punctuation" data-v-4240d724>[</span>loading<span class="token punctuation" data-v-4240d724>,</span> setLoading<span class="token punctuation" data-v-4240d724>]</span> <span class="token operator" data-v-4240d724>=</span> <span class="token function" data-v-4240d724>useState</span><span class="token punctuation" data-v-4240d724>(</span><span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token keyword" data-v-4240d724>const</span> <span class="token punctuation" data-v-4240d724>[</span>userToken<span class="token punctuation" data-v-4240d724>,</span> setUserToken<span class="token punctuation" data-v-4240d724>]</span> <span class="token operator" data-v-4240d724>=</span> <span class="token generic-function" data-v-4240d724><span class="token function" data-v-4240d724>useState</span><span class="token generic class-name" data-v-4240d724><span class="token operator" data-v-4240d724>&lt;</span><span class="token builtin" data-v-4240d724>string</span> <span class="token operator" data-v-4240d724>|</span> <span class="token keyword" data-v-4240d724>undefined</span><span class="token operator" data-v-4240d724>></span></span></span><span class="token punctuation" data-v-4240d724>(</span><span class="token keyword" data-v-4240d724>undefined</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token keyword" data-v-4240d724>const</span> <span class="token punctuation" data-v-4240d724>[</span>error<span class="token punctuation" data-v-4240d724>,</span> setError<span class="token punctuation" data-v-4240d724>]</span> <span class="token operator" data-v-4240d724>=</span> <span class="token generic-function" data-v-4240d724><span class="token function" data-v-4240d724>useState</span><span class="token generic class-name" data-v-4240d724><span class="token operator" data-v-4240d724>&lt;</span><span class="token builtin" data-v-4240d724>unknown</span> <span class="token operator" data-v-4240d724>|</span> <span class="token keyword" data-v-4240d724>undefined</span><span class="token operator" data-v-4240d724>></span></span></span><span class="token punctuation" data-v-4240d724>(</span><span class="token keyword" data-v-4240d724>undefined</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>handleLogin</span> <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>async</span> <span class="token punctuation" data-v-4240d724>(</span>user<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>,</span> pass<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>setLoading</span><span class="token punctuation" data-v-4240d724>(</span><span class="token boolean" data-v-4240d724>true</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

    <span class="token comment" data-v-4240d724>// If we don't reset them here, we might have inconsistencies</span>
    <span class="token comment" data-v-4240d724>// after multiple logins</span>
    <span class="token function" data-v-4240d724>setError</span><span class="token punctuation" data-v-4240d724>(</span><span class="token keyword" data-v-4240d724>undefined</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token function" data-v-4240d724>setUserToken</span><span class="token punctuation" data-v-4240d724>(</span><span class="token keyword" data-v-4240d724>undefined</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

    <span class="token keyword" data-v-4240d724>try</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token keyword" data-v-4240d724>const</span> newUserToken <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>await</span> <span class="token function" data-v-4240d724>login</span><span class="token punctuation" data-v-4240d724>(</span>user<span class="token punctuation" data-v-4240d724>,</span> pass<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

      <span class="token function" data-v-4240d724>setUserToken</span><span class="token punctuation" data-v-4240d724>(</span>newUserToken<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span> <span class="token keyword" data-v-4240d724>catch</span> <span class="token punctuation" data-v-4240d724>(</span>error<span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token function" data-v-4240d724>setError</span><span class="token punctuation" data-v-4240d724>(</span>error<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>

    <span class="token comment" data-v-4240d724>// We need to explicitly tell react that we are not loading anymore</span>
    <span class="token function" data-v-4240d724>setLoading</span><span class="token punctuation" data-v-4240d724>(</span><span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>handleLogout</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>setUserToken</span><span class="token punctuation" data-v-4240d724>(</span><span class="token keyword" data-v-4240d724>undefined</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>(</span>
    <span class="token operator" data-v-4240d724>&lt;</span>div className<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"App"</span><span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>h1<span class="token operator" data-v-4240d724>></span>Login Example<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>h1<span class="token operator" data-v-4240d724>></span>

      <span class="token punctuation" data-v-4240d724>{</span>loading <span class="token operator" data-v-4240d724>&&</span> <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>Loading<span class="token operator" data-v-4240d724>...</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token punctuation" data-v-4240d724>{</span>error <span class="token operator" data-v-4240d724>&&</span> <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>An error occurred<span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>{</span><span class="token function" data-v-4240d724>String</span><span class="token punctuation" data-v-4240d724>(</span>error<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token punctuation" data-v-4240d724>{</span><span class="token operator" data-v-4240d724>!</span>userToken <span class="token operator" data-v-4240d724>?</span> <span class="token punctuation" data-v-4240d724>(</span>
        <span class="token operator" data-v-4240d724>&lt;</span>LoginBox onLogin<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>handleLogin<span class="token punctuation" data-v-4240d724>}</span> <span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>(</span>
        <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>></span>
          <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>You're logged <span class="token keyword" data-v-4240d724>in</span><span class="token operator" data-v-4240d724>!</span> Your user token <span class="token keyword" data-v-4240d724>is</span> <span class="token punctuation" data-v-4240d724>{</span>userToken<span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span>
          <span class="token operator" data-v-4240d724>&lt;</span>button onClick<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>handleLogout<span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>></span>Logout<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>button<span class="token operator" data-v-4240d724>></span>
        <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span>
    <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>div<span class="token operator" data-v-4240d724>></span>
  <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span>
</code></pre></div>
<h2 id="the-problem" data-v-4240d724><a href="#the-problem" aria-hidden="true" tabindex="-1" data-v-4240d724><span class="icon icon-link" data-v-4240d724></span></a>The problem</h2>
<p data-v-4240d724>The example proposed above works as expected, but it's not very maintainable. The main problem lies in the fact that the different app-state fields (loading, error, userToken) are stored and updated independently.</p>
<p data-v-4240d724>Suppose at some point, a coworker not particularly familiar with this area of the codebase changes the <code data-v-4240d724>handleLogin</code> logic to fit some new requirements. As part of the process, they mistakenly forget to reset the error state with <code data-v-4240d724>setError(undefined)</code>:</p>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724>  <span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>handleLogin</span> <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>async</span> <span class="token punctuation" data-v-4240d724>(</span>user<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>,</span> pass<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>setLoading</span><span class="token punctuation" data-v-4240d724>(</span><span class="token boolean" data-v-4240d724>true</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

    <span class="token comment" data-v-4240d724>// The coworker deletes the following line</span>
    <span class="token comment" data-v-4240d724>// setError(undefined);  &lt;- this one gets deleted</span>
    <span class="token function" data-v-4240d724>setUserToken</span><span class="token punctuation" data-v-4240d724>(</span><span class="token keyword" data-v-4240d724>undefined</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

    <span class="token keyword" data-v-4240d724>try</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token keyword" data-v-4240d724>const</span> newUserToken <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>await</span> <span class="token function" data-v-4240d724>login</span><span class="token punctuation" data-v-4240d724>(</span>user<span class="token punctuation" data-v-4240d724>,</span> pass<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

      <span class="token function" data-v-4240d724>setUserToken</span><span class="token punctuation" data-v-4240d724>(</span>newUserToken<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span> <span class="token keyword" data-v-4240d724>catch</span> <span class="token punctuation" data-v-4240d724>(</span>error<span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token function" data-v-4240d724>setError</span><span class="token punctuation" data-v-4240d724>(</span>error<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>

    <span class="token comment" data-v-4240d724>// We need to explicitly tell react that we are not loading anymore</span>
    <span class="token function" data-v-4240d724>setLoading</span><span class="token punctuation" data-v-4240d724>(</span><span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
</code></pre></div>
<p data-v-4240d724>The coworker now attempts to log in and it works as expected:</p>
<p data-v-4240d724><img alt="Login seems to work as expected" src="/posts/states-unrepresentable/login_example_2.gif" data-v-4240d724></p>
<p data-v-4240d724>The happy coworker then proceeds to create PR and, with a non-zero probability, the PR gets approved and goes into staging/production.</p>
<p data-v-4240d724>Happy ending, right? Not exactly. The application can now enter an <em data-v-4240d724>inconsistent state</em> when a user gets the first login wrong and the second one correct:</p>
<p data-v-4240d724><img alt="Login inconsistent state" src="/posts/states-unrepresentable/login_example_3.gif" data-v-4240d724></p>
<p data-v-4240d724>As you can see, <strong data-v-4240d724>the error message is still being shown after a successful login attempt</strong>.
This is happening because the <code data-v-4240d724>setError(undefined)</code> call has been removed, and as a result, the error message is not being reset when performing a new login attempt.</p>
<p data-v-4240d724>It might be easy to blame the coworker for such an oversight, but actually, the problem lies in the way the application state was originally structured. By having the <code data-v-4240d724>error</code>, <code data-v-4240d724>loading</code> and <code data-v-4240d724>userToken</code> states being updated independently, we made it easier to get into an inconsistent state.</p>
<p data-v-4240d724>Remember, <strong data-v-4240d724>the best systems are the ones that make it harder to do wrong things.</strong> In the following sections, we're going to analyze a design that could have prevented such mistakes.</p>
<blockquote data-v-4240d724>
<p data-v-4240d724>In the previous example, I chose an hypothetical coworker as the person doing the mistake. I'm definitely not implying that only coworkers make mistakes, everyone does. I do plenty of mistakes on a daily basis :)</p>
</blockquote>
<h2 id="a-better-approach-but-still-not-optimal" data-v-4240d724><a href="#a-better-approach-but-still-not-optimal" aria-hidden="true" tabindex="-1" data-v-4240d724><span class="icon icon-link" data-v-4240d724></span></a>A better approach (but still not optimal)</h2>
<p data-v-4240d724>I hear some of you screaming: "<em data-v-4240d724>You should have used useReducer/Redux/Zustand/{random pokemon name} instead of those multiple useState!</em>"</p>
<p data-v-4240d724>Indeed, in real-world scenarios, you would have likely used a more structured approach to handle the app state, but <strong data-v-4240d724>that doesn't necessarily solve the problem of invalid states</strong>.</p>
<p data-v-4240d724>For example, let's refactor the <code data-v-4240d724>App</code> code to use React's <a href="https://reactjs.org/docs/hooks-reference.html#usereducer" rel="nofollow noopener noreferrer" target="_blank" data-v-4240d724>useReducer</a> instead of multiple <code data-v-4240d724>useState</code>:</p>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724><span class="token comment" data-v-4240d724>// This is the app state</span>
<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>State</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  loading<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>boolean</span><span class="token punctuation" data-v-4240d724>;</span>
  error<span class="token operator" data-v-4240d724>?</span><span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>unknown</span><span class="token punctuation" data-v-4240d724>;</span>
  userToken<span class="token operator" data-v-4240d724>?</span><span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>const</span> initialState<span class="token operator" data-v-4240d724>:</span> State <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token comment" data-v-4240d724>// The various actions we can use to update that state</span>
<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>PendingAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"pending"</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>SuccessAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>;</span>
  userToken<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>FailureAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>;</span>
  error<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>unknown</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>LogoutAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"logout"</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>Action</span> <span class="token operator" data-v-4240d724>=</span> PendingAction <span class="token operator" data-v-4240d724>|</span> SuccessAction <span class="token operator" data-v-4240d724>|</span> FailureAction <span class="token operator" data-v-4240d724>|</span> LogoutAction<span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>function</span> <span class="token function" data-v-4240d724>reducer</span><span class="token punctuation" data-v-4240d724>(</span>state<span class="token operator" data-v-4240d724>:</span> State<span class="token punctuation" data-v-4240d724>,</span> action<span class="token operator" data-v-4240d724>:</span> Action<span class="token punctuation" data-v-4240d724>)</span><span class="token operator" data-v-4240d724>:</span> State <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token keyword" data-v-4240d724>switch</span> <span class="token punctuation" data-v-4240d724>(</span>action<span class="token punctuation" data-v-4240d724>.</span>type<span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"pending"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>{</span>
        loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>true</span>
      <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"success"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>{</span>
        loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>,</span>
        userToken<span class="token operator" data-v-4240d724>:</span> action<span class="token punctuation" data-v-4240d724>.</span>userToken
      <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>{</span>
        loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>,</span>
        error<span class="token operator" data-v-4240d724>:</span> action<span class="token punctuation" data-v-4240d724>.</span>error
      <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"logout"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> initialState<span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span>
<span class="token punctuation" data-v-4240d724>}</span>

<span class="token keyword" data-v-4240d724>export</span> <span class="token keyword" data-v-4240d724>default</span> <span class="token keyword" data-v-4240d724>function</span> <span class="token function" data-v-4240d724>App</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token keyword" data-v-4240d724>const</span> <span class="token punctuation" data-v-4240d724>[</span>state<span class="token punctuation" data-v-4240d724>,</span> dispatch<span class="token punctuation" data-v-4240d724>]</span> <span class="token operator" data-v-4240d724>=</span> <span class="token function" data-v-4240d724>useReducer</span><span class="token punctuation" data-v-4240d724>(</span>reducer<span class="token punctuation" data-v-4240d724>,</span> initialState<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>handleLogin</span> <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>async</span> <span class="token punctuation" data-v-4240d724>(</span>user<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>,</span> pass<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"pending"</span> <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

    <span class="token keyword" data-v-4240d724>try</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token keyword" data-v-4240d724>const</span> newUserToken <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>await</span> <span class="token function" data-v-4240d724>login</span><span class="token punctuation" data-v-4240d724>(</span>user<span class="token punctuation" data-v-4240d724>,</span> pass<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

      <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>,</span> userToken<span class="token operator" data-v-4240d724>:</span> newUserToken <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span> <span class="token keyword" data-v-4240d724>catch</span> <span class="token punctuation" data-v-4240d724>(</span>error<span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>,</span> error <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>handleLogout</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"logout"</span> <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>(</span>
    <span class="token operator" data-v-4240d724>&lt;</span>div className<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"App"</span><span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>h1<span class="token operator" data-v-4240d724>></span>Login Example<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>h1<span class="token operator" data-v-4240d724>></span>

      <span class="token punctuation" data-v-4240d724>{</span>state<span class="token punctuation" data-v-4240d724>.</span>loading <span class="token operator" data-v-4240d724>&&</span> <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>Loading<span class="token operator" data-v-4240d724>...</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token punctuation" data-v-4240d724>{</span>state<span class="token punctuation" data-v-4240d724>.</span>error <span class="token operator" data-v-4240d724>&&</span> <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>An error occurred<span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>{</span><span class="token function" data-v-4240d724>String</span><span class="token punctuation" data-v-4240d724>(</span>state<span class="token punctuation" data-v-4240d724>.</span>error<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token punctuation" data-v-4240d724>{</span><span class="token operator" data-v-4240d724>!</span>state<span class="token punctuation" data-v-4240d724>.</span>userToken <span class="token operator" data-v-4240d724>?</span> <span class="token punctuation" data-v-4240d724>(</span>
        <span class="token operator" data-v-4240d724>&lt;</span>LoginBox onLogin<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>handleLogin<span class="token punctuation" data-v-4240d724>}</span> <span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>(</span>
        <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>></span>
          <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>You're logged <span class="token keyword" data-v-4240d724>in</span><span class="token operator" data-v-4240d724>!</span> Your user token <span class="token keyword" data-v-4240d724>is</span> <span class="token punctuation" data-v-4240d724>{</span>state<span class="token punctuation" data-v-4240d724>.</span>userToken<span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span>
          <span class="token operator" data-v-4240d724>&lt;</span>button onClick<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>handleLogout<span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>></span>Logout<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>button<span class="token operator" data-v-4240d724>></span>
        <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span>
    <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>div<span class="token operator" data-v-4240d724>></span>
  <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span>
</code></pre></div>
<p data-v-4240d724>This version improves our example on multiple fronts:</p>
<ul data-v-4240d724>
<li data-v-4240d724>The handlers (<code data-v-4240d724>handleLogin</code> and <code data-v-4240d724>handleLogout</code>) don't need to know about the internal state representation anymore, but can simply dispatch actions in a <em data-v-4240d724>declarative</em> way.</li>
<li data-v-4240d724>It's harder to forget updating a slice of the state, as they are handled in a central place (the <code data-v-4240d724>reducer</code> function) instead of being scattered around handlers.</li>
</ul>
<p data-v-4240d724>That said, despite making it harder to make the state inconsistent, it's still possible to do so.</p>
<p data-v-4240d724>Let's say that our product manager requests to implement a "failed attempts" counter. In a rush, we modify the <code data-v-4240d724>failure</code> case of the reducer to be based on the previous state:</p>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724>    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>{</span>
        <span class="token operator" data-v-4240d724>...</span>state<span class="token punctuation" data-v-4240d724>,</span>
        error<span class="token operator" data-v-4240d724>:</span> action<span class="token punctuation" data-v-4240d724>.</span>error<span class="token punctuation" data-v-4240d724>,</span>
        failedAttempts<span class="token operator" data-v-4240d724>:</span> state<span class="token punctuation" data-v-4240d724>.</span>failedAttempts <span class="token operator" data-v-4240d724>+</span> <span class="token number" data-v-4240d724>1</span><span class="token punctuation" data-v-4240d724>,</span>
      <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
</code></pre></div>
<p data-v-4240d724>As a result, the "Loading..." label is still shown after a failed login attempt:</p>
<p data-v-4240d724><img alt="Inconsistent state" src="/posts/states-unrepresentable/invalid-state.png" data-v-4240d724></p>
<p data-v-4240d724>Of course, this is another silly oversight that would have been easy to spot. We forgot to set <code data-v-4240d724>loading: false</code>, and instead took the previous state value (<code data-v-4240d724>true</code>) using the spread operator <code data-v-4240d724>...state</code>. Unfortunately, in real-world systems it's easy to make such mistakes when the state is made of many fields, and such oversights might not be as easy to spot.</p>
<p data-v-4240d724>Luckily, we can take this solution a step further. What if we let the compiler spot such mistakes? The answer is <strong data-v-4240d724>making invalid states unrepresentable</strong>.</p>
<h2 id="making-invalid-states-unrepresentable" data-v-4240d724><a href="#making-invalid-states-unrepresentable" aria-hidden="true" tabindex="-1" data-v-4240d724><span class="icon icon-link" data-v-4240d724></span></a>Making invalid states unrepresentable</h2>
<p data-v-4240d724>Let's start from the previous state representation:</p>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724><span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>State</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  loading<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>boolean</span><span class="token punctuation" data-v-4240d724>;</span>
  error<span class="token operator" data-v-4240d724>?</span><span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>unknown</span><span class="token punctuation" data-v-4240d724>;</span>
  userToken<span class="token operator" data-v-4240d724>?</span><span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
</code></pre></div>
<p data-v-4240d724>The first question we should be asking ourselves is: <em data-v-4240d724>what are the possible states of this system?</em> There is no single best answer, but a possible representation could be:</p>
<ul data-v-4240d724>
<li data-v-4240d724>Idle</li>
<li data-v-4240d724>Login pending</li>
<li data-v-4240d724>Login success</li>
<li data-v-4240d724>Login failure</li>
</ul>
<blockquote data-v-4240d724>
<p data-v-4240d724>If the <code data-v-4240d724>idle</code> state doesn't make sense to you, keep in mind we are trying to model <em data-v-4240d724>all</em> the possible states of this system. Idle represents the state of the system before the user makes a login attempt.</p>
</blockquote>
<p data-v-4240d724>Then, we can think about which <em data-v-4240d724>fields and values</em> those states can have:</p>
<ul data-v-4240d724>
<li data-v-4240d724>Idle
<ul data-v-4240d724>
<li data-v-4240d724>loading = false</li>
</ul>
</li>
<li data-v-4240d724>Login pending
<ul data-v-4240d724>
<li data-v-4240d724>loading = true</li>
</ul>
</li>
<li data-v-4240d724>Login success
<ul data-v-4240d724>
<li data-v-4240d724>loading = false</li>
<li data-v-4240d724>userToken = string</li>
</ul>
</li>
<li data-v-4240d724>Login failure
<ul data-v-4240d724>
<li data-v-4240d724>loading = false</li>
<li data-v-4240d724>error = Error/unknown/whatever is relevant</li>
</ul>
</li>
</ul>
<p data-v-4240d724>At this point, we can translate these states into code using Typescript's <a href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes-func.html#discriminated-unions" rel="nofollow noopener noreferrer" target="_blank" data-v-4240d724>Discriminated unions</a> (also known as <em data-v-4240d724>Algebraic Data Types</em>):</p>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724><span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>State</span> <span class="token operator" data-v-4240d724>=</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"idle"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"pending"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>true</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>;</span>
      userToken<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>;</span>
      error<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>unknown</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
</code></pre></div>
<p data-v-4240d724>Note how for each state, we are explicitly specifying which fields are present and, for some of them, even their value. Discriminated unions give us two superpowers:</p>
<ul data-v-4240d724>
<li data-v-4240d724>We don't need to add optional fields everywhere, nor do we need to check for undefined values. If a state has <code data-v-4240d724>type = "success"</code> then Typescript <em data-v-4240d724>guarantees</em> that the <code data-v-4240d724>userToken</code> field will be available. In the same way, we won't be able to access the <code data-v-4240d724>userToken</code> if the state is <code data-v-4240d724>failure</code></li>
</ul>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724><span class="token comment" data-v-4240d724>// This compiles correctly</span>
<span class="token keyword" data-v-4240d724>if</span> <span class="token punctuation" data-v-4240d724>(</span>state<span class="token punctuation" data-v-4240d724>.</span>type <span class="token operator" data-v-4240d724>===</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token builtin" data-v-4240d724>console</span><span class="token punctuation" data-v-4240d724>.</span><span class="token function" data-v-4240d724>log</span><span class="token punctuation" data-v-4240d724>(</span>state<span class="token punctuation" data-v-4240d724>.</span>userToken<span class="token punctuation" data-v-4240d724>)</span>
<span class="token punctuation" data-v-4240d724>}</span>

<span class="token comment" data-v-4240d724>// This doesn't (and it's good!)</span>
<span class="token keyword" data-v-4240d724>if</span> <span class="token punctuation" data-v-4240d724>(</span>state<span class="token punctuation" data-v-4240d724>.</span>type <span class="token operator" data-v-4240d724>===</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token builtin" data-v-4240d724>console</span><span class="token punctuation" data-v-4240d724>.</span><span class="token function" data-v-4240d724>log</span><span class="token punctuation" data-v-4240d724>(</span>state<span class="token punctuation" data-v-4240d724>.</span>userToken<span class="token punctuation" data-v-4240d724>)</span>
<span class="token punctuation" data-v-4240d724>}</span>
</code></pre></div>
<ul data-v-4240d724>
<li data-v-4240d724>We won't be able to set inconsistent states in the reducer</li>
</ul>
<p data-v-4240d724>Updating our previous example with the new approach, we get:</p>
<div class="nuxt-content-highlight" data-v-4240d724><pre class="language-ts line-numbers" data-v-4240d724><code data-v-4240d724><span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>State</span> <span class="token operator" data-v-4240d724>=</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"idle"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"pending"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>true</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>;</span>
      userToken<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token operator" data-v-4240d724>|</span> <span class="token punctuation" data-v-4240d724>{</span>
      type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>;</span>
      loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>;</span>
      error<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>unknown</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>const</span> initialState<span class="token operator" data-v-4240d724>:</span> State <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"idle"</span><span class="token punctuation" data-v-4240d724>,</span>
  loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>PendingAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"pending"</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>SuccessAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>;</span>
  userToken<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>FailureAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>;</span>
  error<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>unknown</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>LogoutAction</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>{</span>
  type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"logout"</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>type</span> <span class="token class-name" data-v-4240d724>Action</span> <span class="token operator" data-v-4240d724>=</span> PendingAction <span class="token operator" data-v-4240d724>|</span> SuccessAction <span class="token operator" data-v-4240d724>|</span> FailureAction <span class="token operator" data-v-4240d724>|</span> LogoutAction<span class="token punctuation" data-v-4240d724>;</span>

<span class="token keyword" data-v-4240d724>function</span> <span class="token function" data-v-4240d724>reducer</span><span class="token punctuation" data-v-4240d724>(</span>state<span class="token operator" data-v-4240d724>:</span> State<span class="token punctuation" data-v-4240d724>,</span> action<span class="token operator" data-v-4240d724>:</span> Action<span class="token punctuation" data-v-4240d724>)</span><span class="token operator" data-v-4240d724>:</span> State <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token keyword" data-v-4240d724>switch</span> <span class="token punctuation" data-v-4240d724>(</span>action<span class="token punctuation" data-v-4240d724>.</span>type<span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"pending"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>{</span>
        type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"pending"</span><span class="token punctuation" data-v-4240d724>,</span>
        loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>true</span>
      <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"success"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>{</span>
        type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>,</span>
        loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>,</span>
        userToken<span class="token operator" data-v-4240d724>:</span> action<span class="token punctuation" data-v-4240d724>.</span>userToken
      <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>{</span>
        <span class="token operator" data-v-4240d724>...</span>state<span class="token punctuation" data-v-4240d724>,</span>
        type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>,</span>
        loading<span class="token operator" data-v-4240d724>:</span> <span class="token boolean" data-v-4240d724>false</span><span class="token punctuation" data-v-4240d724>,</span>
        error<span class="token operator" data-v-4240d724>:</span> action<span class="token punctuation" data-v-4240d724>.</span>error
      <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token keyword" data-v-4240d724>case</span> <span class="token string" data-v-4240d724>"logout"</span><span class="token operator" data-v-4240d724>:</span>
      <span class="token keyword" data-v-4240d724>return</span> initialState<span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span>
<span class="token punctuation" data-v-4240d724>}</span>

<span class="token keyword" data-v-4240d724>export</span> <span class="token keyword" data-v-4240d724>default</span> <span class="token keyword" data-v-4240d724>function</span> <span class="token function" data-v-4240d724>App</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
  <span class="token keyword" data-v-4240d724>const</span> <span class="token punctuation" data-v-4240d724>[</span>state<span class="token punctuation" data-v-4240d724>,</span> dispatch<span class="token punctuation" data-v-4240d724>]</span> <span class="token operator" data-v-4240d724>=</span> <span class="token function" data-v-4240d724>useReducer</span><span class="token punctuation" data-v-4240d724>(</span>reducer<span class="token punctuation" data-v-4240d724>,</span> initialState<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>handleLogin</span> <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>async</span> <span class="token punctuation" data-v-4240d724>(</span>user<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>,</span> pass<span class="token operator" data-v-4240d724>:</span> <span class="token builtin" data-v-4240d724>string</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"pending"</span> <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

    <span class="token keyword" data-v-4240d724>try</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token keyword" data-v-4240d724>const</span> newUserToken <span class="token operator" data-v-4240d724>=</span> <span class="token keyword" data-v-4240d724>await</span> <span class="token function" data-v-4240d724>login</span><span class="token punctuation" data-v-4240d724>(</span>user<span class="token punctuation" data-v-4240d724>,</span> pass<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>

      <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"success"</span><span class="token punctuation" data-v-4240d724>,</span> userToken<span class="token operator" data-v-4240d724>:</span> newUserToken <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span> <span class="token keyword" data-v-4240d724>catch</span> <span class="token punctuation" data-v-4240d724>(</span>error<span class="token punctuation" data-v-4240d724>)</span> <span class="token punctuation" data-v-4240d724>{</span>
      <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"failure"</span><span class="token punctuation" data-v-4240d724>,</span> error <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
    <span class="token punctuation" data-v-4240d724>}</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>const</span> <span class="token function-variable function" data-v-4240d724>handleLogout</span> <span class="token operator" data-v-4240d724>=</span> <span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>=></span> <span class="token punctuation" data-v-4240d724>{</span>
    <span class="token function" data-v-4240d724>dispatch</span><span class="token punctuation" data-v-4240d724>(</span><span class="token punctuation" data-v-4240d724>{</span> type<span class="token operator" data-v-4240d724>:</span> <span class="token string" data-v-4240d724>"logout"</span> <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
  <span class="token punctuation" data-v-4240d724>}</span><span class="token punctuation" data-v-4240d724>;</span>

  <span class="token keyword" data-v-4240d724>return</span> <span class="token punctuation" data-v-4240d724>(</span>
    <span class="token operator" data-v-4240d724>&lt;</span>div className<span class="token operator" data-v-4240d724>=</span><span class="token string" data-v-4240d724>"App"</span><span class="token operator" data-v-4240d724>></span>
      <span class="token operator" data-v-4240d724>&lt;</span>h1<span class="token operator" data-v-4240d724>></span>Login Example<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>h1<span class="token operator" data-v-4240d724>></span>

      <span class="token punctuation" data-v-4240d724>{</span>state<span class="token punctuation" data-v-4240d724>.</span>loading <span class="token operator" data-v-4240d724>&&</span> <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>Loading<span class="token operator" data-v-4240d724>...</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token punctuation" data-v-4240d724>{</span>state<span class="token punctuation" data-v-4240d724>.</span>type <span class="token operator" data-v-4240d724>===</span> <span class="token string" data-v-4240d724>"failure"</span> <span class="token operator" data-v-4240d724>&&</span> <span class="token punctuation" data-v-4240d724>(</span>
        <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>An error occurred<span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>{</span><span class="token function" data-v-4240d724>String</span><span class="token punctuation" data-v-4240d724>(</span>state<span class="token punctuation" data-v-4240d724>.</span>error<span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span>
      <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span>
      <span class="token punctuation" data-v-4240d724>{</span>state<span class="token punctuation" data-v-4240d724>.</span>type <span class="token operator" data-v-4240d724>!==</span> <span class="token string" data-v-4240d724>"success"</span> <span class="token operator" data-v-4240d724>?</span> <span class="token punctuation" data-v-4240d724>(</span>
        <span class="token operator" data-v-4240d724>&lt;</span>LoginBox onLogin<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>handleLogin<span class="token punctuation" data-v-4240d724>}</span> <span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token punctuation" data-v-4240d724>)</span> <span class="token operator" data-v-4240d724>:</span> <span class="token punctuation" data-v-4240d724>(</span>
        <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>></span>
          <span class="token operator" data-v-4240d724>&lt;</span>p<span class="token operator" data-v-4240d724>></span>You're logged <span class="token keyword" data-v-4240d724>in</span><span class="token operator" data-v-4240d724>!</span> Your user token <span class="token keyword" data-v-4240d724>is</span> <span class="token punctuation" data-v-4240d724>{</span>state<span class="token punctuation" data-v-4240d724>.</span>userToken<span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>p<span class="token operator" data-v-4240d724>></span>
          <span class="token operator" data-v-4240d724>&lt;</span>button onClick<span class="token operator" data-v-4240d724>=</span><span class="token punctuation" data-v-4240d724>{</span>handleLogout<span class="token punctuation" data-v-4240d724>}</span><span class="token operator" data-v-4240d724>></span>Logout<span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>button<span class="token operator" data-v-4240d724>></span>
        <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span><span class="token operator" data-v-4240d724>></span>
      <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>}</span>
    <span class="token operator" data-v-4240d724>&lt;</span><span class="token operator" data-v-4240d724>/</span>div<span class="token operator" data-v-4240d724>></span>
  <span class="token punctuation" data-v-4240d724>)</span><span class="token punctuation" data-v-4240d724>;</span>
<span class="token punctuation" data-v-4240d724>}</span>
</code></pre></div>
<p data-v-4240d724>At this point, Typescript will make sure that the state is always in a consistent state. For example, the previous mistake (forgetting <code data-v-4240d724>loading: false</code> in the <code data-v-4240d724>failure</code> case due to the spread operator) won't compile:</p>
<p data-v-4240d724><img alt="Typescript fails to compile an invalid state" src="/posts/states-unrepresentable/typescript1.png" data-v-4240d724></p>
<p data-v-4240d724>We made <em data-v-4240d724>invalid states unrepresentable</em> 😎</p>
<blockquote data-v-4240d724>
<p data-v-4240d724>Note: You might be wondering why we added the <code data-v-4240d724>loading</code> field to all states. The reason is that I thought it would make the example easier to understand. But in this simple scenario, we could drop the <code data-v-4240d724>loading</code> field entirely and only show the loading message when the state is pending (<code data-v-4240d724>state.type === 'pending'</code>).</p>
</blockquote>
<h2 id="final-thoughts" data-v-4240d724><a href="#final-thoughts" aria-hidden="true" tabindex="-1" data-v-4240d724><span class="icon icon-link" data-v-4240d724></span></a>Final thoughts</h2>
<p data-v-4240d724>All right! We started from a problematic example and gradually improved the way our state is represented, making the app more robust along the way.</p>
<p data-v-4240d724>It's important to consider these techniques as an additional tool you have at your disposal rather than absolute truths. There might be cases where these techniques are impractical for several reasons. As always, use the right tool for the job!</p>
<p data-v-4240d724>If you're interested, you can find the complete code for our final solution in <a href="https://codesandbox.io/s/reactinvalidstatesunrepresentable-good-9l8pym?file=/src/App.tsx" rel="nofollow noopener noreferrer" target="_blank" data-v-4240d724>this Codesandbox</a>.</p></div></div> <div class="post-footer-container post-footer" data-v-63505c64 data-v-4240d724><img src="/_nuxt/img/profile-picture-small.40e71b2.png" alt="Federico Terzi Picture" class="post-footer-image" data-v-63505c64> <div class="post-footer-content" data-v-63505c64><p data-v-63505c64>Hi 👋, I’m <span class="red" data-v-63505c64>Federico</span>, thanks for reading!</p> <p data-v-63505c64>
      If you liked this article, make sure to follow me on
      <a href="https://twitter.com/terzi_federico" class="blue" data-v-63505c64>Twitter</a> to
      stay updated with the latest ones :)
    </p> <p data-v-63505c64>
      If you are into technical topics, you might also enjoy my
      <a href="https://www.youtube.com/c/FedericoTerzi" class="red" data-v-63505c64>YouTube</a>
      channel.
    </p></div></div></div></article></div> <div class="footer-container" data-v-31194f02><p data-v-31194f02><span class="bold" data-v-31194f02>Designed</span> and
    <span class="bold" data-v-31194f02>coded</span> with<span class="red" data-v-31194f02> ♥</span> by me.
    Copyright © Federico Terzi 2019-2022 - P.IVA 03864201201
  </p></div> <div class="social-bar-container"><a href="https://twitter.com/terzi_federico"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M23 3.00005C22.0424 3.67552 20.9821 4.19216 19.86 4.53005C19.2577 3.83756 18.4573 3.34674 17.567 3.12397C16.6767 2.90121 15.7395 2.95724 14.8821 3.2845C14.0247 3.61176 13.2884 4.19445 12.773 4.95376C12.2575 5.71308 11.9877 6.61238 12 7.53005V8.53005C10.2426 8.57561 8.50127 8.18586 6.93101 7.39549C5.36074 6.60513 4.01032 5.43868 3 4.00005C3 4.00005 -1 13 8 17C5.94053 18.398 3.48716 19.099 1 19C10 24 21 19 21 7.50005C20.9991 7.2215 20.9723 6.94364 20.92 6.67005C21.9406 5.66354 22.6608 4.39276 23 3.00005V3.00005Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a> <div class="social-bar-divider"></div> <a href="https://github.com/federico-terzi/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_31_53)"><path d="M16 21.9999V18.1299C16.0375 17.6531 15.9731 17.1737 15.811 16.7237C15.6489 16.2737 15.3929 15.8634 15.06 15.5199C18.2 15.1699 21.5 13.9799 21.5 8.51994C21.4997 7.12376 20.9627 5.78114 20 4.76994C20.4559 3.54844 20.4236 2.19829 19.91 0.999938C19.91 0.999938 18.73 0.649938 16 2.47994C13.708 1.85876 11.292 1.85876 9 2.47994C6.27 0.649938 5.09 0.999938 5.09 0.999938C4.57638 2.19829 4.54414 3.54844 5 4.76994C4.03013 5.78864 3.49252 7.1434 3.5 8.54994C3.5 13.9699 6.8 15.1599 9.94 15.5499C9.611 15.8899 9.35726 16.2953 9.19531 16.7399C9.03335 17.1844 8.96681 17.658 9 18.1299V21.9999M9 18.9999C4 20.4999 4 16.4999 2 15.9999L9 18.9999Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></g><defs><clipPath id="clip0_31_53"><rect width="24" height="24" fill="white"></rect></clipPath></defs></svg></a> <div class="social-bar-divider"></div> <a href="https://www.linkedin.com/in/federico-terzi/"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 8C17.5913 8 19.1174 8.63214 20.2426 9.75736C21.3679 10.8826 22 12.4087 22 14V21H18V14C18 13.4696 17.7893 12.9609 17.4142 12.5858C17.0391 12.2107 16.5304 12 16 12C15.4696 12 14.9609 12.2107 14.5858 12.5858C14.2107 12.9609 14 13.4696 14 14V21H10V14C10 12.4087 10.6321 10.8826 11.7574 9.75736C12.8826 8.63214 14.4087 8 16 8V8Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 9H2V21H6V9Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4 6C5.10457 6 6 5.10457 6 4C6 2.89543 5.10457 2 4 2C2.89543 2 2 2.89543 2 4C2 5.10457 2.89543 6 4 6Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a> <div class="social-bar-divider"></div> <a href="https://www.youtube.com/c/FedericoTerzi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22.54 6.42C22.4212 5.94541 22.1793 5.51057 21.8387 5.15941C21.498 4.80824 21.0708 4.55318 20.6 4.42C18.88 4 12 4 12 4C12 4 5.12001 4 3.40001 4.46C2.92925 4.59318 2.50198 4.84824 2.16135 5.19941C1.82072 5.55057 1.5788 5.98541 1.46001 6.46C1.14522 8.20556 0.991243 9.97631 1.00001 11.75C0.988786 13.537 1.14277 15.3213 1.46001 17.08C1.59097 17.5398 1.83831 17.9581 2.17815 18.2945C2.51799 18.6308 2.93883 18.8738 3.40001 19C5.12001 19.46 12 19.46 12 19.46C12 19.46 18.88 19.46 20.6 19C21.0708 18.8668 21.498 18.6118 21.8387 18.2606C22.1793 17.9094 22.4212 17.4746 22.54 17C22.8524 15.2676 23.0063 13.5103 23 11.75C23.0112 9.96295 22.8572 8.1787 22.54 6.42V6.42Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9.75 15.02L15.5 11.75L9.75 8.47998V15.02Z" stroke="#2E4364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></div></div></div></div><script defer src="/_nuxt/static/1660563508/blog/building-robust-applications-by-making-invalid-states-unrepresentable/state.js"></script><script src="/_nuxt/5a3dd91.js" defer></script><script src="/_nuxt/9c764e2.js" defer></script><script src="/_nuxt/9f592cb.js" defer></script><script src="/_nuxt/55fe2d7.js" defer></script><script src="/_nuxt/97a8332.js" defer></script>
  </body>
</html>
